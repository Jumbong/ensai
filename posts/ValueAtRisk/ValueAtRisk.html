<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Menu - Modélisation de la value at risk</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../ensai.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Menu</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/junior-jumbong-258330211/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text">LinkedIn</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/Jumbong"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">Github</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../posts/ValueAtRisk/ValueAtRisk.html">Ensai 3A</a></li><li class="breadcrumb-item"><a href="../../posts/ValueAtRisk/ValueAtRisk.html">Value at Risk</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Ensai 3A</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/ValueAtRisk/ValueAtRisk.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Value at Risk</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/MasteringFinancialData/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mastering Financial Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/obligation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Courbe de taux</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/MarketFinance/schiller.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CAPE Ratio</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">climat</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/ClimateScenario/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">simple tool in R to analyze data : Graph representationExecution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/ClimatMeteo/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Différence entre climat et météo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/NotionCle/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notions clés pour comprendre le changement climatique</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#projet-statistique-des-risques-extrêmes" id="toc-projet-statistique-des-risques-extrêmes" class="nav-link active" data-scroll-target="#projet-statistique-des-risques-extrêmes"><strong>PROJET STATISTIQUE DES RISQUES EXTRÊMES</strong></a></li>
  <li><a href="#init" id="toc-init" class="nav-link" data-scroll-target="#init">Init</a>
  <ul class="collapse">
  <li><a href="#import-des-données" id="toc-import-des-données" class="nav-link" data-scroll-target="#import-des-données">Import des données</a></li>
  <li><a href="#mise-en-forme-et-nettoyage-des-données" id="toc-mise-en-forme-et-nettoyage-des-données" class="nav-link" data-scroll-target="#mise-en-forme-et-nettoyage-des-données">Mise en forme et nettoyage des données</a></li>
  <li><a href="#calcul-du-log-rendement" id="toc-calcul-du-log-rendement" class="nav-link" data-scroll-target="#calcul-du-log-rendement">calcul du log rendement</a></li>
  <li><a href="#représentation-de-la-série-des-cours-et-de-la-série-des-log-rendements-en-fonction-de-la-date" id="toc-représentation-de-la-série-des-cours-et-de-la-série-des-log-rendements-en-fonction-de-la-date" class="nav-link" data-scroll-target="#représentation-de-la-série-des-cours-et-de-la-série-des-log-rendements-en-fonction-de-la-date">Représentation de la série des cours et de la série des log rendements en fonction de la date</a></li>
  <li><a href="#fonction-dautocorrélation-et-dautocorrélation-partielle-de-la-série-des-log-rendements" id="toc-fonction-dautocorrélation-et-dautocorrélation-partielle-de-la-série-des-log-rendements" class="nav-link" data-scroll-target="#fonction-dautocorrélation-et-dautocorrélation-partielle-de-la-série-des-log-rendements">Fonction d’autocorrélation et d’autocorrélation partielle de la série des log rendements</a></li>
  <li><a href="#etude-de-la-stationnarité" id="toc-etude-de-la-stationnarité" class="nav-link" data-scroll-target="#etude-de-la-stationnarité">Etude de la stationnarité</a></li>
  <li><a href="#découpage-train-test" id="toc-découpage-train-test" class="nav-link" data-scroll-target="#découpage-train-test">Découpage train test</a></li>
  <li><a href="#statistiques-descriptives-des-rendements" id="toc-statistiques-descriptives-des-rendements" class="nav-link" data-scroll-target="#statistiques-descriptives-des-rendements">Statistiques descriptives des rendements</a></li>
  </ul></li>
  <li><a href="#modélisation-de-la-var." id="toc-modélisation-de-la-var." class="nav-link" data-scroll-target="#modélisation-de-la-var.">Modélisation de la VaR.</a></li>
  <li><a href="#var-non-paramétrique" id="toc-var-non-paramétrique" class="nav-link" data-scroll-target="#var-non-paramétrique">VaR non paramétrique</a>
  <ul class="collapse">
  <li><a href="#var-historique" id="toc-var-historique" class="nav-link" data-scroll-target="#var-historique">VaR historique :</a></li>
  <li><a href="#backtesting" id="toc-backtesting" class="nav-link" data-scroll-target="#backtesting">Backtesting</a></li>
  <li><a href="#var-historique-bootstrap" id="toc-var-historique-bootstrap" class="nav-link" data-scroll-target="#var-historique-bootstrap">VaR historique Bootstrap</a></li>
  <li><a href="#backtesting-1" id="toc-backtesting-1" class="nav-link" data-scroll-target="#backtesting-1">Backtesting</a></li>
  </ul></li>
  <li><a href="#méthodes-paramétriques-destimation-de-la-var" id="toc-méthodes-paramétriques-destimation-de-la-var" class="nav-link" data-scroll-target="#méthodes-paramétriques-destimation-de-la-var">Méthodes paramétriques d’estimation de la VaR</a>
  <ul class="collapse">
  <li><a href="#var-gaussienne" id="toc-var-gaussienne" class="nav-link" data-scroll-target="#var-gaussienne">VaR gaussienne</a>
  <ul class="collapse">
  <li><a href="#validation" id="toc-validation" class="nav-link" data-scroll-target="#validation">Validation</a></li>
  <li><a href="#représentation-graphique" id="toc-représentation-graphique" class="nav-link" data-scroll-target="#représentation-graphique">Représentation graphique</a></li>
  <li><a href="#analyse-des-exceptions" id="toc-analyse-des-exceptions" class="nav-link" data-scroll-target="#analyse-des-exceptions">Analyse des exceptions</a></li>
  <li><a href="#var-gaussienne-à-10-jours" id="toc-var-gaussienne-à-10-jours" class="nav-link" data-scroll-target="#var-gaussienne-à-10-jours">VaR gaussienne à 10 jours</a></li>
  <li><a href="#var-gaussienne-pondérée" id="toc-var-gaussienne-pondérée" class="nav-link" data-scroll-target="#var-gaussienne-pondérée">VaR gaussienne pondérée :</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#var-dynamique" id="toc-var-dynamique" class="nav-link" data-scroll-target="#var-dynamique">VaR dynamique :</a>
  <ul class="collapse">
  <li><a href="#réprésentation-graphique" id="toc-réprésentation-graphique" class="nav-link" data-scroll-target="#réprésentation-graphique">Réprésentation graphique</a></li>
  </ul></li>
  <li><a href="#var-skew-student" id="toc-var-skew-student" class="nav-link" data-scroll-target="#var-skew-student">VaR skew-Student :</a>
  <ul class="collapse">
  <li><a href="#fonction-de-densité-de-la-skew-student" id="toc-fonction-de-densité-de-la-skew-student" class="nav-link" data-scroll-target="#fonction-de-densité-de-la-skew-student">fonction de densité de la skew-student</a></li>
  <li><a href="#fonction-de-log-vraisemblance" id="toc-fonction-de-log-vraisemblance" class="nav-link" data-scroll-target="#fonction-de-log-vraisemblance">Fonction de log vraisemblance</a></li>
  <li><a href="#fonction-doptimisation" id="toc-fonction-doptimisation" class="nav-link" data-scroll-target="#fonction-doptimisation">fonction d’optimisation</a></li>
  <li><a href="#estimation-des-paramètres-sur-base-dapprentissage" id="toc-estimation-des-paramètres-sur-base-dapprentissage" class="nav-link" data-scroll-target="#estimation-des-paramètres-sur-base-dapprentissage">Estimation des paramètres sur base d’apprentissage</a></li>
  <li><a href="#comparaison-entre-densité-théorique-et-densité-empirique-de-la-skew-student-sur-les-log-rendements" id="toc-comparaison-entre-densité-théorique-et-densité-empirique-de-la-skew-student-sur-les-log-rendements" class="nav-link" data-scroll-target="#comparaison-entre-densité-théorique-et-densité-empirique-de-la-skew-student-sur-les-log-rendements">Comparaison entre densité théorique et densité empirique de la skew-student sur les log rendements</a>
  <ul class="collapse">
  <li><a href="#fonction-de-repartition-de-la-skew-student-et-fonction-quantile" id="toc-fonction-de-repartition-de-la-skew-student-et-fonction-quantile" class="nav-link" data-scroll-target="#fonction-de-repartition-de-la-skew-student-et-fonction-quantile">Fonction de repartition de la skew-student et fonction quantile</a></li>
  <li><a href="#qq-plot" id="toc-qq-plot" class="nav-link" data-scroll-target="#qq-plot">QQ plot :</a></li>
  <li><a href="#comparaison-entre-loi-gaussienne-et-loi-de-skew-student" id="toc-comparaison-entre-loi-gaussienne-et-loi-de-skew-student" class="nav-link" data-scroll-target="#comparaison-entre-loi-gaussienne-et-loi-de-skew-student">comparaison entre loi gaussienne et loi de Skew Student</a></li>
  <li><a href="#calcul-de-la-var-skew-student" id="toc-calcul-de-la-var-skew-student" class="nav-link" data-scroll-target="#calcul-de-la-var-skew-student">Calcul de la VaR Skew Student</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#var-tve-approche-maxima-par-bloc" id="toc-var-tve-approche-maxima-par-bloc" class="nav-link" data-scroll-target="#var-tve-approche-maxima-par-bloc">VaR TVE: Approche maxima par bloc</a>
  <ul class="collapse">
  <li><a href="#construction-de-léchantillon-de-maxima" id="toc-construction-de-léchantillon-de-maxima" class="nav-link" data-scroll-target="#construction-de-léchantillon-de-maxima">Construction de l’échantillon de maxima</a></li>
  <li><a href="#gumbel-plot" id="toc-gumbel-plot" class="nav-link" data-scroll-target="#gumbel-plot">Gumbel Plot</a></li>
  <li><a href="#calcul-de-la-var" id="toc-calcul-de-la-var" class="nav-link" data-scroll-target="#calcul-de-la-var">Calcul de la VAR</a></li>
  <li><a href="#backtesting-2" id="toc-backtesting-2" class="nav-link" data-scroll-target="#backtesting-2">Backtesting</a></li>
  </ul></li>
  <li><a href="#var-tve-approche-peak-over-threshold" id="toc-var-tve-approche-peak-over-threshold" class="nav-link" data-scroll-target="#var-tve-approche-peak-over-threshold">VAR TVE: Approche Peak over threshold</a>
  <ul class="collapse">
  <li><a href="#fonction-pour-le-mean-excess-plot" id="toc-fonction-pour-le-mean-excess-plot" class="nav-link" data-scroll-target="#fonction-pour-le-mean-excess-plot">Fonction pour le Mean Excess Plot</a></li>
  <li><a href="#détermination-de-u-par-analyse-graphique" id="toc-détermination-de-u-par-analyse-graphique" class="nav-link" data-scroll-target="#détermination-de-u-par-analyse-graphique">Détermination de u par analyse graphique</a></li>
  <li><a href="#estimation-des-paramètres-de-la-loi-gpd" id="toc-estimation-des-paramètres-de-la-loi-gpd" class="nav-link" data-scroll-target="#estimation-des-paramètres-de-la-loi-gpd">Estimation des paramètres de la loi GPD</a></li>
  <li><a href="#validation-ex-ante" id="toc-validation-ex-ante" class="nav-link" data-scroll-target="#validation-ex-ante">Validation Ex ante</a></li>
  <li><a href="#calcul-de-la-var-1" id="toc-calcul-de-la-var-1" class="nav-link" data-scroll-target="#calcul-de-la-var-1">Calcul de la VAR</a></li>
  <li><a href="#backtesting-3" id="toc-backtesting-3" class="nav-link" data-scroll-target="#backtesting-3">Backtesting</a></li>
  </ul></li>
  <li><a href="#comparaison-des-différentes-approches" id="toc-comparaison-des-différentes-approches" class="nav-link" data-scroll-target="#comparaison-des-différentes-approches">Comparaison des différentes approches</a>
  <ul class="collapse">
  <li><a href="#commentaires" id="toc-commentaires" class="nav-link" data-scroll-target="#commentaires">Commentaires</a></li>
  </ul></li>
  <li><a href="#calcul-de-la-var-en-utilisant-un-modèle-ar-garch" id="toc-calcul-de-la-var-en-utilisant-un-modèle-ar-garch" class="nav-link" data-scroll-target="#calcul-de-la-var-en-utilisant-un-modèle-ar-garch">Calcul de la VaR en utilisant un modèle AR-GARCH</a>
  <ul class="collapse">
  <li><a href="#qq-plot-des-résidus" id="toc-qq-plot-des-résidus" class="nav-link" data-scroll-target="#qq-plot-des-résidus">QQ plot des résidus</a></li>
  <li><a href="#adéquation-du-modèle-garch-sur-les-résidus" id="toc-adéquation-du-modèle-garch-sur-les-résidus" class="nav-link" data-scroll-target="#adéquation-du-modèle-garch-sur-les-résidus">Adéquation du modèle GARCH sur les résidus</a></li>
  <li><a href="#modélisation-du-garch-sur-les-résidus." id="toc-modélisation-du-garch-sur-les-résidus." class="nav-link" data-scroll-target="#modélisation-du-garch-sur-les-résidus.">Modélisation du GARCH sur les résidus.</a>
  <ul class="collapse">
  <li><a href="#vérifions-que-les-résidus-de-ce-modèle-garch-sont-des-bruits-blancs." id="toc-vérifions-que-les-résidus-de-ce-modèle-garch-sont-des-bruits-blancs." class="nav-link" data-scroll-target="#vérifions-que-les-résidus-de-ce-modèle-garch-sont-des-bruits-blancs.">Vérifions que les résidus de ce modèle GARCH sont des bruits blancs.</a></li>
  </ul></li>
  <li><a href="#estimation-des-paramètres-du-modèle-ar1-garch11." id="toc-estimation-des-paramètres-du-modèle-ar1-garch11." class="nav-link" data-scroll-target="#estimation-des-paramètres-du-modèle-ar1-garch11.">Estimation des paramètres du modèle AR(1)-GARCH(1,1).</a></li>
  </ul></li>
  <li><a href="#reproduction-de-la-dynamique-historique-de-sigma_t-et-de-mu_t" id="toc-reproduction-de-la-dynamique-historique-de-sigma_t-et-de-mu_t" class="nav-link" data-scroll-target="#reproduction-de-la-dynamique-historique-de-sigma_t-et-de-mu_t">Reproduction de la dynamique historique de <span class="math inline">\(\sigma_t\)</span> et de <span class="math inline">\(\mu_t\)</span></a>
  <ul class="collapse">
  <li><a href="#calcul-de-la-var-sur-les-résidus-standardisés-epsilon_t" id="toc-calcul-de-la-var-sur-les-résidus-standardisés-epsilon_t" class="nav-link" data-scroll-target="#calcul-de-la-var-sur-les-résidus-standardisés-epsilon_t">Calcul de la VaR sur les résidus standardisés <span class="math inline">\(\epsilon_t\)</span></a></li>
  </ul></li>
  <li><a href="#var-historique-boostrap-sur-les-résidus-standardisés-et-calcul-de-la-var-dynamique" id="toc-var-historique-boostrap-sur-les-résidus-standardisés-et-calcul-de-la-var-dynamique" class="nav-link" data-scroll-target="#var-historique-boostrap-sur-les-résidus-standardisés-et-calcul-de-la-var-dynamique">VaR historique boostrap sur les résidus standardisés et calcul de la VaR dynamique</a></li>
  <li><a href="#backtesting-4" id="toc-backtesting-4" class="nav-link" data-scroll-target="#backtesting-4">Backtesting</a></li>
  <li><a href="#var-par-la-méthode-maxima-par-bloc-sur-les-résidus-standardisés-et-calcul-de-la-var-dynamique" id="toc-var-par-la-méthode-maxima-par-bloc-sur-les-résidus-standardisés-et-calcul-de-la-var-dynamique" class="nav-link" data-scroll-target="#var-par-la-méthode-maxima-par-bloc-sur-les-résidus-standardisés-et-calcul-de-la-var-dynamique">VaR par la méthode maxima par bloc sur les résidus standardisés et calcul de la VaR dynamique</a></li>
  <li><a href="#calcul-de-la-var-2" id="toc-calcul-de-la-var-2" class="nav-link" data-scroll-target="#calcul-de-la-var-2">Calcul de la VaR</a>
  <ul class="collapse">
  <li><a href="#backtesting-5" id="toc-backtesting-5" class="nav-link" data-scroll-target="#backtesting-5">Backtesting</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../posts/ValueAtRisk/ValueAtRisk.html">Ensai 3A</a></li><li class="breadcrumb-item"><a href="../../posts/ValueAtRisk/ValueAtRisk.html">Value at Risk</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Modélisation de la value at risk</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Jumbong Junior <a href="mailto:jumbong.jr@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
             <p>Ganiyu Isaac <a href="mailto:isaac.ganiyu@eleve.ensai.fr" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="projet-statistique-des-risques-extrêmes" class="level1">
<h1><strong>PROJET STATISTIQUE DES RISQUES EXTRÊMES</strong></h1>
</section>
<section id="init" class="level1">
<h1>Init</h1>
<section id="import-des-données" class="level3">
<h3 class="anchored" data-anchor-id="import-des-données">Import des données</h3>
<div id="cell-4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install yfinance</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install arch</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Télécharger les données historiques du CAC 40</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>cac_40 <span class="op">=</span> yf.Ticker(<span class="st">"^FCHI"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> cac_40.history(<span class="st">"max"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Formater l'index en année-mois-jour</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>data.index <span class="op">=</span> data.index.strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>ts_data <span class="op">=</span> data</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>ts_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
<th data-quarto-table-cell-role="th">Dividends</th>
<th data-quarto-table-cell-role="th">Stock Splits</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1990-03-01</td>
<td>1836.000000</td>
<td>1838.000000</td>
<td>1827.000000</td>
<td>1832.000000</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1990-03-02</td>
<td>1831.000000</td>
<td>1860.000000</td>
<td>1831.000000</td>
<td>1860.000000</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1990-03-05</td>
<td>1866.000000</td>
<td>1874.000000</td>
<td>1862.000000</td>
<td>1874.000000</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1990-03-06</td>
<td>1869.000000</td>
<td>1875.000000</td>
<td>1866.000000</td>
<td>1872.000000</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1990-03-07</td>
<td>1874.000000</td>
<td>1881.000000</td>
<td>1874.000000</td>
<td>1880.000000</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-17</td>
<td>7958.520020</td>
<td>8060.990234</td>
<td>7958.000000</td>
<td>7981.509766</td>
<td>59951900</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-04-18</td>
<td>8013.910156</td>
<td>8039.189941</td>
<td>7976.399902</td>
<td>8023.259766</td>
<td>57583000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-19</td>
<td>7971.680176</td>
<td>8039.479980</td>
<td>7946.839844</td>
<td>8022.410156</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-04-22</td>
<td>8068.140137</td>
<td>8071.810059</td>
<td>8007.450195</td>
<td>8040.359863</td>
<td>56900500</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-04-23</td>
<td>8064.319824</td>
<td>8111.169922</td>
<td>8052.569824</td>
<td>8105.779785</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>8669 rows × 7 columns</p>
</div>
</div>
</div>
</section>
<section id="mise-en-forme-et-nettoyage-des-données" class="level3">
<h3 class="anchored" data-anchor-id="mise-en-forme-et-nettoyage-des-données">Mise en forme et nettoyage des données</h3>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ts_close <span class="op">=</span> ts_data[[ <span class="st">'Close'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">### Visualisation des valuers manquantes </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Y'a t-il des valeurs manquantes ? </span><span class="sc">{</span><span class="bu">any</span>(pd.isna(ts_close[<span class="st">'Close'</span>]))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ts_close[pd.isna(ts_close[<span class="st">'Close'</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Y'a t-il des valeurs manquantes ? False</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Close</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
<p>Nous n’avons aucune valeur manquante dans nos données</p>
</section>
<section id="calcul-du-log-rendement" class="level3">
<h3 class="anchored" data-anchor-id="calcul-du-log-rendement">calcul du log rendement</h3>
<div id="cell-12" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ts_close[<span class="st">'log_return'</span>] <span class="op">=</span> np.log(ts_close[<span class="st">'Close'</span>] <span class="op">/</span> ts_close[<span class="st">'Close'</span>].shift(<span class="dv">1</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ts_close <span class="op">=</span> ts_close.dropna(subset<span class="op">=</span>[<span class="st">'log_return'</span>])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts_close.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Close  log_return
Date                          
1990-03-02  1860.0    0.015168
1990-03-05  1874.0    0.007499
1990-03-06  1872.0   -0.001068
1990-03-07  1880.0    0.004264
1990-03-08  1917.0    0.019490</code></pre>
</div>
</div>
</section>
<section id="représentation-de-la-série-des-cours-et-de-la-série-des-log-rendements-en-fonction-de-la-date" class="level3">
<h3 class="anchored" data-anchor-id="représentation-de-la-série-des-cours-et-de-la-série-des-log-rendements-en-fonction-de-la-date">Représentation de la série des cours et de la série des log rendements en fonction de la date</h3>
<div id="cell-14" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots(<span class="dv">1</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'historical log returns'</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>ax1.plot(ts_close.index, ts_close[<span class="st">'log_return'</span>], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'historical CAC 40'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>ax2.plot(ts_close.index, ts_close[<span class="st">'Close'</span>], color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1200x1200 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le graphique ci-dessus représente la série des cours et la série des log rendements du CAC40 en fonction de la date. La série des cours est assez volatile et a une tendance à la hausse non-linéaire. Il semble qu’elle ne soit pas stationnaire. Cependant, la série des log rendements a une tendance constante et semble être stationnaire. Nous vérifierons cela également à travers les fonctions d’autocorrélation et d’autocorrélation partielle et par le test de Dickey-Fuller.</p>
</section>
<section id="fonction-dautocorrélation-et-dautocorrélation-partielle-de-la-série-des-log-rendements" class="level3">
<h3 class="anchored" data-anchor-id="fonction-dautocorrélation-et-dautocorrélation-partielle-de-la-série-des-log-rendements">Fonction d’autocorrélation et d’autocorrélation partielle de la série des log rendements</h3>
<div id="cell-17" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>plot_acf(ts_close[<span class="st">'log_return'</span>].dropna(), ax<span class="op">=</span>ax[<span class="dv">0</span>],title<span class="op">=</span><span class="st">'ACF'</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>plot_pacf(ts_close[<span class="st">'log_return'</span>].dropna(), ax<span class="op">=</span>ax[<span class="dv">1</span>],title<span class="op">=</span><span class="st">'PACF'</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Comme nous pouvons le voir sur les graphiques ci-dessus, l’autocorrélation et l’autocorrélation partielle des log rendements sont très faibles. Cela signifie que les log rendements sont stationnaires. Nous vérifierons cela à travers le test de Dickey-Fuller.</p>
</section>
<section id="etude-de-la-stationnarité" class="level3">
<h3 class="anchored" data-anchor-id="etude-de-la-stationnarité">Etude de la stationnarité</h3>
<div id="cell-20" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Test de dickey fuller</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>adf_result <span class="op">=</span> adfuller(ts_close[<span class="st">'log_return'</span>].dropna(), regression<span class="op">=</span><span class="st">'ct'</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"ADF Statistic: </span><span class="sc">{</span>adf_result[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span> <span class="kw">and</span> <span class="ss">f"p-value: </span><span class="sc">{</span>adf_result[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value: 0.0</code></pre>
</div>
</div>
<p>La pvalue étant nulle, on rejette l’hypothèse nulle de présence d’une racine unitaire. La série des log rendements est donc stationnaire. Par conséquent, nous travaillerons avec cette série pour modéliser la VaR à horizon 1 jour.</p>
</section>
<section id="découpage-train-test" class="level3">
<h3 class="anchored" data-anchor-id="découpage-train-test">Découpage train test</h3>
<div id="cell-23" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nous considérons 75% de nos données dans l'échantillon d'apprentissage et 25% dans l'échantillon de test</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>train_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(ts_close)<span class="op">*</span><span class="fl">0.75</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>test_size <span class="op">=</span> <span class="bu">len</span>(ts_close)<span class="op">-</span>train_size</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>train_close <span class="op">=</span> ts_close.iloc[<span class="dv">0</span>:train_size,:].dropna()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>test_close <span class="op">=</span> ts_close.iloc[train_size:<span class="bu">len</span>(ts_close),:]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Taille de l'ensemble d'apprentissage :"</span>, <span class="bu">len</span>(train_close))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Taille de l'ensemble de test :"</span>, <span class="bu">len</span>(test_close))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>pd.isna(train_close).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Taille de l'ensemble d'apprentissage : 6501
Taille de l'ensemble de test : 2167</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Close         0
log_return    0
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="statistiques-descriptives-des-rendements" class="level3">
<h3 class="anchored" data-anchor-id="statistiques-descriptives-des-rendements">Statistiques descriptives des rendements</h3>
<div id="cell-25" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>train_close[<span class="st">'log_return'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>count    6501.000000
mean        0.000153
std         0.014051
min        -0.094715
25%        -0.006990
50%         0.000383
75%         0.007740
max         0.105946
Name: log_return, dtype: float64</code></pre>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>test_close[<span class="st">'log_return'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>count    2167.000000
mean        0.000228
std         0.011795
min        -0.130983
25%        -0.004818
50%         0.000643
75%         0.005964
max         0.080561
Name: log_return, dtype: float64</code></pre>
</div>
</div>
<p>Sur les deux jeux de données les log rendements sont relativement volatiles avec une dispersion plus importante pour la base d’apprentissage que pour la base de test. On remarque par ailleurs que le min est plus petit et le max plus grand dans la base d’apprentissage que dans la base de test. Nous pouvions nous y attendre car la base d’apprentissage couvre une période plus longue. Les deux séries sont malgré tout assez semblables en terme de moyenne avec une moyenne d’environ 0.015%.</p>
</section>
</section>
<section id="modélisation-de-la-var." class="level1">
<h1>Modélisation de la VaR.</h1>
<p>La var est définie comme la perte potentielle maximale que peut subir un portefeuille sur un horizon avec un certain niveau de confiance. Dans ce notebook, nous adopterons une vision rentabilité. Dans ce cas, nous allons modéliser : <span class="math inline">\(P[R&lt;VaR_h] =1- \alpha\)</span>.</p>
<p>Nous allons appliquer les différentes méthodes de modélisation de la Var:</p>
<pre><code>- Méthodes non-paramétriques
    - VaR historique
    - VaR bootstrap
- Méthodes paramétriques
    - VaR gaussienne
    - VaR skew student
    - VaR TVE (Théorie des valeurs extrêmes)
    - VaR AR-GARCH</code></pre>
</section>
<section id="var-non-paramétrique" class="level1">
<h1>VaR non paramétrique</h1>
<section id="var-historique" class="level2">
<h2 class="anchored" data-anchor-id="var-historique">VaR historique :</h2>
<p>Ici on estime la distribution des rendements R par la fonction de répartition empirique du vecteur d’observations. La VaR est alors donnée par le quantile empirique d’ordre <span class="math inline">\(1-\alpha\)</span> :</p>
<p><span class="math inline">\(\hat{VaR}_h(\alpha) = \hat{F_n^{-1}}(1-\alpha)\)</span> avec <span class="math inline">\(\hat{F_n}(1-\alpha)= \frac{1}{n} \sum_{i=1}^{n} 1_{R_i \leq (1-\alpha)}\)</span></p>
<p>Nous utiliserons ainsi la fonction <code>numpy.percentile</code> pour calculer la VaR historique.</p>
<div id="cell-31" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hist_var(returns, index, fenetre, seuil):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Cette fonction calcule la Value at Risk (VaR) historique d'une série temporelle de log rendements</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">        returns (numpy_array ): serie de log rendements</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">        index (int): indice maximal de la série à considérer pour le calcul</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">        fenetre (int): nombre de jours sur lesquels on calcule la VaR</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">        seuil (float): niveau de confiance de la VaR</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">        float: VaR historique</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.percentile(returns[index<span class="op">-</span>fenetre:index], <span class="dv">100</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>seuil))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-32" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>var_hist<span class="op">=</span> hist_var(train_close[<span class="st">"log_return"</span>], train_size, <span class="dv">251</span><span class="op">*</span><span class="dv">10</span>, <span class="fl">0.99</span>) <span class="co">#on utilise 10 ans comme fenêtre</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(var_hist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-0.04320825141346711</code></pre>
</div>
</div>
</section>
<section id="backtesting" class="level2">
<h2 class="anchored" data-anchor-id="backtesting">Backtesting</h2>
<div id="cell-34" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_hist <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"Non parametric VaR"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>list_exceptions_np <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_hist]</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_np], test_close[<span class="st">'log_return'</span>][list_exceptions_np], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-35" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR non paramétrique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_np)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR non paramétrique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_np)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR non paramétrique est: 10
Le pourcentage d'exceptions pour la VaR non paramétrique est: 0.0046146746654360865</code></pre>
</div>
</div>
<p>Nous allons maintenant vérifier si la probabilité d’exception est statiquement égale à <span class="math inline">\(\alpha\)</span>.</p>
<div id="cell-37" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>test_except_np <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_np), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_np<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.009043369613659823</code></pre>
</div>
</div>
<p>La pvalue du test est inférieure au seuil de 5%. On rejette donc l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Nous concluons donc que notre VaR n’est pas satisfaisante.</p>
<div id="cell-39" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ES_np <span class="op">=</span> np.mean([r <span class="cf">for</span> r <span class="kw">in</span> train_close[<span class="st">'log_return'</span>] <span class="cf">if</span> r<span class="op">&lt;</span>var_hist])</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"L'Expected Shortfall associée à la VaR calculée est: </span><span class="sc">{</span>ES_np<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>L'Expected Shortfall associée à la VaR calculée est: -0.054387464763168906</code></pre>
</div>
</div>
</section>
<section id="var-historique-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="var-historique-bootstrap">VaR historique Bootstrap</h2>
<p>Pour la VaR historique boostrap, nous allons construire B réplications bootstrap de la série des log rendements. Pour chaque réplication(b), nous allons calculer la VaR historique. La VaR historique bootstrap est alors donnée par la moyenne des VaR historiques des B réplications bootstrap.</p>
<p><span class="math inline">\(\hat{VaR}_{h,bootstrap}(\alpha) = \frac{1}{B} \sum_{b=1}^{B} \hat{VaR}_{h,b}(\alpha)\)</span></p>
<p>Nous avons aussi calculé l’intervalle de confiance à 95% de la VaR historique bootstrap. Cet intervalle est donné par les quantiles empiriques d’ordre 2.5% et 97.5% des VaR historiques des B réplications bootstrap.</p>
<div id="cell-41" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> VaR_Hist_Bootstrap(returns, seuil, num_simulations, alpha_IC, n_B):</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    VaRs_boot <span class="op">=</span> np.zeros(num_simulations)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_simulations):</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        sample <span class="op">=</span> np.random.choice(returns, n_B, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        VaRs_boot[i] <span class="op">=</span> hist_var(sample, <span class="bu">len</span>(sample), <span class="bu">len</span>(sample), seuil)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    VaR <span class="op">=</span> np.mean(VaRs_boot)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    lower_bound <span class="op">=</span> np.percentile(VaRs_boot, <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span><span class="op">-</span>alpha_IC) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    upper_bound <span class="op">=</span> np.percentile(VaRs_boot, <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span><span class="op">-</span>alpha_IC) <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    IC <span class="op">=</span> (lower_bound, upper_bound)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> VaR, IC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>seuil <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>seuil_IC <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>num_simulations <span class="op">=</span> <span class="dv">5000</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>n_B <span class="op">=</span> <span class="dv">251</span><span class="op">*</span><span class="dv">10</span> <span class="co">#on utilise 10 ans de données comme taille d'échantillon bootstrap</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>var_hist_boot, IC_hist_boot <span class="op">=</span> VaR_Hist_Bootstrap(train_close[<span class="st">"log_return"</span>], seuil, num_simulations,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                                                 seuil_IC, n_B) </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"La VaR historique bootstrap: </span><span class="sc">{</span>var_hist_boot<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"L'intervalle de confiance associé est: </span><span class="sc">{</span>IC_hist_boot<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR historique bootstrap: -0.03986492710978063
L'intervalle de confiance associé est: (-0.04339186830234299, -0.036106484963320654)</code></pre>
</div>
</div>
<p>Notre estimation bootstrap de la VaR se trouve bien dans l’intervalle de confiance à 90%. Nous pouvons donc conclure que notre estimation de la VaR est satisfaisante.</p>
</section>
<section id="backtesting-1" class="level2">
<h2 class="anchored" data-anchor-id="backtesting-1">Backtesting</h2>
<div id="cell-45" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_hist_boot <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"Non parametric Bootstrap VaR"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>list_exceptions_np_boot <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_hist_boot]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_np_boot], test_close[<span class="st">'log_return'</span>][list_exceptions_np_boot], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR Bootstrap non paramétrique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_np_boot)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR Bootstrap non paramétrique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_np_boot)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR Bootstrap non paramétrique est: 16
Le pourcentage d'exceptions pour la VaR Bootstrap non paramétrique est: 0.007383479464697739</code></pre>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>test_except_np_boot <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_np_boot), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_np_boot<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.2783933759125071</code></pre>
</div>
</div>
<p>Le test binomial vient confirmer les conclusions faites à partir de l’intervalle de confiance estimé.</p>
<div id="cell-49" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>ES_np_boot <span class="op">=</span> np.mean([r <span class="cf">for</span> r <span class="kw">in</span> train_close[<span class="st">'log_return'</span>] <span class="cf">if</span> r<span class="op">&lt;</span>var_hist_boot])</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"L'Expected Shortfall associée à la VaR calculée est: </span><span class="sc">{</span>ES_np_boot<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>L'Expected Shortfall associée à la VaR calculée est: -0.05028777316523479</code></pre>
</div>
</div>
</section>
</section>
<section id="méthodes-paramétriques-destimation-de-la-var" class="level1">
<h1>Méthodes paramétriques d’estimation de la VaR</h1>
<section id="var-gaussienne" class="level2">
<h2 class="anchored" data-anchor-id="var-gaussienne">VaR gaussienne</h2>
<p>La VaR gaussienne suppose que les rendements suivent une loi normale. Dans ce cas, on a <span class="math inline">\(P(R&lt;VaR_h(\alpha)) = 1-\alpha\)</span> qui est équivalent à <span class="math inline">\(P(\frac{R-\mu}{\sigma} &lt; \frac{VaR_h(\alpha)-\mu}{\sigma}) = 1-\alpha\)</span> en supposant que R suit une loi normale de moyenne <span class="math inline">\(\mu\)</span> et d’écart type <span class="math inline">\(\sigma\)</span>. On a alors <span class="math inline">\(VaR_h(\alpha) = \mu + \sigma \Phi^{-1}(1-\alpha)\)</span>. On peut estimer les paramètres à partir de l’échantillon. On a alors <span class="math inline">\(\hat{VaR}_h(\alpha) = \hat{\mu} + \hat{\sigma} \Phi^{-1}(1-\alpha)\)</span>.</p>
<div id="cell-53" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> var_gaussienne(returns, index, fenetre, seuil):</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    rendements <span class="op">=</span> returns[index<span class="op">-</span>fenetre:index]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    mean_returns <span class="op">=</span> np.mean(rendements)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    sd_returns <span class="op">=</span> np.std(rendements)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    VaR <span class="op">=</span> mean_returns <span class="op">+</span> sd_returns <span class="op">*</span> stats.norm.ppf(<span class="dv">1</span><span class="op">-</span>seuil)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> VaR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-54" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">## VaR gaussienne sur base d'apprentissage</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>var_gaus <span class="op">=</span> var_gaussienne(train_close[<span class="st">"log_return"</span>], train_size, <span class="dv">251</span><span class="op">*</span><span class="dv">10</span>, <span class="fl">0.99</span>) <span class="co">#on utilise 10 ans comme fenêtre</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(var_gaus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-0.034948710985183845</code></pre>
</div>
</div>
<section id="validation" class="level3">
<h3 class="anchored" data-anchor-id="validation">Validation</h3>
<div id="cell-56" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analyse graphique avec les densités des distributions</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>plt.hist(train_close[<span class="st">"log_return"</span>], bins<span class="op">=</span><span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'blue'</span>, label <span class="op">=</span> <span class="st">'log rendements'</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(var_gaus, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'VaR Gaussienne (</span><span class="sc">{</span>var_gaus<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> plt.xlim()</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> stats.norm.pdf(x, np.mean(train_close[<span class="st">"log_return"</span>]), np.std(train_close[<span class="st">"log_return"</span>]))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p, label <span class="op">=</span> <span class="st">'Loi normale'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>On remarque que la queue de la loi normale n’est pas assez lourde pour nos données. La loi normale aura donc tendance à mal estimer les queues de distribution.</p>
<div id="cell-58" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Analyse graphique avec le QQ-plot</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>probplot <span class="op">=</span> stats.probplot(train_close[<span class="st">"log_return"</span>], </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                        sparams <span class="op">=</span> (np.mean(train_close[<span class="st">"log_return"</span>]), np.std(train_close[<span class="st">"log_return"</span>])), </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                        dist<span class="op">=</span><span class="st">'norm'</span>, plot<span class="op">=</span>plt)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>plt.plot(probplot[<span class="dv">0</span>][<span class="dv">0</span>], probplot[<span class="dv">0</span>][<span class="dv">0</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'QQ-plot'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>Text(0.5, 1.0, 'QQ-plot')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-29-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nous constatons que lorsqu’on utilise la loi normale pour la modélisation de la VaR, au niveau des queues de distribution,les quantiles théoriques sont moins élévés que les quantiles empiriques à gauche et plus élevés à droite. Cela signifie que la loi normale sous-estime la probabilité d’exception. La loi normale semble donc ne pas être adaptée pour modéliser la VaR.</p>
<div id="cell-60" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Test d'adéquation</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de Kolmogorov-Smirnov</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>ks_statistic, ks_p_value <span class="op">=</span> stats.kstest(train_close[<span class="st">"log_return"</span>], <span class="st">'norm'</span>, args <span class="op">=</span> (np.mean(train_close[<span class="st">"log_return"</span>]), np.std(train_close[<span class="st">"log_return"</span>])))</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test de Kolmogorov-Smirnov - Statistique : </span><span class="sc">{</span>ks_statistic<span class="sc">}</span><span class="ss">,</span><span class="ch">\n</span><span class="ss">P-value : </span><span class="sc">{</span>ks_p_value<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test de Kolmogorov-Smirnov - Statistique : 0.05703854924225127,
P-value : 7.95942063378766e-19</code></pre>
</div>
</div>
<p>On rejette l’hypothèse nulle selon laquelle les log rendements suivent une distribution normale.</p>
</section>
<section id="représentation-graphique" class="level3">
<h3 class="anchored" data-anchor-id="représentation-graphique">Représentation graphique</h3>
<div id="cell-63" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_gaus <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"gaussian VaR"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>list_exceptions_gaus <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_gaus]</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_gaus], test_close[<span class="st">'log_return'</span>][list_exceptions_gaus], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="analyse-des-exceptions" class="level3">
<h3 class="anchored" data-anchor-id="analyse-des-exceptions">Analyse des exceptions</h3>
<div id="cell-65" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR gaussienne est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_gaus)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR gaussienne est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_gaus)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR gaussienne est: 24
Le pourcentage d'exceptions pour la VaR gaussienne est: 0.011075219197046609</code></pre>
</div>
</div>
<div id="cell-66" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>test_except_gaus <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_gaus), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_gaus<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.5883566372303766</code></pre>
</div>
</div>
<p>La pvalue du test est supérieure au seuil de 5%. On ne peut donc pas rejeter l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%.</p>
</section>
<section id="var-gaussienne-à-10-jours" class="level3">
<h3 class="anchored" data-anchor-id="var-gaussienne-à-10-jours">VaR gaussienne à 10 jours</h3>
<div id="cell-69" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Var gaussienne à 10 jours par la méthode de scaling</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>periode <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>var_gaus_scaling <span class="op">=</span> np.sqrt(periode)<span class="op">*</span>var_gaus</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"La VaR gaussienne à 10 jours par la méthode de scaling est: </span><span class="sc">{</span>var_gaus_scaling<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR gaussienne à 10 jours par la méthode de scaling est: -0.11051752800012811</code></pre>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">## VaR gaussienne à 10 jours par la méthode de diffusion</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> random</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>periode <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>n_simul <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>S0 <span class="op">=</span> train_close[<span class="st">'Close'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>mean_returns <span class="op">=</span> np.mean(train_close[<span class="st">"log_return"</span>])</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>sd_returns <span class="op">=</span> np.std(train_close[<span class="st">"log_return"</span>])</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>simulations <span class="op">=</span> []</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(n_simul):</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    simul_k<span class="op">=</span>[S0]</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(periode):</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>        Z <span class="op">=</span> random.standard_normal()</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>        dS <span class="op">=</span> simul_k[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>mean_returns <span class="op">+</span> simul_k[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>sd_returns<span class="op">*</span>Z</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>        simul_k.append(simul_k[<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span>dS)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    simulations.append(simul_k)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>rend10 <span class="op">=</span> [np.log(simul[<span class="dv">10</span>] <span class="op">/</span> S0) <span class="cf">for</span> simul <span class="kw">in</span> simulations]</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>var_gaus_diff <span class="op">=</span> np.percentile(rend10, <span class="dv">100</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>alpha))</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"La VaR gaussienne à 10 jours par la méthode de diffusion est: </span><span class="sc">{</span>var_gaus_diff<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR gaussienne à 10 jours par la méthode de diffusion est: -0.10788230585355442</code></pre>
</div>
</div>
</section>
<section id="var-gaussienne-pondérée" class="level3">
<h3 class="anchored" data-anchor-id="var-gaussienne-pondérée">VaR gaussienne pondérée :</h3>
<p>Une façon de corriger la VaR, est de pondérer la moyenne et l’écart type des rendements. On peut utiliser une moyenne mobile pondérée.</p>
<div id="cell-72" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> var_gaussienne_ewma(returns, index, fenetre, seuil, lambd):</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    rendements <span class="op">=</span> returns[index<span class="op">-</span>fenetre:index]</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(rendements)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    poids <span class="op">=</span> [(lambd<span class="op">**</span>i)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>lambd) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    denom <span class="op">=</span> <span class="bu">sum</span>(poids)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    poids_pond <span class="op">=</span> [poid<span class="op">/</span>denom <span class="cf">for</span> poid <span class="kw">in</span> poids]</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    moy_pond <span class="op">=</span> np.<span class="bu">sum</span>([poids_pond[i]<span class="op">*</span>rendements[n<span class="op">-</span>i<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)])</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    variance_pond <span class="op">=</span> np.<span class="bu">sum</span>([poids_pond[i]<span class="op">*</span>(rendements[n<span class="op">-</span>i<span class="op">-</span><span class="dv">1</span>]<span class="op">-</span>moy_pond)<span class="op">**</span><span class="dv">2</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)])</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    VaR <span class="op">=</span> moy_pond <span class="op">+</span> np.sqrt(variance_pond) <span class="op">*</span> stats.norm.ppf(<span class="dv">1</span><span class="op">-</span>seuil)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> moy_pond, variance_pond, VaR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-73" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Calcul </span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>lambd1<span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>lambd2 <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>lambd3 <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>moy_pond1, variance_pond1, VaR1 <span class="op">=</span> var_gaussienne_ewma(train_close[<span class="st">"log_return"</span>], train_size, <span class="dv">251</span><span class="op">*</span><span class="dv">10</span>, <span class="fl">0.99</span>, lambd1)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>moy_pond2, variance_pond2, VaR2 <span class="op">=</span> var_gaussienne_ewma(train_close[<span class="st">"log_return"</span>], train_size, <span class="dv">251</span><span class="op">*</span><span class="dv">10</span>, <span class="fl">0.99</span>, lambd2)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>moy_pond3, variance_pond3, VaR3 <span class="op">=</span> var_gaussienne_ewma(train_close[<span class="st">"log_return"</span>], train_size, <span class="dv">251</span><span class="op">*</span><span class="dv">10</span>, <span class="fl">0.99</span>, lambd3)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>list_exceptions_gaus1 <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>VaR1]</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">100</span><span class="op">*</span><span class="st">"_"</span><span class="op">+</span> <span class="ss">f"</span><span class="ch">\n</span><span class="ss">lambda = </span><span class="sc">{</span>lambd1<span class="sc">}</span><span class="ch">\n</span><span class="ss">Moyenne pondérée: </span><span class="sc">{</span>moy_pond1<span class="sc">}</span><span class="ch">\n</span><span class="ss">Variance pondérée: </span><span class="sc">{</span>variance_pond1<span class="sc">}</span><span class="ch">\n</span><span class="ss">VaR gaussienne EWMA: </span><span class="sc">{</span>VaR1<span class="sc">}</span><span class="ch">\n</span><span class="ss">Nombre d'exceptions: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_gaus1)<span class="sc">}</span><span class="ch">\n</span><span class="ss">Pourcentage d'exceptions: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_gaus1)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Premier graphique</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical train log returns"</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(x<span class="op">=</span>ts_close.index[train_size <span class="op">-</span> <span class="dv">251</span><span class="op">*</span><span class="dv">10</span> <span class="op">-</span> <span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical test log returns"</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(ts_close.index[train_size:], [VaR1 <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="ss">f"Gaussian EWMA VaR (lambda= </span><span class="sc">{</span>lambd1<span class="sc">}</span><span class="ss">)"</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].scatter(test_close.index[list_exceptions_gaus1], [test_close[<span class="st">'log_return'</span>][i] <span class="cf">for</span> i <span class="kw">in</span> list_exceptions_gaus1], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Lambda = 0.9'</span>)</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>list_exceptions_gaus2 <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>VaR2]</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">100</span><span class="op">*</span><span class="st">"_"</span><span class="op">+</span> <span class="ss">f"</span><span class="ch">\n</span><span class="ss">lambda = </span><span class="sc">{</span>lambd2<span class="sc">}</span><span class="ch">\n</span><span class="ss">Moyenne pondérée: </span><span class="sc">{</span>moy_pond2<span class="sc">}</span><span class="ch">\n</span><span class="ss">Variance pondérée: </span><span class="sc">{</span>variance_pond2<span class="sc">}</span><span class="ch">\n</span><span class="ss">VaR gaussienne EWMA: </span><span class="sc">{</span>VaR2<span class="sc">}</span><span class="ch">\n</span><span class="ss">Nombre d'exceptions: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_gaus2)<span class="sc">}</span><span class="ch">\n</span><span class="ss">Pourcentage d'exceptions: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_gaus2)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Deuxième graphique</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical train log returns"</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axvline(x<span class="op">=</span>ts_close.index[train_size <span class="op">-</span> <span class="dv">251</span><span class="op">*</span><span class="dv">10</span> <span class="op">-</span> <span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical test log returns"</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(ts_close.index[train_size:], [VaR2 <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="ss">f"Gaussian EWMA VaR (lambda= </span><span class="sc">{</span>lambd2<span class="sc">}</span><span class="ss">)"</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(test_close.index[list_exceptions_gaus2], [test_close[<span class="st">'log_return'</span>][i] <span class="cf">for</span> i <span class="kw">in</span> list_exceptions_gaus2], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Lambda = 0.95'</span>)</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>list_exceptions_gaus3 <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>VaR3]</span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">100</span><span class="op">*</span><span class="st">"_"</span><span class="op">+</span> <span class="ss">f"</span><span class="ch">\n</span><span class="ss">lambda = </span><span class="sc">{</span>lambd3<span class="sc">}</span><span class="ch">\n</span><span class="ss">Moyenne pondérée: </span><span class="sc">{</span>moy_pond3<span class="sc">}</span><span class="ch">\n</span><span class="ss">Variance pondérée: </span><span class="sc">{</span>variance_pond3<span class="sc">}</span><span class="ch">\n</span><span class="ss">VaR gaussienne EWMA: </span><span class="sc">{</span>VaR3<span class="sc">}</span><span class="ch">\n</span><span class="ss">Nombre d'exceptions: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_gaus3)<span class="sc">}</span><span class="ch">\n</span><span class="ss">Pourcentage d'exceptions: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_gaus3)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Troisième graphique</span></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical train log returns"</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].axvline(x<span class="op">=</span>ts_close.index[train_size <span class="op">-</span> <span class="dv">251</span><span class="op">*</span><span class="dv">10</span> <span class="op">-</span> <span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical test log returns"</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(ts_close.index[train_size:], [VaR3 <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="ss">f"Gaussian EWMA VaR (lambda= </span><span class="sc">{</span>lambd3<span class="sc">}</span><span class="ss">)"</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].scatter(test_close.index[list_exceptions_gaus3], [test_close[<span class="st">'log_return'</span>][i] <span class="cf">for</span> i <span class="kw">in</span> list_exceptions_gaus3], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">'Lambda = 0.99'</span>)</span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend()</span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>____________________________________________________________________________________________________
lambda = 0.9
Moyenne pondérée: 0.003249804834415138
Variance pondérée: 0.00010705135281489561
VaR gaussienne EWMA: -0.020819898531762165
Nombre d'exceptions: 67
Pourcentage d'exceptions: 0.03091832025842178
____________________________________________________________________________________________________
lambda = 0.95
Moyenne pondérée: 0.0022669059482574804
Variance pondérée: 0.00018626179534529804
VaR gaussienne EWMA: -0.029482569211930626
Nombre d'exceptions: 35
Pourcentage d'exceptions: 0.016151361329026302
____________________________________________________________________________________________________
lambda = 0.99
Moyenne pondérée: 0.0004258509321423379
Variance pondérée: 0.00022231763612603746
VaR gaussienne EWMA: -0.034260739803697746
Nombre d'exceptions: 26
Pourcentage d'exceptions: 0.011998154130133826</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-37-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-74" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>test_except_gaus1 <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_gaus1), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_gaus1<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 3.0751996180426066e-15</code></pre>
</div>
</div>
<div id="cell-75" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>test_except_gaus2 <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_gaus2), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_gaus2<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.006672492499143829</code></pre>
</div>
</div>
<div id="cell-76" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>test_except_gaus3 <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_gaus3), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_gaus3<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.3304256909292766</code></pre>
</div>
</div>
<p>Seule la VaR estimée avec <span class="math inline">\(\lambda\)</span> = 0.99 a une p value supérieure au seuil de 5%.</p>
</section>
</section>
</section>
<section id="var-dynamique" class="level1">
<h1>VaR dynamique :</h1>
<p>Une autre façon de corriger la VaR est de la modéliser par un modèle dynamique. Ici on a pas besoin de diviser notre échantillon en base d’apprentissage et de test. Il suffit de choisir une fenêtre de temps pour estimer notre VaR. Ici nous allons choisir (251 jours) soit un an en considérant les jours ouvrés. Puis nous allons la faire glisser de 1 jour en 1 jour et la backtester le lendemain</p>
<p>La fonction hist_var écrite pour la VaR non paramétrique a été conçue pour pouvoir également calculer la VaR dynamique. Il suffit pour cela de faire varier l’index en paramètre.</p>
<div id="cell-80" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>vars_dyn <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> index: hist_var(<span class="bu">list</span>(ts_close[<span class="st">'log_return'</span>]), index, <span class="dv">251</span>, <span class="fl">0.99</span>), <span class="bu">range</span>(<span class="dv">251</span>, <span class="bu">len</span>(ts_close[<span class="st">'log_return'</span>])))) <span class="co">#on suppose qu'une année correspond à 251 jours ouvrés</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="réprésentation-graphique" class="level3">
<h3 class="anchored" data-anchor-id="réprésentation-graphique">Réprésentation graphique</h3>
<div id="cell-82" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index, ts_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">251</span>:], vars_dyn, label<span class="op">=</span><span class="st">'VaR dynamique'</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>list_exceptions_dyn <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">251</span>, <span class="bu">len</span>(ts_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> ts_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>vars_dyn[i<span class="op">-</span><span class="dv">251</span>]]</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(ts_close.index[list_exceptions_dyn], ts_close[<span class="st">'log_return'</span>][list_exceptions_dyn], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-83" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR dynamique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_dyn)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR dynamique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_dyn)<span class="op">/</span><span class="bu">len</span>(vars_dyn)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR dynamique est: 133
Le pourcentage d'exceptions pour la VaR dynamique est: 0.01580135440180587</code></pre>
</div>
</div>
<div id="cell-84" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>test_except_dyn <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_dyn), <span class="bu">len</span>(vars_dyn), p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_dyn<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 7.255952037114441e-07</code></pre>
</div>
</div>
<p>La p-value du test binomial est en dessous du seuil de 5%. On rejette donc l’hypothèse selon laquelle la probabilité d’exception est de 1%. Le modèle VaR estimé n’est pas satisfaisant.</p>
</section>
</section>
<section id="var-skew-student" class="level1">
<h1>VaR skew-Student :</h1>
<p>La loi student a pour avantage de prendre en compte les queues de distribution des rendements. Dans cette partie, nous allons supposer que les rendements suivent une loi skew-student généralisée. Nous allons estimer les paramètres de la loi skew-student à partir de la série des log rendements par maximum de vraisemblance. Enfin, nous allons calculer la VaR à partir des paramètres estimés.</p>
<section id="fonction-de-densité-de-la-skew-student" class="level3">
<h3 class="anchored" data-anchor-id="fonction-de-densité-de-la-skew-student">fonction de densité de la skew-student</h3>
<div id="cell-88" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> special </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SkStudentPdf(x:<span class="bu">float</span>, mu, sigma, gamma, nu):</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    point <span class="op">=</span> gamma<span class="op">*</span>(x<span class="op">-</span>mu)<span class="op">*</span>np.sqrt((nu<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>(((x<span class="op">-</span>mu)<span class="op">/</span>sigma)<span class="op">**</span><span class="dv">2</span><span class="op">+</span>nu))<span class="op">/</span>sigma</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span><span class="op">*</span>stats.t.pdf(x, df <span class="op">=</span> nu, loc <span class="op">=</span> mu, scale<span class="op">=</span>sigma)<span class="op">*</span>stats.t.cdf(point, nu<span class="op">+</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-89" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>sigma<span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>gamma <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>nu <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>SkStudentPdf(<span class="fl">0.5</span>, mu, sigma, gamma, nu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>0.022681128494391908</code></pre>
</div>
</div>
</section>
<section id="fonction-de-log-vraisemblance" class="level3">
<h3 class="anchored" data-anchor-id="fonction-de-log-vraisemblance">Fonction de log vraisemblance</h3>
<div id="cell-91" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> minus_log_vrais(params, returns):</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    mu, sigma, gamma, nu <span class="op">=</span> params</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    densities_values <span class="op">=</span> SkStudentPdf(returns, mu, sigma, gamma, nu)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    log_densities_values <span class="op">=</span> [np.log(value) <span class="cf">for</span> value <span class="kw">in</span> densities_values]</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>np.<span class="bu">sum</span>(log_densities_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fonction-doptimisation" class="level3">
<h3 class="anchored" data-anchor-id="fonction-doptimisation">fonction d’optimisation</h3>
<div id="cell-93" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction d'optimisation </span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optim_func(data):</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimer les paramètres par maximum de vraisemblance</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    initial_guess <span class="op">=</span> [np.mean(data), np.std(data), <span class="dv">1</span>, <span class="dv">4</span>]</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> minimize(minus_log_vrais, initial_guess, args<span class="op">=</span>(data,), method<span class="op">=</span><span class="st">'Nelder-Mead'</span>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtenez les paramètres estimés</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    est_params <span class="op">=</span> result.x</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> est_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimation-des-paramètres-sur-base-dapprentissage" class="level3">
<h3 class="anchored" data-anchor-id="estimation-des-paramètres-sur-base-dapprentissage">Estimation des paramètres sur base d’apprentissage</h3>
<div id="cell-95" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>est_params <span class="op">=</span> optim_func(train_close[<span class="st">'log_return'</span>])</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>mu_est, sigma_est, gamma_est, nu_est <span class="op">=</span> est_params</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"La valeur estimée des paramètres est:</span><span class="ch">\n</span><span class="ss">mu: </span><span class="sc">{</span>mu_est<span class="sc">}</span><span class="ch">\n</span><span class="ss">sigma: </span><span class="sc">{</span>sigma_est<span class="sc">}</span><span class="ch">\n</span><span class="ss">gamma: </span><span class="sc">{</span>gamma_est<span class="sc">}</span><span class="ch">\n</span><span class="ss">nu: </span><span class="sc">{</span>nu_est<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La valeur estimée des paramètres est:
mu: 0.0024085659232927596
sigma: 0.01024400244829116
gamma: -0.2295168624277934
nu: 3.9899826715655733</code></pre>
</div>
</div>
<p>Le code ci-dessus a consisté à construire la densité de la skew-student, la fonction de la log vraisemblance et la fonction d’optimisation. Nous avons ensuite estimé les paramètres de la skew-student sur la base d’apprentissage. Nous pouvons évaluer la qualité de notre estimation par des analyses graphiques avant de passer à la modélisation de la VaR.</p>
</section>
<section id="comparaison-entre-densité-théorique-et-densité-empirique-de-la-skew-student-sur-les-log-rendements" class="level2">
<h2 class="anchored" data-anchor-id="comparaison-entre-densité-théorique-et-densité-empirique-de-la-skew-student-sur-les-log-rendements">Comparaison entre densité théorique et densité empirique de la skew-student sur les log rendements</h2>
<div id="cell-98" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>x_values <span class="op">=</span> np.linspace(<span class="bu">min</span>(test_close[<span class="st">'log_return'</span>]), <span class="bu">max</span>(test_close[<span class="st">'log_return'</span>]), <span class="dv">1000</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>mu, sigma, skew, df <span class="op">=</span>est_params</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>theoretical_density <span class="op">=</span> SkStudentPdf(x_values, mu, sigma, skew, df)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>plt.hist(test_close[<span class="st">'log_return'</span>], bins<span class="op">=</span><span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Données empiriques'</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>plt.plot(x_values, theoretical_density, label<span class="op">=</span><span class="st">'Densité Skew Student'</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnalisation du graphique</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Rendements'</span>)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Densité'</span>)</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Comparaison entre les données et la densité théorique'</span>)</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du graphique</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le graphique ci-dessus est satisfaisant. La densité théorique de la skew-student est très proche de la densité empirique des log rendements. Nous pouvons donc conclure que la skew-student est une bonne modélisation des log rendements.</p>
<section id="fonction-de-repartition-de-la-skew-student-et-fonction-quantile" class="level3">
<h3 class="anchored" data-anchor-id="fonction-de-repartition-de-la-skew-student-et-fonction-quantile">Fonction de repartition de la skew-student et fonction quantile</h3>
<div id="cell-101" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Intégration de la fonction de densité</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> integrate</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize_scalar</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> integrale_SkewStudent(x):</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    borne_inf <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    resultat_integration, erreur <span class="op">=</span> integrate.quad(<span class="kw">lambda</span> x: SkStudentPdf(x, mu_est, sigma_est, gamma_est, nu_est), borne_inf, x)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> resultat_integration</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fonc_minimize(x, alpha):</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> integrale_SkewStudent(x)<span class="op">-</span>alpha</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(value)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> theoretical_quantile(alpha):</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> alpha <span class="op">&lt;</span><span class="dv">0</span> <span class="kw">or</span> alpha <span class="op">&gt;</span><span class="dv">1</span>:</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Veuillez entrer un niveau alpha entre 0 et 1"</span>)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>        resultat_minimisation <span class="op">=</span> minimize_scalar(<span class="kw">lambda</span> x: fonc_minimize(x, alpha))</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> resultat_minimisation.x</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le code ci-dessus nous a permis de construire la fonction de repartition de la skew-student ainsi que la fonction quantile qui est l’inverse de cette fonction de repartition. Cette fonction quantile est le coeur de la modélisation de la VaR.</p>
</section>
<section id="qq-plot" class="level3">
<h3 class="anchored" data-anchor-id="qq-plot">QQ plot :</h3>
<p>Le graphique de QQ plot nous permettra de discuter de la qualité d’ajustement de la loi skew-student à la série des log rendements.</p>
<div id="cell-104" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>niveaux_quantiles <span class="op">=</span> np.arange(<span class="fl">0.001</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>quantiles_empiriques <span class="op">=</span> np.quantile(train_close[<span class="st">'log_return'</span>], niveaux_quantiles)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques <span class="op">=</span> [theoretical_quantile(alpha) <span class="cf">for</span> alpha <span class="kw">in</span> niveaux_quantiles]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-105" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le QQ plot</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques, quantiles_empiriques)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques, quantiles_theoriques, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'QQ Plot - Quantiles empiriques vs Quantiles théoriques'</span>)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (distribution Skew Student)'</span>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nous constatons que la loi skew-student est une bonne approximation de la distribution des log rendements. Même si on constate des écarts aux queues de distribution, la loi skew-student semble bien modéliser la distribution des log rendements.</p>
</section>
<section id="comparaison-entre-loi-gaussienne-et-loi-de-skew-student" class="level3">
<h3 class="anchored" data-anchor-id="comparaison-entre-loi-gaussienne-et-loi-de-skew-student">comparaison entre loi gaussienne et loi de Skew Student</h3>
<div id="cell-108" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>probplot <span class="op">=</span> stats.probplot(train_close[<span class="st">"log_return"</span>], </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                        sparams <span class="op">=</span> (np.mean(train_close[<span class="st">"log_return"</span>]), np.std(train_close[<span class="st">"log_return"</span>])), </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                        dist<span class="op">=</span><span class="st">'norm'</span>, plot<span class="op">=</span>plt)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>plt.plot(probplot[<span class="dv">0</span>][<span class="dv">0</span>], probplot[<span class="dv">0</span>][<span class="dv">0</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (distribution loi normale)'</span>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ-plot d'une modélisation par loi normale"</span>)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques, quantiles_empiriques)</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques, quantiles_theoriques, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi Skew Student"</span>)</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (distribution Skew Student)'</span>)</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-54-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Comme on peut le voir sur le graphique ci-dessus, la loi skew-student est une meilleure approximation de la distribution des log rendements que la loi normale. En effet, les écarts aux queues de distribution sont moins importants pour la loi skew-student que pour la loi normale.</p>
</section>
<section id="calcul-de-la-var-skew-student" class="level3">
<h3 class="anchored" data-anchor-id="calcul-de-la-var-skew-student">Calcul de la VaR Skew Student</h3>
<div id="cell-111" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> var_skewstudent(returns, index, fenetre, seuil):</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    rendements <span class="op">=</span> returns[index<span class="op">-</span>fenetre:index]</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    mean_returns <span class="op">=</span> np.mean(rendements)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    sd_returns <span class="op">=</span> np.std(rendements)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    VaR <span class="op">=</span>  theoretical_quantile(<span class="dv">1</span><span class="op">-</span>seuil)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> VaR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-112" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">## VaR Skew Student sur base d'apprentissage</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>var_skew <span class="op">=</span> var_skewstudent(train_close[<span class="st">"log_return"</span>], train_size, train_size, <span class="fl">0.99</span>) <span class="co">#on utilise 10 ans comme fenêtre</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(var_skew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-0.03966428515565673</code></pre>
</div>
</div>
<div id="cell-113" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_skew <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"VaR Skew Student"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>list_exceptions_skew <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_skew]</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_skew], test_close[<span class="st">'log_return'</span>][list_exceptions_skew], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-57-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-114" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR Skew student est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_skew)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR Skew Student est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_skew)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR Skew student est: 16
Le pourcentage d'exceptions pour la VaR Skew Student est: 0.007383479464697739</code></pre>
</div>
</div>
<div id="cell-115" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>test_except_skew <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_skew), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_skew<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.2783933759125071</code></pre>
</div>
</div>
<p>La p-value du test binomial est au dessus du seuil de 5%. On ne peut donc pas rejeter l’hypothèse selon laquelle la probabilité d’exception est de 1%. Le modèle VaR Skew Student estimé semble donc satisfaisant.</p>
</section>
</section>
</section>
<section id="var-tve-approche-maxima-par-bloc" class="level1">
<h1>VaR TVE: Approche maxima par bloc</h1>
<section id="construction-de-léchantillon-de-maxima" class="level3">
<h3 class="anchored" data-anchor-id="construction-de-léchantillon-de-maxima">Construction de l’échantillon de maxima</h3>
<p>La TVE s’intéresse aux queues de distribution droite (maximum, excès par valeurs supérieures). On commence donc par convertir nos données en prenant l’opposé des données</p>
<div id="cell-120" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>minus_train_returns <span class="op">=</span> [<span class="op">-</span>rtrn <span class="cf">for</span> rtrn <span class="kw">in</span> train_close[<span class="st">"log_return"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-121" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> construct_max_data(returns, block_size):</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(returns)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    num_blocks <span class="op">=</span> n <span class="op">//</span> block_size</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    maxima_sample <span class="op">=</span> []</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_blocks):</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>        block_start <span class="op">=</span> i <span class="op">*</span> block_size</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>        block_end <span class="op">=</span> (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> block_size</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>        block_data <span class="op">=</span> returns[block_start:block_end]</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>        max_in_block <span class="op">=</span> np.<span class="bu">max</span>(block_data)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>        maxima_sample.append(max_in_block)</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> maxima_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-122" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>s<span class="op">=</span> <span class="dv">21</span> <span class="co"># nombre de jours ouvrés dans le mois</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>maxima_train_sample <span class="op">=</span> construct_max_data(minus_train_returns, s)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>plt.plot(maxima_train_sample ,color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"historical maxima of log returns"</span>)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Value'</span>)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-62-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gumbel-plot" class="level3">
<h3 class="anchored" data-anchor-id="gumbel-plot">Gumbel Plot</h3>
<div id="cell-124" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_gumbel <span class="op">=</span> []</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(maxima_train_sample)<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> <span class="op">-</span>np.log(<span class="op">-</span>np.log((i<span class="op">-</span><span class="fl">0.5</span>)<span class="op">/</span><span class="bu">len</span>(maxima_train_sample)))</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    quantiles_theoriques_gumbel.append(val)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Tracer le Gumbel plot</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_gumbel, np.sort(maxima_train_sample), marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Gumbel Plot'</span>)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques de Gumbel'</span>)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles observés'</span>)</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-63-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le Gumbel plot semble relativement linéaire. Ainsi il semble que l’hypothèse selon laquelle <span class="math inline">\(\xi\)</span> est nul soit acceptable. La distribution adaptée à nos données semble donc être une distribution de Gumbel.</p>
<div id="cell-126" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> genextreme <span class="im">as</span> gev</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> gumbel_r</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>params_gev <span class="op">=</span> gev.fit(maxima_train_sample)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>params_gumbel <span class="op">=</span> gumbel_r.fit(maxima_train_sample)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les paramètres estimés</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Paramètres estimés de la distribution GEV:"</span>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Forme (xi) ="</span>, params_gev[<span class="dv">0</span>])</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Localisation (mu) ="</span>, params_gev[<span class="dv">1</span>])</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Echelle (sigma) ="</span>, params_gev[<span class="dv">2</span>])</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">150</span><span class="op">*</span><span class="st">"-"</span>)</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Paramètres estimés de la distribution de Gumbel (xi nul):"</span>)</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Localisation (mu) ="</span>, params_gumbel[<span class="dv">0</span>])</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Echelle (sigma) ="</span>, params_gumbel[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Paramètres estimés de la distribution GEV:
Forme (xi) = -0.7718190267913189
Localisation (mu) = 0.01718333713722632
Echelle (sigma) = 0.011341548066836963
------------------------------------------------------------------------------------------------------------------------------------------------------
Paramètres estimés de la distribution de Gumbel (xi nul):
Localisation (mu) = 0.01878066648242991
Echelle (sigma) = 0.009390992075910511</code></pre>
</div>
</div>
<div id="cell-127" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>plt.hist(maxima_train_sample, bins<span class="op">=</span><span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="st">'Maxima observées'</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> plt.xlim()</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Densité GEV ajustée</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>p_gev <span class="op">=</span> gev.pdf(x, <span class="op">*</span>params_gev)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p_gev, <span class="st">'k'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'GEV ajustée'</span>)</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Densité Gumbel ajustée</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>p_gumbel <span class="op">=</span> gumbel_r.pdf(x, <span class="op">*</span>params_gumbel)</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p_gumbel, <span class="st">'r'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Gumbel ajustée'</span>)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> <span class="st">"Comparaison GEV vs Gumbel"</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>plt.title(title)</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-65-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>On remarque la loi GEV (<span class="math inline">\(\xi\)</span> non nul) estimée a une queue plus lourde que la loi de Gumbel (<span class="math inline">\(\xi\)</span> nul) estimée. Toutefois, de manière générale, la distribution de Gumbel estimée semble plus coller à l’histogramme représenté.</p>
<div id="cell-129" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>niveaux_quantiles <span class="op">=</span> np.arange(<span class="fl">0.001</span>,<span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>quantiles_empiriques_TVE <span class="op">=</span> np.quantile(maxima_train_sample, niveaux_quantiles) </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_GEV <span class="op">=</span> gev.ppf(niveaux_quantiles, params_gev[<span class="dv">0</span>], loc <span class="op">=</span> params_gev[<span class="dv">1</span>], scale <span class="op">=</span> params_gev[<span class="dv">2</span>])</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_Gumb <span class="op">=</span> gumbel_r.ppf(niveaux_quantiles, <span class="op">*</span>params_gumbel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-130" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_GEV, quantiles_empiriques_TVE)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques_GEV, quantiles_theoriques_GEV, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi GEV"</span>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (Loi GEV)'</span>)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_Gumb, quantiles_empiriques_TVE)</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques_Gumb, quantiles_theoriques_Gumb, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi Gumbel"</span>)</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (Loi Gumbel)'</span>)</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-67-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>La modélisation par loi de Gumbel semble beaucoup mieux correspondre aux données. Cette distribution semble également satisfaisante au vu de l’adéquation avec les quantiles empiriques. Nous utilisons donc cette loi pour la suite.</p>
</section>
<section id="calcul-de-la-var" class="level3">
<h3 class="anchored" data-anchor-id="calcul-de-la-var">Calcul de la VAR</h3>
<div id="cell-133" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>alpha_bm <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>s<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>alpha)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>var_TVE_MB <span class="op">=</span> <span class="op">-</span>gumbel_r.ppf(alpha_bm, <span class="op">*</span>params_gumbel)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"VaR TVE par maxima par blocs : "</span>, var_TVE_MB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>VaR TVE par maxima par blocs :  -0.03235159588828838</code></pre>
</div>
</div>
</section>
<section id="backtesting-2" class="level3">
<h3 class="anchored" data-anchor-id="backtesting-2">Backtesting</h3>
<div id="cell-135" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_TVE_MB <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"VaR TVE MB"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>list_exceptions_TVE_MB <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>].iloc[i]<span class="op">&lt;</span>var_TVE_MB]</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_TVE_MB], test_close[<span class="st">'log_return'</span>].iloc[list_exceptions_TVE_MB], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-69-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-136" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR TVE maxima par blocs est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_MB)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR TVE maxima par blocs est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_MB)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR TVE maxima par blocs est: 31
Le pourcentage d'exceptions pour la VaR TVE maxima par blocs est: 0.01430549146285187</code></pre>
</div>
</div>
<div id="cell-137" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>test_except_TVE_MB <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_TVE_MB), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_TVE_MB<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.051029877183224145</code></pre>
</div>
</div>
<p>La p-value du test binomial est en dessous du seuil de 5%. On rejette donc l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Le modèle VaR TVE MB estimé ne semble donc pas satisfaisant.</p>
</section>
</section>
<section id="var-tve-approche-peak-over-threshold" class="level1">
<h1>VAR TVE: Approche Peak over threshold</h1>
<section id="fonction-pour-le-mean-excess-plot" class="level3">
<h3 class="anchored" data-anchor-id="fonction-pour-le-mean-excess-plot">Fonction pour le Mean Excess Plot</h3>
<div id="cell-141" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_excess_plot(returns):</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    sorted_returns <span class="op">=</span>np.sort(returns)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    listeu <span class="op">=</span> np.linspace(np.<span class="bu">min</span>(sorted_returns), np.<span class="bu">max</span>(sorted_returns), num <span class="op">=</span> <span class="dv">1000</span>)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    listeu <span class="op">=</span> listeu[listeu <span class="op">&lt;</span> np.percentile(listeu, <span class="dv">80</span>)] <span class="co">## Retirer les valeurs trop extrêmes</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    mean_excess <span class="op">=</span> []</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    n<span class="op">=</span><span class="bu">len</span>(sorted_returns)</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> u <span class="kw">in</span> listeu:</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> u <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>            terms <span class="op">=</span> []</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>            NU<span class="op">=</span><span class="dv">0</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>                term <span class="op">=</span> sorted_returns[i]<span class="op">-</span>u</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>                terms.append(<span class="bu">max</span>(term,<span class="dv">0</span>))</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> term <span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>                    NU <span class="op">=</span> NU <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>                mean_excess.append( (<span class="dv">1</span><span class="op">/</span>NU) <span class="op">*</span> np.<span class="bu">sum</span>(terms))</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>                listeu <span class="op">=</span> listeu[listeu<span class="op">!=</span>u]</span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>            listeu <span class="op">=</span> listeu[listeu<span class="op">!=</span>u]</span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>    plt.plot(listeu, mean_excess)</span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Mean excess Plot'</span>)</span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Moyenne des excès empirique'</span>)</span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Seuils'</span>)</span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>    plt.plot()</span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="détermination-de-u-par-analyse-graphique" class="level3">
<h3 class="anchored" data-anchor-id="détermination-de-u-par-analyse-graphique">Détermination de u par analyse graphique</h3>
<div id="cell-143" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>mean_excess_plot(minus_train_returns)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="fl">0.009</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="fl">0.031</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-73-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Par analyse graphique, nous pouvons garder u = 0.03</p>
</section>
<section id="estimation-des-paramètres-de-la-loi-gpd" class="level3">
<h3 class="anchored" data-anchor-id="estimation-des-paramètres-de-la-loi-gpd">Estimation des paramètres de la loi GPD</h3>
<div id="cell-146" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>excess_values <span class="op">=</span> [value <span class="op">-</span> u <span class="cf">for</span> value <span class="kw">in</span> minus_train_returns <span class="cf">if</span> value <span class="op">&gt;=</span> u]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-147" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> genpareto</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>params_gpd <span class="op">=</span> genpareto.fit(excess_values)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les paramètres estimés</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Paramètres estimés de la distribution GPD:"</span>)</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Forme (xi) ="</span>, params_gpd[<span class="dv">0</span>])</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Localisation (mu) ="</span>, params_gpd[<span class="dv">1</span>])</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Echelle (sigma) ="</span>, params_gpd[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Paramètres estimés de la distribution GPD:
Forme (xi) = 1.4010389110423458
Localisation (mu) = 0.00016228471050365933
Echelle (sigma) = 0.006463507758681829</code></pre>
</div>
</div>
</section>
<section id="validation-ex-ante" class="level3">
<h3 class="anchored" data-anchor-id="validation-ex-ante">Validation Ex ante</h3>
<div id="cell-149" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>plt.hist(excess_values, bins<span class="op">=</span><span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="st">'Données observées des excès'</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> plt.xlim()</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Densité GPD ajustée</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>p_gpd <span class="op">=</span> genpareto.pdf(x, <span class="op">*</span>params_gpd)</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p_gpd, <span class="st">'r'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'GPD ajustée'</span>)</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> <span class="st">"Distribution GPD"</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>plt.title(title)</span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-76-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nous remarquons que la distribution GPD correspond relativement bien à notre distribution des excès.</p>
<div id="cell-151" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>niveaux_quantiles <span class="op">=</span> np.arange(<span class="fl">0.01</span>, <span class="dv">1</span>, <span class="fl">0.01</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>quantiles_empiriques_POT <span class="op">=</span> np.quantile(excess_values, niveaux_quantiles)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_GDP <span class="op">=</span> genpareto.ppf(niveaux_quantiles, <span class="op">*</span>params_gpd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-152" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_GDP, quantiles_empiriques_POT)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(quantiles_theoriques_GDP, quantiles_theoriques_GDP, color='red', linestyle='dashed', linewidth=2, label='Première bissectrice')</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi GPD"</span>)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (Loi GPD)'</span>)</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-78-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le QQ plot estimé indique que les quantiles théoriques de la loi GPD sont beaucoup plus grands que les quantiles empiriques observés dans notre distribution des excès.</p>
</section>
<section id="calcul-de-la-var-1" class="level3">
<h3 class="anchored" data-anchor-id="calcul-de-la-var-1">Calcul de la VAR</h3>
<div id="cell-155" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>NU <span class="op">=</span> <span class="bu">len</span>([term <span class="cf">for</span> term <span class="kw">in</span> minus_train_returns <span class="cf">if</span> term<span class="op">-</span>u<span class="op">&gt;</span><span class="dv">0</span>])</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>alpha_pot <span class="op">=</span> <span class="dv">1</span><span class="op">-</span><span class="bu">len</span>(minus_train_returns)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>alpha)<span class="op">/</span>NU</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>var_TVE_POT <span class="op">=</span> <span class="op">-</span>genpareto.ppf(alpha_pot, <span class="op">*</span>params_gpd)<span class="op">-</span>u</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"VaR TVE Peak Over Threshold : "</span>,var_TVE_POT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>VaR TVE Peak Over Threshold :  -0.04029514148506361</code></pre>
</div>
</div>
</section>
<section id="backtesting-3" class="level3">
<h3 class="anchored" data-anchor-id="backtesting-3">Backtesting</h3>
<div id="cell-157" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_TVE_POT <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"VaR TVE POT"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>list_exceptions_TVE_POT <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>].iloc[i]<span class="op">&lt;</span>var_TVE_POT]</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_TVE_POT], test_close[<span class="st">'log_return'</span>].iloc[list_exceptions_TVE_POT], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-80-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-158" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR TVE Peak Over Threshold est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_POT)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR TVE Peak Over Threshold est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_POT)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR TVE Peak Over Threshold est: 14
Le pourcentage d'exceptions pour la VaR TVE Peak Over Threshold est: 0.006460544531610522</code></pre>
</div>
</div>
<div id="cell-159" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>test_except_TVE_POT <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_TVE_POT), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_TVE_POT<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.10473377125459593</code></pre>
</div>
</div>
<p>La p-value du test binomial est au dessus du seuil de 5%. On ne peut donc pas rejeter l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Le modèle VaR TVE MB estimé semble donc satisfaisant.</p>
</section>
</section>
<section id="comparaison-des-différentes-approches" class="level1">
<h1>Comparaison des différentes approches</h1>
<div id="cell-162" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>dict_comp <span class="op">=</span> {<span class="st">"Méthode"</span> : [<span class="st">"VaR non paramétrique"</span>, <span class="st">"VaR Bootstrap non paramétrique"</span>, <span class="st">"VaR gaussienne"</span>, <span class="st">'VaR Gaussienne EWMA (lambda =0.9)'</span>,</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'VaR Gaussienne EWMA (lambda =0.95)'</span>,<span class="st">'VaR Gaussienne EWMA (lambda =0.99)'</span>, <span class="st">"VaR dynamique"</span>, <span class="st">"VaR Skew Student"</span>, </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"VaR TVE MB"</span>, <span class="st">"VaR TVE POT"</span>], </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"VaR"</span>: [var_hist, var_hist_boot, var_gaus, VaR1, VaR2, VaR3, <span class="va">None</span>, var_skew, var_TVE_MB, var_TVE_POT],</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Nombre d'exceptions"</span>: [<span class="bu">len</span>(list_exceptions_np),<span class="bu">len</span>(list_exceptions_np_boot), <span class="bu">len</span>(list_exceptions_gaus),<span class="bu">len</span>(list_exceptions_gaus1),</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>                                            <span class="bu">len</span>(list_exceptions_gaus2),<span class="bu">len</span>(list_exceptions_gaus3),<span class="bu">len</span>(list_exceptions_dyn),<span class="bu">len</span>(list_exceptions_skew),</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>                                            <span class="bu">len</span>(list_exceptions_TVE_MB),<span class="bu">len</span>(list_exceptions_TVE_POT)],</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Taux d'exceptions"</span>: [<span class="bu">len</span>(list_exceptions_np)<span class="op">/</span>test_size,<span class="bu">len</span>(list_exceptions_np_boot)<span class="op">/</span>test_size, <span class="bu">len</span>(list_exceptions_gaus)<span class="op">/</span>test_size,<span class="bu">len</span>(list_exceptions_gaus1)<span class="op">/</span>test_size,</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>                                            <span class="bu">len</span>(list_exceptions_gaus2)<span class="op">/</span>test_size,<span class="bu">len</span>(list_exceptions_gaus3)<span class="op">/</span>test_size,<span class="bu">len</span>(list_exceptions_dyn)<span class="op">/</span><span class="bu">len</span>(vars_dyn),<span class="bu">len</span>(list_exceptions_skew)<span class="op">/</span>test_size,</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>                                            <span class="bu">len</span>(list_exceptions_TVE_MB)<span class="op">/</span>test_size,<span class="bu">len</span>(list_exceptions_TVE_POT)<span class="op">/</span>test_size],</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"P-value du test binomial"</span>: [<span class="bu">round</span>(test_except_np.pvalue,<span class="dv">3</span>),<span class="bu">round</span>(test_except_np_boot.pvalue,<span class="dv">3</span>), <span class="bu">round</span>(test_except_gaus.pvalue,<span class="dv">3</span>),</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>                                                <span class="bu">round</span>(test_except_gaus1.pvalue,<span class="dv">3</span>),<span class="bu">round</span>(test_except_gaus2.pvalue,<span class="dv">3</span>), <span class="bu">round</span>(test_except_gaus3.pvalue,<span class="dv">3</span>),</span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>                                                <span class="bu">round</span>(test_except_dyn.pvalue,<span class="dv">3</span>), <span class="bu">round</span>(test_except_skew.pvalue,<span class="dv">3</span>),<span class="bu">round</span>(test_except_TVE_MB.pvalue,<span class="dv">3</span>), <span class="bu">round</span>(test_except_TVE_POT.pvalue,<span class="dv">3</span>)]}</span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(dict_comp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Méthode</th>
<th data-quarto-table-cell-role="th">VaR</th>
<th data-quarto-table-cell-role="th">Nombre d'exceptions</th>
<th data-quarto-table-cell-role="th">Taux d'exceptions</th>
<th data-quarto-table-cell-role="th">P-value du test binomial</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>VaR non paramétrique</td>
<td>-0.043208</td>
<td>10</td>
<td>0.004615</td>
<td>0.009</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>VaR Bootstrap non paramétrique</td>
<td>-0.039865</td>
<td>16</td>
<td>0.007383</td>
<td>0.278</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>VaR gaussienne</td>
<td>-0.034949</td>
<td>24</td>
<td>0.011075</td>
<td>0.588</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>VaR Gaussienne EWMA (lambda =0.9)</td>
<td>-0.020820</td>
<td>67</td>
<td>0.030918</td>
<td>0.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>VaR Gaussienne EWMA (lambda =0.95)</td>
<td>-0.029483</td>
<td>35</td>
<td>0.016151</td>
<td>0.007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>VaR Gaussienne EWMA (lambda =0.99)</td>
<td>-0.034261</td>
<td>26</td>
<td>0.011998</td>
<td>0.330</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>VaR dynamique</td>
<td>NaN</td>
<td>133</td>
<td>0.015801</td>
<td>0.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>VaR Skew Student</td>
<td>-0.039664</td>
<td>16</td>
<td>0.007383</td>
<td>0.278</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>VaR TVE MB</td>
<td>-0.032352</td>
<td>31</td>
<td>0.014305</td>
<td>0.051</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>VaR TVE POT</td>
<td>-0.040295</td>
<td>14</td>
<td>0.006461</td>
<td>0.105</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="commentaires" class="level2">
<h2 class="anchored" data-anchor-id="commentaires">Commentaires</h2>
<p>Nous avons estimé jusque là 10 valeurs différentes de la VaR. Ces différentes valeurs estimées correspondent à des approches différentes. Nous avons à chaque fois estimer une VaR 99% à horizon 1 jour. Le taux d’exceptions attendu afin de juger de la bonne qualité de la VaR est de 1%. - La VaR dynamique est particulière car, comme son nom l’indique, elle est dynamique donc pas constante au cours du temps. Elle a plus d’exceptions car elle est testée sur plus de données que les autres VaRs. Toutefois son taux d’exceptions se rapproche de celui des autres VaRs. - Le test binomial fournit une p-value inférieure au seuil de 5% pour les VaRs non paramétrique, Gaussienne EWMA (<span class="math inline">\(\lambda\)</span> = 0.9 et <span class="math inline">\(\lambda\)</span> = 0.95), dynamique et TVE par maxima par blocs. Ce qui sous entend que le taux d’exception est statistiquement différent du taux attendu de 1%. On en déduit donc que les modèles utilisés sont peu adéquats pour nos données. - La VaR non paramétrique et les VaR Gaussiennes EWMA pour <span class="math inline">\(\lambda\)</span> faible ont tendance à sous estimer la VaR tandis que la VaR dynamique et la VaR TVE par maxima par blocs ont tendance à sur estimer la vraie valeur de la VaR - De plus, la validation ex-ante de la VaR TVE POT nous indique une inadéquation entre les quantiles théoriques et les quantiles empiriques des excès. - Nous avons également montré que la VaR Skew Student semblait nettement plus valide que la VaR gaussienne. Toutefois, nous avons également estimé une amélioration de la VaR gaussienne qui est la VaR gaussienne pondérée par la méthode EWMA. - Les VARs qui nous semblent donc les plus pertinentes sont la VaR Bootstrap non paramétrique, la VaR gaussienne EWMA (<span class="math inline">\(\lambda\)</span>=0.99) et la VaR Skew Student.</p>
</section>
</section>
<section id="calcul-de-la-var-en-utilisant-un-modèle-ar-garch" class="level1">
<h1>Calcul de la VaR en utilisant un modèle AR-GARCH</h1>
<p>Dans les modélisations précédentes, nous avons supposé que les rendements avaient une moyenne constante au cours du temps, une volatilité constante et qu’elles sont non auto-correlées. Cependant, ces hypothèses ne sont pas vérifiées dans la réalité. En effet, les rendements connaissent des périodes relativement stable et des périodes de volatilité élevée. De plus, les rendements sont auto-corrélés. Pour prendre en compte ces caractéristiques, nous allons modéliser les rendements par un modèle AR-GARCH.</p>
<p>Nous savons déjà que la série des log rendements est stationnaire. De plus les fonctions d’autocorrélation et d’autocorrélation partielle sont exponentielles décroissantes et s’annulent après quelques retards. Cela nous conduit à envisager un modèle AR(p) avec p=1,2,3,4,5,6,7,8,9,10. Nous allons comparer les modèles AR(p) et choisir le modèle qui minimise le BIC.</p>
<div id="cell-165" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construction des modèles AR(p) for p in [1,2,3,4,5] et choix du modèle avec le plus petit BIC</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.ar_model <span class="im">import</span> AutoReg</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>bic <span class="op">=</span> {}</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> AutoReg(train_close[<span class="st">'log_return'</span>],lags<span class="op">=</span>p).fit()</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>    bic[p] <span class="op">=</span> model.bic</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"le modèle avec le plus petit BIC est le modèle AR(</span><span class="sc">{</span><span class="bu">min</span>(bic, key<span class="op">=</span>bic.get)<span class="sc">}</span><span class="ss">)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>le modèle avec le plus petit BIC est le modèle AR(1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\johns\AppData\Local\Programs\Python\Python312\Lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
c:\Users\johns\AppData\Local\Programs\Python\Python312\Lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
c:\Users\johns\AppData\Local\Programs\Python\Python312\Lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
c:\Users\johns\AppData\Local\Programs\Python\Python312\Lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
c:\Users\johns\AppData\Local\Programs\Python\Python312\Lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)</code></pre>
</div>
</div>
<p>Le modèle AR(1) est celui qui a le plus petit BIC. Nous maintenant étudier l’adéquation de ce modèle.</p>
<section id="analyse-des-résidus" class="level4">
<h4 class="anchored" data-anchor-id="analyse-des-résidus">Analyse des résidus</h4>
<p>Nous allons allons vérifier à l’aide du test de portemanteau si les résidus sont des bruits blancs. Nous utiliserons le test de Ljung-Box. L’hypothèse nulle est qu’il n’existe pas d’autocorrélation dans les résidus.</p>
<div id="cell-168" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de Ljung-Box pour les résidus du modèle AR(1)</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.diagnostic <span class="im">import</span> acorr_ljungbox</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> AutoReg((train_close[<span class="st">'log_return'</span>]<span class="op">-</span>np.mean(train_close[<span class="st">'log_return'</span>])),lags<span class="op">=</span><span class="dv">1</span>).fit()</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>residus <span class="op">=</span> model.resid</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>result_lyung_box <span class="op">=</span> acorr_ljungbox(residus, lags<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>result_lyung_box</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            AutoReg Model Results                             
==============================================================================
Dep. Variable:             log_return   No. Observations:                 6501
Model:                     AutoReg(1)   Log Likelihood               18500.695
Method:               Conditional MLE   S.D. of innovations              0.014
Date:                Wed, 24 Apr 2024   AIC                         -36995.390
Time:                        01:52:09   BIC                         -36975.052
Sample:                             1   HQIC                        -36988.356
                                 6501                                         
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
const         -2.314e-06      0.000     -0.013      0.989      -0.000       0.000
log_return.L1    -0.0100      0.012     -0.805      0.421      -0.034       0.014
                                    Roots                                    
=============================================================================
                  Real          Imaginary           Modulus         Frequency
-----------------------------------------------------------------------------
AR.1         -100.1865           +0.0000j          100.1865            0.5000
-----------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\johns\AppData\Local\Programs\Python\Python312\Lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)</code></pre>
</div>
</div>
<p>Il est en resort que l’hypothèse nulle du test rejettée pour les 10 premiers lags, ce qui signifie que les résidus sont corrélés. Nous pouvons déjà conclure que le modèle AR(1) n’est pas satisfaisant. L’homoscédasticité des résidus peut être vérifiée aussi à l’aide du test de Portemanteau : en étudiant la corrélation des carrés des résidus. Nous pouvons aussi étudier la normalité des résidus à l’aide du test de Jarque-Bera et du QQ plot.</p>
</section>
<section id="test-de-portemanteau-sur-les-carrés-des-résidus" class="level4">
<h4 class="anchored" data-anchor-id="test-de-portemanteau-sur-les-carrés-des-résidus">Test de Portemanteau sur les carrés des résidus</h4>
<div id="cell-170" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>result_lyung_box <span class="op">=</span> acorr_ljungbox(residus<span class="op">**</span><span class="dv">2</span>, lags<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(  result_lyung_box) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        lb_stat      lb_pvalue
1    231.953319   2.235445e-52
2    595.630965  4.574875e-130
3    952.903163  2.962284e-206
4   1235.609836  3.035897e-266
5   1701.848851   0.000000e+00
6   1928.023750   0.000000e+00
7   2124.968386   0.000000e+00
8   2319.905665   0.000000e+00
9   2595.596981   0.000000e+00
10  2892.265379   0.000000e+00</code></pre>
</div>
</div>
<p>L’hypothèse nulle qui suppose que les résidus sont homoscédastiques est rejetée. Nous pouvons donc conclure que les résidus ne sont pas homoscédastiques et pensez à un modèle GARCH sur les résidus.</p>
</section>
<section id="qq-plot-des-résidus" class="level3">
<h3 class="anchored" data-anchor-id="qq-plot-des-résidus">QQ plot des résidus</h3>
<div id="cell-173" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>sm.qqplot(residus, line <span class="op">=</span><span class="st">'s'</span>)</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'residusB Returns - QQ Plot'</span>)</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-87-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="test-de-jarque-bera" class="level4">
<h4 class="anchored" data-anchor-id="test-de-jarque-bera">Test de Jarque-Bera</h4>
<div id="cell-175" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> jarque_bera</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de Jarque-Bera pour la normalité</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>jb_test_statistic, jb_p_value <span class="op">=</span> jarque_bera(residus)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Jarque-Bera test statistic:"</span>, jb_test_statistic)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Jarque-Bera test p-value:"</span>, jb_p_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Jarque-Bera test statistic: 5204.275903184189
Jarque-Bera test p-value: 0.0</code></pre>
</div>
</div>
<p>On peut déjà constater à partir de ce qqplot que les résidus ne suivent pas une loi normale. En effet, les quantiles théoriques et les quantiles empiriques ne sont pas alignés. Nous avons également rejeté l’hypothèse nulle du test de Jarque-Bera.</p>
<p>Nous allons maintenant modéliser le résidus de ce AR(1).</p>
</section>
</section>
<section id="adéquation-du-modèle-garch-sur-les-résidus" class="level3">
<h3 class="anchored" data-anchor-id="adéquation-du-modèle-garch-sur-les-résidus">Adéquation du modèle GARCH sur les résidus</h3>
<p>Afin de vérifier si le modèle GARCH est adéquat pour les résidus, nous allons ajuster un modèle GARCH(1,1) aux résidus et ensuite nous allons vérifier à partir des résidus au carrée s’il y’a de l’hetéroscedasticité dans les résidus.</p>
<div id="cell-178" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> arch <span class="im">import</span> arch_model</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the GARCH(1,1) model in the résidus and take the square</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>residus_garch_model <span class="op">=</span> arch_model(residus, vol<span class="op">=</span><span class="st">'Garch'</span>, p<span class="op">=</span><span class="dv">1</span>, q<span class="op">=</span><span class="dv">1</span>).fit(disp<span class="op">=</span><span class="st">'off'</span>)</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>residuals_garch <span class="op">=</span> residus_garch_model.resid</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>squared_residuals_garch <span class="op">=</span> residuals_garch<span class="op">**</span><span class="dv">2</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>plot_acf(squared_residuals_garch, ax<span class="op">=</span>axes[<span class="dv">0</span>], title<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>plot_pacf(squared_residuals_garch, ax<span class="op">=</span>axes[<span class="dv">1</span>], title<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>sm.qqplot(squared_residuals_garch, line <span class="op">=</span><span class="st">'s'</span>,ax<span class="op">=</span>axes[<span class="dv">2</span>])    </span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-89-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le graphique ci-dessous confirme la présence d’hetéroscedasticité dans les résidus. Nous pouvons donc conclure que le modèle GARCH est adéquat pour les résidus. Appliquons dons un modèle GARCH(1,1) aux résidus et voyons ses résultats. Nous allons procéder par étape :</p>
<ul>
<li>Nous allons itérer sur les modèles ARIMA(p,d,q) pour trouver le modèle qui minimise le BIC.</li>
<li>Nous allons prendre le modèle GARCH(p,q) en fonction du modèle ARIMA(p,d,q) qui minimise le BIC.</li>
<li>Appliquer le modèle GARCH(p,q) aux résidus et examiner les résidus du modèle et les résidus du modèle au carré pour vérifier la présence d’hetéroscedasticité.</li>
</ul>
<p>Avant d’aller plus loin, vérifions statistiquement la présence d’un effet ARCH dans les résidus.</p>
<div id="cell-180" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Test d'un effet ARCH sur les résidus</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>arch_test <span class="op">=</span> sm.stats.diagnostic.het_arch(squared_residuals_garch)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'ARCH test results:</span><span class="ch">\n</span><span class="ss">'</span>)</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'LM Statistic: </span><span class="sc">{</span>arch_test[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'p-value: </span><span class="sc">{</span>arch_test[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'F Statistic: </span><span class="sc">{</span>arch_test[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'p-value: </span><span class="sc">{</span>arch_test[<span class="dv">3</span>]<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ARCH test results:

LM Statistic: 629.1578940701382
p-value: 9.916223442056947e-129
F Statistic: 69.55167742116966
p-value: 1.425288439064573e-135</code></pre>
</div>
</div>
<p>Nous pouvons conclure qu’il y’a un effet ARCH dans les résidus. Nous allons donc appliquer un modèle GARCH(1,1) aux résidus pour capturer la volatilité. L’hypothèse d’homoscédasticité est rejetée. Donc il y’a une présence d’hétéroscédasticit conditionnelle dans les résidus.</p>
</section>
<section id="modélisation-du-garch-sur-les-résidus." class="level2">
<h2 class="anchored" data-anchor-id="modélisation-du-garch-sur-les-résidus.">Modélisation du GARCH sur les résidus.</h2>
<p>Nous allons appliquer un modèle GARCH(1,1) sur les résidus.</p>
<div id="cell-183" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>garch_final_model <span class="op">=</span> arch_model(residus, vol<span class="op">=</span><span class="st">'Garch'</span>, p<span class="op">=</span><span class="dv">1</span>, q<span class="op">=</span><span class="dv">1</span>).fit(disp<span class="op">=</span><span class="st">'off'</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(garch_final_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     Constant Mean - GARCH Model Results                      
==============================================================================
Dep. Variable:                   None   R-squared:                       0.000
Mean Model:             Constant Mean   Adj. R-squared:                  0.000
Vol Model:                      GARCH   Log-Likelihood:                19340.9
Distribution:                  Normal   AIC:                          -38673.8
Method:            Maximum Likelihood   BIC:                          -38646.6
                                        No. Observations:                 6500
Date:                Wed, Apr 24 2024   Df Residuals:                     6499
Time:                        01:52:11   Df Model:                            1
                                 Mean Model                                 
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
mu         3.3282e-04  1.553e-04      2.144  3.207e-02 [2.851e-05,6.371e-04]
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega      3.9475e-06  9.753e-13  4.047e+06      0.000 [3.948e-06,3.948e-06]
alpha[1]       0.1000  3.135e-03     31.894 3.255e-223   [9.385e-02,  0.106]
beta[1]        0.8800  3.953e-03    222.603      0.000     [  0.872,  0.888]
============================================================================

Covariance estimator: robust</code></pre>
</div>
</div>
<p>Les résultats du modèle GARCH(1,1) se trouvent dans le tableau ci-dessus. Nous pouvons constater que les paramètres sont tous significatifs. Nous allons maintenant vérifier la qualité d’ajustement du modèle GARCH(1,1) aux résidus.</p>
<section id="analyse-des-résidus-du-modèle-garch" class="level4">
<h4 class="anchored" data-anchor-id="analyse-des-résidus-du-modèle-garch">Analyse des résidus du modèle GARCH</h4>
<p>La figure ci-dessous représente les différents graphiques : - Le graphique des résidus du modèle GARCH - La volatilité conditionnelle estimée - Le graphique des résidus standardisés</p>
<p>Le résidu dont l’analyse de la blancheur nous intéresse est le résidu standardisé. Il est le résultat du rapport entre le résidu du modèle GARCH et la volatilité conditionnelle estimée. Nous allons donc vérifier si ce résidu est un bruit blanc. C’est ce résidu que nous allons utiliser pour modéliser la VaR.</p>
<div id="cell-185" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>std_residus <span class="op">=</span> garch_final_model.resid <span class="op">/</span> garch_final_model.conditional_volatility</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(garch_final_model.resid)</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Résidus"</span>)</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(garch_final_model.conditional_volatility)</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Volatilité conditionnelle"</span>)</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(std_residus)</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">"Résidus standardisés"</span>)</span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-92-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="vérifions-que-les-résidus-de-ce-modèle-garch-sont-des-bruits-blancs." class="level3">
<h3 class="anchored" data-anchor-id="vérifions-que-les-résidus-de-ce-modèle-garch-sont-des-bruits-blancs.">Vérifions que les résidus de ce modèle GARCH sont des bruits blancs.</h3>
<p>Nous allons faire le test de Ljung-Box pour vérifier l’autocorrélation des résidus. Et nous allons également faire ce test sur les carrés des résidus pour vérifier l’absence d’autocorrélation des résidus au carré d’où l’absence d’hetéroscedasticité.</p>
<div id="cell-187" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test de Ljung-Box sur les résidus et les résidus au carré</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>test_lyungbow <span class="op">=</span> acorr_ljungbox(std_residus, lags<span class="op">=</span>[<span class="dv">10</span>], return_df<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(test_lyungbow)</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>test_lyungbow_squared <span class="op">=</span> acorr_ljungbox(std_residus<span class="op">**</span><span class="dv">2</span>, lags<span class="op">=</span>[<span class="dv">10</span>], return_df<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(test_lyungbow_squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      lb_stat  lb_pvalue
10  16.281508   0.091852
     lb_stat  lb_pvalue
10  9.337446   0.500406</code></pre>
</div>
</div>
<p>Dans les deux cas, la p-value est supèrieur à 5%. Nous ne pouvons donc pas rejeter l’hypothèse nulle selon laquelle les résidus sont des bruits blancs. Nous pouvons donc conclure que le modèle GARCH(1,1) est satisfaisant. Nous pouvons faire d’autres tests pour vérifier la qualité de notre modèle tel que le test de Jarque-Bera et le QQ plot.</p>
<p>Les estimations des paramètres du modèle AR(1)-GARCH(1,1) sont significatifs. Nous pouvons donc conclure que le modèle AR(1)-GARCH(1,1) est adéquat pour les log-rendements. Les paramètres estimés sont : - alpha = 0.0858 - beta = 0.8978 - omega = 0.0322 - phi = -0.0092</p>
</section>
</section>
<section id="estimation-des-paramètres-du-modèle-ar1-garch11." class="level2">
<h2 class="anchored" data-anchor-id="estimation-des-paramètres-du-modèle-ar1-garch11.">Estimation des paramètres du modèle AR(1)-GARCH(1,1).</h2>
<p>Nous pouvons directement estimer les paramètres du modèle AR(1)-GARCH(1,1) en utilisant la fonction arch_model de la bibliothèque arch. C’est ce que nous allons faire dans la cellule suivante.</p>
<div id="cell-190" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">## estimation des paramètres du modèle AR(1) -GARCH(1,1)</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>ar_garch_model <span class="op">=</span> arch_model(train_close[<span class="st">'log_return'</span>], vol<span class="op">=</span><span class="st">'Garch'</span>, p<span class="op">=</span><span class="dv">1</span>, q<span class="op">=</span><span class="dv">1</span>, mean<span class="op">=</span><span class="st">'AR'</span>, lags<span class="op">=</span><span class="dv">1</span>).fit(disp<span class="op">=</span><span class="st">'off'</span>)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ar_garch_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           AR - GARCH Model Results                           
==============================================================================
Dep. Variable:             log_return   R-squared:                      -0.000
Mean Model:                        AR   Adj. R-squared:                 -0.001
Vol Model:                      GARCH   Log-Likelihood:                19340.9
Distribution:                  Normal   AIC:                          -38671.8
Method:            Maximum Likelihood   BIC:                          -38637.9
                                        No. Observations:                 6500
Date:                Wed, Apr 24 2024   Df Residuals:                     6498
Time:                        01:54:07   Df Model:                            2
                                    Mean Model                                   
=================================================================================
                     coef    std err          t      P&gt;|t|       95.0% Conf. Int.
---------------------------------------------------------------------------------
Const          4.8457e-04  1.423e-04      3.404  6.636e-04  [2.056e-04,7.636e-04]
log_return[1] -9.9994e-03  1.272e-02     -0.786      0.432 [-3.494e-02,1.494e-02]
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega      3.9495e-06  7.237e-12  5.457e+05      0.000 [3.949e-06,3.950e-06]
alpha[1]       0.1000  6.899e-03     14.495  1.305e-47   [8.648e-02,  0.114]
beta[1]        0.8800  6.474e-03    135.923      0.000     [  0.867,  0.893]
============================================================================

Covariance estimator: robust</code></pre>
</div>
</div>
<div id="cell-191" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># les paramètres du modèle AR(1)-GARCH(1,1) sont les suivants</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Les paramètres du modèle AR(1)-GARCH(1,1) sont les suivants:</span><span class="ch">\n</span><span class="sc">{</span>ar_garch_model<span class="sc">.</span>params<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>constance,phi, omega, alpha, beta <span class="op">=</span> ar_garch_model.params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Les paramètres du modèle AR(1)-GARCH(1,1) sont les suivants:
Const            0.000485
log_return[1]   -0.009999
omega            0.000004
alpha[1]         0.100000
beta[1]          0.880000
Name: params, dtype: float64</code></pre>
</div>
</div>
<p>Les résultats ci-dessus donnent les mêmes résultats que ceux obtenus précédemment. Nous pouvons donc conclure que le modèle AR(1)-GARCH(1,1) est adéquat pour les log-rendements.</p>
</section>
</section>
<section id="reproduction-de-la-dynamique-historique-de-sigma_t-et-de-mu_t" class="level1">
<h1>Reproduction de la dynamique historique de <span class="math inline">\(\sigma_t\)</span> et de <span class="math inline">\(\mu_t\)</span></h1>
<div id="cell-193" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forcast_mu_sigma(r, phi_hat, omega_hat, alpha_hat, beta_hat):</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Calcule les prévisions de mu et sigma^2 pour une série de log-rendements</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :param r: Vecteur de log-rendements (numpy array).</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="co">    :param phi_hat: Estimation de phi (float).</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="co">    :param omega_hat: Estimation de omega (float).</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="co">    :param alpha_hat: Estimation de alpha (float).</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="co">    :param beta_hat: Estimation de beta (float).</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a><span class="co">    :return: Tuple de numpy arrays (mu_hat, sigma2_hat).</span></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialisation des vecteurs mu_hat et sigma2_hat</span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>    mu_hat <span class="op">=</span> np.zeros(<span class="bu">len</span>(r))</span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>    sigma2_hat <span class="op">=</span> np.zeros(<span class="bu">len</span>(r))</span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialisation de la première valeur de mu_hat</span></span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a>    mu_hat[<span class="dv">0</span>] <span class="op">=</span> np.mean(r)</span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialisation de la première valeur de sigma2_hat en utilisant la variance long terme</span></span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a>    sigma2_hat[<span class="dv">0</span>] <span class="op">=</span> omega_hat <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> alpha_hat <span class="op">-</span> beta_hat)</span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul des valeurs de mu_hat et sigma2_hat en utilisant les formules GARCH(1,1)</span></span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(r)):</span>
<span id="cb149-28"><a href="#cb149-28" aria-hidden="true" tabindex="-1"></a>        mu_hat[t] <span class="op">=</span> mu_hat[<span class="dv">0</span>] <span class="op">+</span> phi_hat <span class="op">*</span> r[t<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb149-29"><a href="#cb149-29" aria-hidden="true" tabindex="-1"></a>        sigma2_hat[t] <span class="op">=</span> omega_hat <span class="op">+</span> alpha_hat <span class="op">*</span> (r[t<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> mu_hat[t<span class="op">-</span><span class="dv">1</span>])<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> beta_hat <span class="op">*</span> sigma2_hat[t<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb149-30"><a href="#cb149-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-31"><a href="#cb149-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mu_hat, sigma2_hat</span>
<span id="cb149-32"><a href="#cb149-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-33"><a href="#cb149-33" aria-hidden="true" tabindex="-1"></a>constance,phi, omega, alpha, beta <span class="op">=</span> ar_garch_model.params</span>
<span id="cb149-34"><a href="#cb149-34" aria-hidden="true" tabindex="-1"></a>mu_hat, sigma2_hat <span class="op">=</span>forcast_mu_sigma(ts_close[<span class="st">'log_return'</span>],ar_garch_model.params[<span class="st">'log_return[1]'</span>], ar_garch_model.params[<span class="st">'omega'</span>], ar_garch_model.params[<span class="st">'alpha[1]'</span>], ar_garch_model.params[<span class="st">'beta[1]'</span>])</span>
<span id="cb149-35"><a href="#cb149-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-36"><a href="#cb149-36" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Une fois que l’on a reproduire la dynamique de <span class="math inline">\(\sigma_t\)</span> et de <span class="math inline">\(\mu_t\)</span>, nous pouvons faire des représentations graphiques pour vérifier la qualité de cette reproduction. Dans le graphique ci-dessous, nous allons représenter la série de <span class="math inline">\(\sigma_t\)</span> et de <span class="math inline">\(\mu_t\)</span> en fonction de la date ainsi que la volatilité conditionnelle estimée par le modèle AR(1)-GARCH(1,1).</p>
<div id="cell-195" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>fig,axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot( mu_hat, label<span class="op">=</span><span class="st">'Prévision de mu'</span>)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Prévision de mu'</span>)</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot( sigma2_hat, label<span class="op">=</span><span class="st">'Prévision de $\sigma^2$'</span>)</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Prévision de $\sigma^2$'</span>)</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(garch_final_model.conditional_volatility, label<span class="op">=</span><span class="st">'Volatilité conditionnelle'</span>)</span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">'Volatilité conditionnelle'</span>)</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-97-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Avant de calculer la VaR dynamique, nous allons estimer le quantile de <span class="math inline">\(1-\alpha\)</span> des résidus <span class="math inline">\(\epsilon_t\)</span>. Rappelons que notre modèle AR(1)-GARCH(1,1) est donné par :</p>
<p>L’équation du modèle AR(1) pour la moyenne conditionnelle : <span class="math display">\[\hat{\mu_t} = \hat{\mu} + \hat{\phi} R_{t-1}\]</span></p>
<p>L’équation du modèle GARCH(1,1) pour la variance conditionnelle : <span class="math display">\[\hat{\sigma_t}^2 = \hat{\omega} + \hat{\alpha} (R_{t-1} - \hat{\mu_t})^2 + \hat{\beta} \hat{\sigma_{t-1}}^2\]</span></p>
<p>où : - <span class="math inline">\(\hat{\mu_t}\)</span> est la moyenne conditionnelle au temps <span class="math inline">\(t\)</span>, - <span class="math inline">\(R_{t-1}\)</span> est le rendement à <span class="math inline">\(t-1\)</span>, - <span class="math inline">\(\hat{\sigma_t}^2\)</span> est la variance conditionnelle au temps <span class="math inline">\(t\)</span>, - <span class="math inline">\(\hat{\mu}\)</span>, <span class="math inline">\(\hat{\phi}\)</span>, <span class="math inline">\(\hat{\omega}\)</span>, <span class="math inline">\(\hat{\alpha}\)</span>, et <span class="math inline">\(\hat{\beta}\)</span> sont les paramètres estimés du modèle.</p>
<p>Et enfin le résidu <span class="math inline">\(\epsilon_t\)</span> est donné par :</p>
<p><span class="math display">\[\epsilon_t = \frac{R_t - \hat{\mu_t}}{\hat{\sigma_t}}\]</span> qui est le résidu standardisé.</p>
<section id="calcul-de-la-var-sur-les-résidus-standardisés-epsilon_t" class="level3">
<h3 class="anchored" data-anchor-id="calcul-de-la-var-sur-les-résidus-standardisés-epsilon_t">Calcul de la VaR sur les résidus standardisés <span class="math inline">\(\epsilon_t\)</span></h3>
<p>Pour calculer la VaR sur les résidus standardisés, nous allons utiliser pour l’approche non-paramétrique, la VaR historique boostrap et pour la méthode TVE, nous allons utiliser l’approche maxima par bloc.</p>
</section>
</section>
<section id="var-historique-boostrap-sur-les-résidus-standardisés-et-calcul-de-la-var-dynamique" class="level1">
<h1>VaR historique boostrap sur les résidus standardisés et calcul de la VaR dynamique</h1>
<div id="cell-198" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">### VaR historique bootstrap sur les résidus du modèle AR(1)-GARCH(1,1)</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>seuil <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>seuil_IC <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>num_simulations <span class="op">=</span> <span class="dv">5000</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>n_B <span class="op">=</span> <span class="dv">251</span><span class="op">*</span><span class="dv">10</span> <span class="co">#on utilise 10 ans de données comme taille d'échantillons bootstrap</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>var_residu_boostrap <span class="op">=</span> VaR_Hist_Bootstrap(std_residus, seuil, num_simulations, seuil_IC, n_B)[<span class="dv">0</span>]</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>var_garchdyn_boostrap <span class="op">=</span> (mu_hat <span class="op">+</span> np.sqrt(sigma2_hat) <span class="op">*</span> var_residu_boostrap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="backtesting-4" class="level1">
<h1>Backtesting</h1>
<div id="cell-200" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>list_exceptions_garchdyn_boot <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(train_size,<span class="bu">len</span>(ts_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> ts_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_garchdyn_boostrap[i]]</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(list_exceptions_garchdyn_boot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>26</code></pre>
</div>
</div>
<div id="cell-201" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR GARCH est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_garchdyn_boot)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR GARCH est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_garchdyn_boot)<span class="op">/</span>test_size<span class="op">*</span><span class="fl">100.</span><span class="sc">:0.2f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR GARCH est: 26
Le pourcentage d'exceptions pour la VaR GARCH est: 1.20%</code></pre>
</div>
</div>
<div id="cell-202" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>test_except_gaus <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_garchdyn_boot), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_gaus<span class="sc">.</span>pvalue<span class="sc">:.2f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.33</code></pre>
</div>
</div>
<p>La pvalue du test est supérieure au seuil de 5%. On ne peut donc pas rejeter l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Nous concluons donc que notre VaR est satisfaisante.</p>
<div id="cell-204" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index, ts_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], var_garchdyn_boostrap[train_size:], label<span class="op">=</span><span class="st">'VaR dynamique'</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(ts_close.index[list_exceptions_garchdyn_boot], ts_close[<span class="st">'log_return'</span>][list_exceptions_garchdyn_boot], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-102-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="var-par-la-méthode-maxima-par-bloc-sur-les-résidus-standardisés-et-calcul-de-la-var-dynamique" class="level1">
<h1>VaR par la méthode maxima par bloc sur les résidus standardisés et calcul de la VaR dynamique</h1>
<p>La TVE s’intéressant aux queues de distribution droite, nous allons d’abord convertir les résidus standardisés en prenant l’opposé.</p>
<div id="cell-207" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>std_residus_minus <span class="op">=</span> <span class="op">-</span>std_residus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-208" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>std_residus_maxima <span class="op">=</span> construct_max_data(std_residus_minus, <span class="dv">21</span>)</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>plt.plot(std_residus_maxima ,color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"residus maxima "</span>)</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-104-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-209" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_gumbel_residus <span class="op">=</span> []</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(std_residus_maxima)<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> <span class="op">-</span>np.log(<span class="op">-</span>np.log((i<span class="op">-</span><span class="fl">0.5</span>)<span class="op">/</span><span class="bu">len</span>(std_residus_maxima)))</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>    quantiles_theoriques_gumbel_residus.append(val)</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Tracer le Gumbel plot</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_gumbel_residus, np.sort(std_residus_maxima), marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 1 : Calculer les coefficients de la droite d'ajustement</span></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>coefficients <span class="op">=</span> np.polyfit(quantiles_theoriques_gumbel_residus, np.sort(std_residus_maxima), <span class="dv">1</span>)</span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 2 : Générer les valeurs de la droite d'ajustement</span></span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>droite_ajustement <span class="op">=</span> np.poly1d(coefficients)</span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array(quantiles_theoriques_gumbel_residus)</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>y_ajustement <span class="op">=</span> droite_ajustement(x)</span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 3 : Tracer la droite d'ajustement</span></span>
<span id="cb162-19"><a href="#cb162-19" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_ajustement, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb162-20"><a href="#cb162-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-21"><a href="#cb162-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Gumbel Plot'</span>)</span>
<span id="cb162-22"><a href="#cb162-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques de Gumbel'</span>)</span>
<span id="cb162-23"><a href="#cb162-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles observés'</span>)</span>
<span id="cb162-24"><a href="#cb162-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-105-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le gumbel plot semble linéaire et ne présente pas de courbure. Nous allons donc utiliser la loi de Gumbel pour la suite.</p>
<div id="cell-211" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> genextreme <span class="im">as</span> gev</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> gumbel_r</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>params_gev_residus <span class="op">=</span> gev.fit(std_residus_maxima)</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>params_gumbel_residus <span class="op">=</span> gumbel_r.fit(std_residus_maxima)</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les paramètres estimés</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Paramètres estimés de la distribution GEV:"</span>)</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Forme (xi) ="</span>, params_gev_residus[<span class="dv">0</span>])</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Localisation (mu) ="</span>, params_gev_residus[<span class="dv">1</span>])</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Echelle (sigma) ="</span>, params_gev_residus[<span class="dv">2</span>])</span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">150</span><span class="op">*</span><span class="st">"-"</span>)</span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Paramètres estimés de la distribution de Gumbel (xi nul):"</span>)</span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Localisation (mu) ="</span>, params_gumbel_residus[<span class="dv">0</span>])</span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Echelle (sigma) ="</span>, params_gumbel_residus[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Paramètres estimés de la distribution GEV:
Forme (xi) = -0.022284230963655637
Localisation (mu) = 1.7112620288571874
Echelle (sigma) = 0.596567928970954
------------------------------------------------------------------------------------------------------------------------------------------------------
Paramètres estimés de la distribution de Gumbel (xi nul):
Localisation (mu) = 1.71881001440757
Echelle (sigma) = 0.6004004139302063</code></pre>
</div>
</div>
<div id="cell-212" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaison des distributions GEV et Gumbel</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>plt.hist(std_residus_maxima, bins<span class="op">=</span><span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="st">'Données observées'</span>)</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> plt.xlim()</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Densité GEV ajustée</span></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>p_gev_residus <span class="op">=</span> gev.pdf(x, <span class="op">*</span>params_gev_residus)</span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p_gev_residus, <span class="st">'k'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'GEV ajustée'</span>)</span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Densité Gumbel ajustée</span></span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>p_gumbel_residus <span class="op">=</span> gumbel_r.pdf(x, <span class="op">*</span>params_gumbel_residus)</span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p_gumbel_residus, <span class="st">'r'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Gumbel ajustée'</span>)</span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Comparaison GEV vs Gumbel'</span>)</span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-107-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Les deux distributions semblent bien modéliser la queue de distribution des résidus standardisés.</p>
<div id="cell-214" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>niveaux_quantiles_residus <span class="op">=</span> np.arange(<span class="fl">0.001</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>quantiles_empiriques_TVE_residus <span class="op">=</span> np.quantile(std_residus_maxima, niveaux_quantiles_residus)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_GEV_residus <span class="op">=</span> gev.ppf(niveaux_quantiles_residus, <span class="op">*</span>params_gev_residus)</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_Gumb_residus <span class="op">=</span> gumbel_r.ppf(niveaux_quantiles_residus, <span class="op">*</span>params_gumbel_residus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-215" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_GEV_residus, quantiles_empiriques_TVE_residus)</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques_GEV_residus, quantiles_theoriques_GEV_residus, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi GEV"</span>)</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (Loi GEV)'</span>)</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_Gumb_residus, quantiles_empiriques_TVE_residus)</span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques_Gumb_residus, quantiles_theoriques_Gumb_residus, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi Gumbel"</span>)</span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (Loi Gumbel)'</span>)</span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-109-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Les deux modélisations semblent bien correspondre aux données. Comme le Gumbel plot est linéaire, nous allons utiliser la loi de Gumbel pour modéliser la GEV et calculer la VaR.</p>
</section>
<section id="calcul-de-la-var-2" class="level1">
<h1>Calcul de la VaR</h1>
<div id="cell-217" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># redressement de alpha</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="dv">21</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>alpha_bm <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>s<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>alpha)</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>var_std_residus <span class="op">=</span> <span class="op">-</span>gumbel_r.ppf(alpha_bm, <span class="op">*</span>params_gumbel_residus)</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>var_dyn_TVE_residus <span class="op">=</span> (mu_hat <span class="op">+</span> np.sqrt(sigma2_hat) <span class="op">*</span> var_std_residus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="backtesting-5" class="level2">
<h2 class="anchored" data-anchor-id="backtesting-5">Backtesting</h2>
<div id="cell-219" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>list_exceptions_TVE_residus <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(train_size,<span class="bu">len</span>(ts_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> ts_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_dyn_TVE_residus[i]]</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(list_exceptions_TVE_residus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>25</code></pre>
</div>
</div>
<div id="cell-220" class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR TVE est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_residus)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR TVE est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_residus)<span class="op">/</span>test_size<span class="op">*</span><span class="fl">100.</span><span class="sc">:0.2f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR TVE est: 25
Le pourcentage d'exceptions pour la VaR TVE est: 1.15%</code></pre>
</div>
</div>
<div id="cell-221" class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>test_except_TVE_residus <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_TVE_residus), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_TVE_residus<span class="sc">.</span>pvalue<span class="sc">:.2f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.45</code></pre>
</div>
</div>
<p>La pvalue du test est supérieure au seuil de 5%. On ne peut donc pas rejeter l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Nous concluons donc que notre VaR dynamique est satisfaisante.</p>
<div id="cell-223" class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index, ts_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], var_dyn_TVE_residus[train_size:], label<span class="op">=</span><span class="st">'VaR dynamique'</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(ts_close.index[list_exceptions_TVE_residus], ts_close[<span class="st">'log_return'</span>][list_exceptions_TVE_residus], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ValueAtRisk_files/figure-html/cell-114-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Ce projet a eu pour objectif d’estimer la VaR à horizon 1 jour et la VaR dynamique de différentes façons. Nous avons utilisé les données historiques du CaC40. Nous avons utilisé des méthodes non-paramétriques telles que la VaR historique et la VaR historique bootstrap. Nous avons également utilisé des méthodes paramétriques telles que la VaR gaussienne, la VaR skew-student et nous avons utilisé la théorie des valeurs extrêmes pour modéliser la VaR. Nous avons également estimé de deux façons différentes la VaR dynamique. La première méthode consiste à calculer la VaR historique sur une fenêtre glissante de 251 jours. La deuxième méthode consiste à modéliser la VaR par un modèle AR-GARCH. Nous avons également validé nos modèles par des tests de backtesting.</p>
<p>Les différentes approches de modélisation estime la VaR à horizon 1 jour à environ -0.03 avec un niveau de confiance de 99%. Ceci signifie que la perte maximale que peut subir un portefeuille sur un horizon de 1 jour avec un niveau de confiance de 99% est de 3%. Nous avons également validé nos modèles par des tests de backtesting qui ne rejettent pas l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%.</p>
<p>La VaR dynamique estimée sur une fenêtre glissante de 251 jours n’a pas été validée par le test de backtesting. En effet, la pvalue du test est inférieure au seuil de 5%. Nous rejetons donc l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Cependant, la VaR dynamique estimée par le modèle AR(1)-GARCH(1,1) donne des meilleurs résultats. L’hypothèse nulle du test selon laquelle le pourcentage d’exceptions est inférieur à 1% n’a pas été rejetée.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>