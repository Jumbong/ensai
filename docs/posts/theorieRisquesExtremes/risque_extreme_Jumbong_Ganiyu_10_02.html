<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Menu - Modélisation de la value at risk</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Menu</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/junior-jumbong-258330211/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text">LinkedIn</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/Jumbong"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">Github</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Modélisation de la value at risk</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Modélisation de la value at risk</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-contents">
               <p>Jumbong Junior <a href="mailto:junior.jumbong@eleve.ensai.fr" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
               <p>Ganiyu Isaac <a href="mailto:isaac.ganiyu@eleve.ensai.fr" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
            </div>
    </div>
      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Ensai 3A</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">menu</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="init" class="level1">
<h1>Init</h1>
<section id="import-des-données" class="level3">
<h3 class="anchored" data-anchor-id="import-des-données">Import des données</h3>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install yfinance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: yfinance in .\mon_env\lib\site-packages (0.2.35)
Requirement already satisfied: pandas&gt;=1.3.0 in .\mon_env\lib\site-packages (from yfinance) (2.1.4)
Requirement already satisfied: numpy&gt;=1.16.5 in .\mon_env\lib\site-packages (from yfinance) (1.26.3)
Requirement already satisfied: requests&gt;=2.31 in .\mon_env\lib\site-packages (from yfinance) (2.31.0)
Requirement already satisfied: multitasking&gt;=0.0.7 in .\mon_env\lib\site-packages (from yfinance) (0.0.11)
Requirement already satisfied: lxml&gt;=4.9.1 in .\mon_env\lib\site-packages (from yfinance) (5.1.0)
Requirement already satisfied: appdirs&gt;=1.4.4 in .\mon_env\lib\site-packages (from yfinance) (1.4.4)
Requirement already satisfied: pytz&gt;=2022.5 in .\mon_env\lib\site-packages (from yfinance) (2023.3.post1)
Requirement already satisfied: frozendict&gt;=2.3.4 in .\mon_env\lib\site-packages (from yfinance) (2.4.0)
Requirement already satisfied: peewee&gt;=3.16.2 in .\mon_env\lib\site-packages (from yfinance) (3.17.0)
Requirement already satisfied: beautifulsoup4&gt;=4.11.1 in .\mon_env\lib\site-packages (from yfinance) (4.12.2)
Requirement already satisfied: html5lib&gt;=1.1 in .\mon_env\lib\site-packages (from yfinance) (1.1)
Requirement already satisfied: soupsieve&gt;1.2 in .\mon_env\lib\site-packages (from beautifulsoup4&gt;=4.11.1-&gt;yfinance) (2.5)
Requirement already satisfied: six&gt;=1.9 in .\mon_env\lib\site-packages (from html5lib&gt;=1.1-&gt;yfinance) (1.16.0)
Requirement already satisfied: webencodings in .\mon_env\lib\site-packages (from html5lib&gt;=1.1-&gt;yfinance) (0.5.1)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in .\mon_env\lib\site-packages (from pandas&gt;=1.3.0-&gt;yfinance) (2.8.2)
Requirement already satisfied: tzdata&gt;=2022.1 in .\mon_env\lib\site-packages (from pandas&gt;=1.3.0-&gt;yfinance) (2023.4)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in .\mon_env\lib\site-packages (from requests&gt;=2.31-&gt;yfinance) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in .\mon_env\lib\site-packages (from requests&gt;=2.31-&gt;yfinance) (3.6)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in .\mon_env\lib\site-packages (from requests&gt;=2.31-&gt;yfinance) (2.1.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in .\mon_env\lib\site-packages (from requests&gt;=2.31-&gt;yfinance) (2023.11.17)</code></pre>
</div>
</div>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Télécharger les données historiques du CAC 40</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>cac_40 <span class="op">=</span> yf.Ticker(<span class="st">"^FCHI"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> cac_40.history(<span class="st">"max"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Formater l'index en année-mois-jour</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>data.index <span class="op">=</span> data.index.strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>ts_data <span class="op">=</span> data</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>ts_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
<th data-quarto-table-cell-role="th">Dividends</th>
<th data-quarto-table-cell-role="th">Stock Splits</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1990-03-01</td>
<td>1836.000000</td>
<td>1838.000000</td>
<td>1827.000000</td>
<td>1832.000000</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1990-03-02</td>
<td>1831.000000</td>
<td>1860.000000</td>
<td>1831.000000</td>
<td>1860.000000</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1990-03-05</td>
<td>1866.000000</td>
<td>1874.000000</td>
<td>1862.000000</td>
<td>1874.000000</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1990-03-06</td>
<td>1869.000000</td>
<td>1875.000000</td>
<td>1866.000000</td>
<td>1872.000000</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1990-03-07</td>
<td>1874.000000</td>
<td>1881.000000</td>
<td>1874.000000</td>
<td>1880.000000</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-02-05</td>
<td>7591.770020</td>
<td>7606.120117</td>
<td>7558.229980</td>
<td>7589.959961</td>
<td>51727200</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-02-06</td>
<td>7634.189941</td>
<td>7641.629883</td>
<td>7592.089844</td>
<td>7638.970215</td>
<td>56890100</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-02-07</td>
<td>7632.839844</td>
<td>7652.850098</td>
<td>7610.180176</td>
<td>7611.259766</td>
<td>62951100</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2024-02-08</td>
<td>7628.600098</td>
<td>7685.459961</td>
<td>7607.459961</td>
<td>7665.629883</td>
<td>76648600</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2024-02-09</td>
<td>7652.450195</td>
<td>7668.189941</td>
<td>7617.740234</td>
<td>7647.520020</td>
<td>65846200</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>8619 rows × 7 columns</p>
</div>
</div>
</div>
</section>
<section id="mise-en-forme-et-nettoyage-des-données" class="level3">
<h3 class="anchored" data-anchor-id="mise-en-forme-et-nettoyage-des-données">Mise en forme et nettoyage des données</h3>
<div id="cell-7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ts_close <span class="op">=</span> ts_data[[ <span class="st">'Close'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">### Visualisation des valuers manquantes </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Y'a t-il des valeurs manquantes ? </span><span class="sc">{</span><span class="bu">any</span>(pd.isna(ts_close[<span class="st">'Close'</span>]))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ts_close[pd.isna(ts_close[<span class="st">'Close'</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Y'a t-il des valeurs manquantes ? False</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Close</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
<p>Nous n’avons aucune valeur manquante dans nos données</p>
</section>
<section id="calcul-du-log-rendement" class="level3">
<h3 class="anchored" data-anchor-id="calcul-du-log-rendement">calcul du log rendement</h3>
<div id="cell-11" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ts_close[<span class="st">'log_return'</span>] <span class="op">=</span> np.log(ts_close[<span class="st">'Close'</span>] <span class="op">/</span> ts_close[<span class="st">'Close'</span>].shift(<span class="dv">1</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>ts_close <span class="op">=</span> ts_close.dropna(subset<span class="op">=</span>[<span class="st">'log_return'</span>])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ts_close.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Close  log_return
Date                          
1990-03-02  1860.0    0.015168
1990-03-05  1874.0    0.007499
1990-03-06  1872.0   -0.001068
1990-03-07  1880.0    0.004264
1990-03-08  1917.0    0.019490</code></pre>
</div>
</div>
</section>
<section id="représentation-de-la-série-des-cours-et-de-la-série-des-log-rendements-en-fonction-de-la-date" class="level3">
<h3 class="anchored" data-anchor-id="représentation-de-la-série-des-cours-et-de-la-série-des-log-rendements-en-fonction-de-la-date">Représentation de la série des cours et de la série des log rendements en fonction de la date</h3>
<div id="cell-13" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots(<span class="dv">1</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'historical log returns'</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>ax1.plot(ts_close.index, ts_close[<span class="st">'log_return'</span>], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'historical CAC 40'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>ax2.plot(ts_close.index, ts_close[<span class="st">'Close'</span>], color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1200x1200 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le graphique ci-dessus représente la série des cours et la série des log rendements du CAC40 en fonction de la date. La série des cours est assez volatile et a une tendance à la hausse non-linéaire. Il semble qu’elle ne soit pas stationnaire. Nous vérfierons cela ultérieurement par le test de Dickey-Fuller. Cependant, la série des log rendements à une tendance constante et semble être stationnaire. Nous vérifierons cela également à travers les fonctions d’autocorrélation et d’autocorrélation partielle et par le test de Dickey-Fuller.</p>
</section>
<section id="fonction-dautocorrélation-et-dautocorrélation-partielle-de-la-série-des-log-rendements" class="level3">
<h3 class="anchored" data-anchor-id="fonction-dautocorrélation-et-dautocorrélation-partielle-de-la-série-des-log-rendements">Fonction d’autocorrélation et d’autocorrélation partielle de la série des log rendements</h3>
<div id="cell-16" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plot_acf(ts_close[<span class="st">'log_return'</span>].dropna(), ax<span class="op">=</span>ax[<span class="dv">0</span>],title<span class="op">=</span><span class="st">'ACF'</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plot_pacf(ts_close[<span class="st">'log_return'</span>].dropna(), ax<span class="op">=</span>ax[<span class="dv">1</span>],title<span class="op">=</span><span class="st">'PACF'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Comme nous pouvons le voir sur les graphiques ci-dessus, l’autocorrélation et l’autocorrélation partielle des log rendements sont très faibles. Cela signifie que les log rendements sont stationnaires. Nous vérifierons cela à travers le test de Dickey-Fuller.</p>
</section>
<section id="etude-de-la-stationnarité" class="level3">
<h3 class="anchored" data-anchor-id="etude-de-la-stationnarité">Etude de la stationnarité</h3>
<div id="cell-19" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Test de dickey fuller</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>adf_result <span class="op">=</span> adfuller(ts_close[<span class="st">'log_return'</span>].dropna(), regression<span class="op">=</span><span class="st">'ct'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"ADF Statistic: </span><span class="sc">{</span>adf_result[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span> <span class="kw">and</span> <span class="ss">f"p-value: </span><span class="sc">{</span>adf_result[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value: 0.0</code></pre>
</div>
</div>
<p>La pvalue étant nulle, on rejette l’hypothèse nulle de présence d’une racine unitaire. La série des log rendements est donc stationnaire. Par conséquent, nous travaillerons avec cette série pour modéliser la VaR à horizon 1 jour.</p>
</section>
<section id="découpage-train-test" class="level3">
<h3 class="anchored" data-anchor-id="découpage-train-test">Découpage train test</h3>
<div id="cell-22" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nous considérons 75% de nos données dans l'échantillon d'apprentissage et 25% dans l'échantillon de test</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>train_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(ts_close)<span class="op">*</span><span class="fl">0.75</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>test_size <span class="op">=</span> <span class="bu">len</span>(ts_close)<span class="op">-</span>train_size</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>train_close <span class="op">=</span> ts_close.iloc[<span class="dv">0</span>:train_size,:].dropna()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>test_close <span class="op">=</span> ts_close.iloc[train_size:<span class="bu">len</span>(ts_close),:]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Taille de l'ensemble d'apprentissage :"</span>, <span class="bu">len</span>(train_close))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Taille de l'ensemble de test :"</span>, <span class="bu">len</span>(test_close))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>pd.isna(train_close).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Taille de l'ensemble d'apprentissage : 6463
Taille de l'ensemble de test : 2155</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Close         0
log_return    0
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="statistiques-descriptives-des-rendements" class="level3">
<h3 class="anchored" data-anchor-id="statistiques-descriptives-des-rendements">Statistiques descriptives des rendements</h3>
<div id="cell-24" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>train_close[<span class="st">'log_return'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>count    6463.000000
mean        0.000141
std         0.014046
min        -0.094715
25%        -0.007011
50%         0.000366
75%         0.007716
max         0.105946
Name: log_return, dtype: float64</code></pre>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>test_close[<span class="st">'log_return'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>count    2155.000000
mean        0.000241
std         0.011963
min        -0.130983
25%        -0.004868
50%         0.000643
75%         0.006041
max         0.080561
Name: log_return, dtype: float64</code></pre>
</div>
</div>
<p>Sur les deux jeux de données les log rendements sont relativement volatiles avec une dispersion plus importante pour la base d’apprentissage que pour la base de test. On remarque par ailleurs que le min est plus petit et le max plus grand dans la base d’apprentissage que dans la base de test. Nous pouvions nous y attendre car la base d’apprentissage couvre une période plus longue. Les deux séries sont malgré tout assez semblables en terme de moyenne avec une moyenne d’environ 0.015%.</p>
</section>
</section>
<section id="modélisation-de-la-var." class="level1">
<h1>Modélisation de la VaR.</h1>
<p>La var est définie comme la perte potentielle maximale que peut subir un portefeuille sur un horizon avec un certain niveau de confiance. Dans ce notebook, nous adopterons une vision rentabilité. Dans ce cas, nous allons modéliser : <span class="math inline">\(P[R&lt;VaR_h] =1- \alpha\)</span>.</p>
<p>Nous allons appliquer les différentes méthodes de modélisation de la Var:</p>
<pre><code>- Méthodes non-paramétriques
    - VaR historique
    - VaR bootstrap
- Méthodes paramétriques
    - VaR gaussienne
    - VaR skew student
    - VaR TVE (Théorie des valeurs extrêmes)
    - VaR AR-GARCH</code></pre>
</section>
<section id="var-non-paramétrique" class="level1">
<h1>VaR non paramétrique</h1>
<section id="var-historique" class="level2">
<h2 class="anchored" data-anchor-id="var-historique">VaR historique :</h2>
<p>Ici on estime la distribution des rendements R par la fonction de répartition empirique du vecteur d’observations. La VaR est alors donnée par le quantile empirique d’ordre <span class="math inline">\(1-\alpha\)</span> :</p>
<p><span class="math inline">\(\hat{VaR}_h(\alpha) = \hat{F_n^{-1}}(1-\alpha)\)</span> avec <span class="math inline">\(\hat{F_n}(1-\alpha)= \frac{1}{n} \sum_{i=1}^{n} 1_{R_i \leq (1-\alpha)}\)</span></p>
<p>Nous utiliserons ainsi la fonction <code>numpy.percentile</code> pour calculer la VaR historique.</p>
<div id="cell-30" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hist_var(returns, index, fenetre, seuil):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Cette fonction calcule la Value at Risk (VaR) historique d'une série temporelle de log rendements</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">        returns (numpy_array ): serie de log rendements</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">        index (int): indice maximal de la série à considérer pour le calcul</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">        fenetre (int): nombre de jours sur lesquels on calcule la VaR</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">        seuil (float): niveau de confiance de la VaR</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Return:</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">        float: VaR historique</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.percentile(returns[index<span class="op">-</span>fenetre:index], <span class="dv">100</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>seuil))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-31" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>var_hist<span class="op">=</span> hist_var(train_close[<span class="st">"log_return"</span>], train_size, <span class="dv">251</span><span class="op">*</span><span class="dv">10</span>, <span class="fl">0.99</span>) <span class="co">#on utilise 10 ans comme fenêtre</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(var_hist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-0.04320825141346711</code></pre>
</div>
</div>
</section>
<section id="backtesting" class="level2">
<h2 class="anchored" data-anchor-id="backtesting">Backtesting</h2>
<div id="cell-33" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_hist <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"Non parametric VaR"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>list_exceptions_np <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_hist]</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_np], test_close[<span class="st">'log_return'</span>][list_exceptions_np], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-34" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR non paramétrique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_np)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR non paramétrique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_np)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR non paramétrique est: 10
Le pourcentage d'exceptions pour la VaR non paramétrique est: 0.004640371229698376</code></pre>
</div>
</div>
<p>Nous allons maintenant vérifier si la probabilité d’exception est statiquement égale à <span class="math inline">\(\alpha\)</span>.</p>
<div id="cell-36" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>test_except_np <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_np), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_np<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.008950138322753154</code></pre>
</div>
</div>
<p>La pvalue du test est inférieure au seuil de 5%. On rejette donc l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Nous concluons donc que notre VaR n’est pas satisfaisante.</p>
<div id="cell-38" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ES_np <span class="op">=</span> np.mean([r <span class="cf">for</span> r <span class="kw">in</span> train_close[<span class="st">'log_return'</span>] <span class="cf">if</span> r<span class="op">&lt;</span>var_hist])</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"L'Expected Shortfall associée à la VaR calculée est: </span><span class="sc">{</span>ES_np<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>L'Expected Shortfall associée à la VaR calculée est: -0.054387464763168906</code></pre>
</div>
</div>
</section>
<section id="var-historique-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="var-historique-bootstrap">VaR historique Bootstrap</h2>
<p>Pour la VaR historique boostrap, nous allons construire B réplications bootstrap de la série des log rendements. Pour chaque réplication(b), nous allons calculer la VaR historique. La VaR historique bootstrap est alors donnée par la moyenne des VaR historiques des B réplications bootstrap.</p>
<p><span class="math inline">\(\hat{VaR}_{h,bootstrap}(\alpha) = \frac{1}{B} \sum_{b=1}^{B} \hat{VaR}_{h,b}(\alpha)\)</span></p>
<p>Nous avons aussi calculé l’intervalle de confiance à 95% de la VaR historique bootstrap. Cet intervalle est donné par les quantiles empiriques d’ordre 2.5% et 97.5% des VaR historiques des B réplications bootstrap.</p>
<div id="cell-40" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> VaR_Hist_Bootstrap(returns, seuil, num_simulations, alpha_IC, n_B):</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    VaRs_boot <span class="op">=</span> np.zeros(num_simulations)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_simulations):</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        sample <span class="op">=</span> np.random.choice(returns, n_B, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        VaRs_boot[i] <span class="op">=</span> hist_var(sample, <span class="bu">len</span>(sample), <span class="bu">len</span>(sample), seuil)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    VaR <span class="op">=</span> np.mean(VaRs_boot)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    lower_bound <span class="op">=</span> np.percentile(VaRs_boot, <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span><span class="op">-</span>alpha_IC) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    upper_bound <span class="op">=</span> np.percentile(VaRs_boot, <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span><span class="op">-</span>alpha_IC) <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    IC <span class="op">=</span> (lower_bound, upper_bound)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> VaR, IC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-41" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>seuil <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>seuil_IC <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>num_simulations <span class="op">=</span> <span class="dv">5000</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>n_B <span class="op">=</span> <span class="dv">251</span><span class="op">*</span><span class="dv">10</span> <span class="co">#on utilise 10 ans de données comme taille d'échantillons bootstrap</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>var_hist_boot, IC_hist_boot <span class="op">=</span> VaR_Hist_Bootstrap(train_close[<span class="st">"log_return"</span>], seuil, num_simulations,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                                                 seuil_IC, n_B) </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"La VaR historique bootstrap: </span><span class="sc">{</span>var_hist_boot<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"L'intervalle de confiance associé est: </span><span class="sc">{</span>IC_hist_boot<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR historique bootstrap: -0.039930947829674754
L'intervalle de confiance associé est: (-0.043415059657731805, -0.03610734170316266)</code></pre>
</div>
</div>
<p>Notre estimation bootstrap de la VaR se trouve bien dans l’intervalle de confiance à 90%. Nous pouvons donc conclure que notre estimation de la VaR est satisfaisante.</p>
<div id="cell-43" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_hist_boot <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"Non parametric Bootstrap VaR"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>list_exceptions_np_boot <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_hist_boot]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_np_boot], test_close[<span class="st">'log_return'</span>][list_exceptions_np_boot], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-44" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR Bootstrap non paramétrique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_np_boot)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR Bootstrap non paramétrique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_np_boot)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR Bootstrap non paramétrique est: 16
Le pourcentage d'exceptions pour la VaR Bootstrap non paramétrique est: 0.007424593967517401</code></pre>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ES_np <span class="op">=</span> np.mean([r <span class="cf">for</span> r <span class="kw">in</span> train_close[<span class="st">'log_return'</span>] <span class="cf">if</span> r<span class="op">&lt;</span>var_hist_boot])</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"L'Expected Shortfall associée à la VaR calculée est: </span><span class="sc">{</span>ES_np<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>L'Expected Shortfall associée à la VaR calculée est: -0.05028777316523479</code></pre>
</div>
</div>
</section>
</section>
<section id="méthodes-paramétriques-destimation-de-la-var" class="level1">
<h1>Méthodes paramétriques d’estimation de la VaR</h1>
<section id="var-gaussienne" class="level2">
<h2 class="anchored" data-anchor-id="var-gaussienne">VaR gaussienne</h2>
<p>La VaR gaussienne suppose que les rendements suivent une loi normale. Dans ce cas, on a <span class="math inline">\(P(R&lt;VaR_h(\alpha)) = 1-\alpha\)</span> qui est équivalent à <span class="math inline">\(P(\frac{R-\mu}{\sigma} &lt; \frac{VaR_h(\alpha)-\mu}{\sigma}) = 1-\alpha\)</span> en supposant que R suit une loi normale de moyenne <span class="math inline">\(\mu\)</span> et d’écart type <span class="math inline">\(\sigma\)</span>. On a alors <span class="math inline">\(VaR_h(\alpha) = \mu + \sigma \Phi^{-1}(1-\alpha)\)</span>. On peut estimer les paramètres à partir de l’échantillon. On a alors <span class="math inline">\(\hat{VaR}_h(\alpha) = \hat{\mu} + \hat{\sigma} \Phi^{-1}(1-\alpha)\)</span>.</p>
<div id="cell-49" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> var_gaussienne(returns, index, fenetre, seuil):</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    rendements <span class="op">=</span> returns[index<span class="op">-</span>fenetre:index]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    mean_returns <span class="op">=</span> np.mean(rendements)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    sd_returns <span class="op">=</span> np.std(rendements)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    VaR <span class="op">=</span> mean_returns <span class="op">+</span> sd_returns <span class="op">*</span> stats.norm.ppf(<span class="dv">1</span><span class="op">-</span>seuil)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> VaR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-50" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">## VaR gaussienne sur base d'apprentissage</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>var_gaus <span class="op">=</span> var_gaussienne(train_close[<span class="st">"log_return"</span>], train_size, <span class="dv">251</span><span class="op">*</span><span class="dv">10</span>, <span class="fl">0.99</span>) <span class="co">#on utilise 10 ans comme fenêtre</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(var_gaus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-0.034733067424936016</code></pre>
</div>
</div>
<section id="validation" class="level3">
<h3 class="anchored" data-anchor-id="validation">Validation</h3>
<div id="cell-52" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analyse graphique avec les densités des distributions</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>plt.hist(train_close[<span class="st">"log_return"</span>], bins<span class="op">=</span><span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'blue'</span>, label <span class="op">=</span> <span class="st">'log rendements'</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(var_gaus, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'VaR Gaussienne (</span><span class="sc">{</span>var_gaus<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> plt.xlim()</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> stats.norm.pdf(x, np.mean(train_close[<span class="st">"log_return"</span>]), np.std(train_close[<span class="st">"log_return"</span>]))</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p, label <span class="op">=</span> <span class="st">'Loi normale'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Analyse graphique avec le QQ-plot</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>probplot <span class="op">=</span> stats.probplot(train_close[<span class="st">"log_return"</span>], </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                        sparams <span class="op">=</span> (np.mean(train_close[<span class="st">"log_return"</span>]), np.std(train_close[<span class="st">"log_return"</span>])), </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                        dist<span class="op">=</span><span class="st">'norm'</span>, plot<span class="op">=</span>plt)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>plt.plot(probplot[<span class="dv">0</span>][<span class="dv">0</span>], probplot[<span class="dv">0</span>][<span class="dv">0</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'QQ-plot'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>Text(0.5, 1.0, 'QQ-plot')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-28-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nous constatons que lorsqu’on utilise la loi normale pour la modélisation de la VaR, au niveau des queues de distribution,les quantiles théoriques sont moins élévés que les quantiles empiriques à gauche et plus élevés à droite. Cela signifie que la loi normale sous-estime la probabilité d’exception. Nous pouvons donc conclure que la loi normale n’est pas adaptée pour modéliser la VaR.</p>
<div id="cell-55" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Test d'adéquation</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de Kolmogorov-Smirnov</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>ks_statistic, ks_p_value <span class="op">=</span> stats.kstest(train_close[<span class="st">"log_return"</span>], <span class="st">'norm'</span>, args <span class="op">=</span> (np.mean(train_close[<span class="st">"log_return"</span>]), np.std(train_close[<span class="st">"log_return"</span>])))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test de Kolmogorov-Smirnov - Statistique : </span><span class="sc">{</span>ks_statistic<span class="sc">}</span><span class="ss">,</span><span class="ch">\n</span><span class="ss">P-value : </span><span class="sc">{</span>ks_p_value<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test de Kolmogorov-Smirnov - Statistique : 0.05681055751622879,
P-value : 1.4266789934088429e-18</code></pre>
</div>
</div>
<p>On rejette l’hypothèse nulle selon laquelle les log rendements suivent une distribution normale.</p>
</section>
<section id="représentation-graphique" class="level3">
<h3 class="anchored" data-anchor-id="représentation-graphique">Représentation graphique</h3>
<div id="cell-58" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_gaus <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"gaussian VaR"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>list_exceptions_gaus <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_gaus]</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_gaus], test_close[<span class="st">'log_return'</span>][list_exceptions_gaus], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="analyse-des-exceptions" class="level3">
<h3 class="anchored" data-anchor-id="analyse-des-exceptions">Analyse des exceptions</h3>
<div id="cell-60" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR gaussienne est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_gaus)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR gaussienne est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_gaus)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR gaussienne est: 25
Le pourcentage d'exceptions pour la VaR gaussienne est: 0.01160092807424594</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>test_except_gaus <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_gaus), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_gaus<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.44697408691382107</code></pre>
</div>
</div>
<p>La pvalue du test est supérieure au seuil de 5%. On ne peut donc pas rejeter l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Nous concluons donc que notre VaR est satisfaisante.</p>
</section>
<section id="var-gaussienne-à-10-jours" class="level3">
<h3 class="anchored" data-anchor-id="var-gaussienne-à-10-jours">VaR gaussienne à 10 jours</h3>
<div id="cell-64" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Var gaussienne à 10 jours par la méthode de scaling</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>periode <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>var_gaus_scaling <span class="op">=</span> np.sqrt(periode)<span class="op">*</span>var_gaus</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"La VaR gaussienne à 10 jours par la méthode de scaling est: </span><span class="sc">{</span>var_gaus_scaling<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR gaussienne à 10 jours par la méthode de scaling est: -0.10983560318699723</code></pre>
</div>
</div>
<div id="cell-65" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">## VaR gaussienne à 10 jours par la méthode de diffusion</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> random</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>periode <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>n_simul <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>S0 <span class="op">=</span> train_close[<span class="st">'Close'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>mean_returns <span class="op">=</span> np.mean(train_close[<span class="st">"log_return"</span>])</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>sd_returns <span class="op">=</span> np.std(train_close[<span class="st">"log_return"</span>])</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>simulations <span class="op">=</span> []</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(n_simul):</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    simul_k<span class="op">=</span>[S0]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(periode):</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>        Z <span class="op">=</span> random.standard_normal()</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>        dS <span class="op">=</span> simul_k[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>mean_returns <span class="op">+</span> simul_k[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>sd_returns<span class="op">*</span>Z</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>        simul_k.append(simul_k[<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span>dS)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    simulations.append(simul_k)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>rend10 <span class="op">=</span> [np.log(simul[<span class="dv">10</span>] <span class="op">/</span> S0) <span class="cf">for</span> simul <span class="kw">in</span> simulations]</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>var_gaus_diff <span class="op">=</span> np.percentile(rend10, <span class="dv">100</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>alpha))</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"La VaR gaussienne à 10 jours par la méthode de diffusion est: </span><span class="sc">{</span>var_gaus_diff<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR gaussienne à 10 jours par la méthode de diffusion est: -0.10286418206833377</code></pre>
</div>
</div>
</section>
<section id="var-gaussienne-pondérée" class="level3">
<h3 class="anchored" data-anchor-id="var-gaussienne-pondérée">VaR gaussienne pondérée :</h3>
<p>Une façon de corriger la VaR, est de pondérer la moyenne et l’écart type des rendements. On peut utiliser une moyenne mobile pondérée.</p>
<div id="cell-67" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> var_gaussienne_ewma(returns, index, fenetre, seuil, lambd):</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    rendements <span class="op">=</span> returns[index<span class="op">-</span>fenetre:index]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(rendements)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    poids <span class="op">=</span> [(lambd<span class="op">**</span>i)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>lambd) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    denom <span class="op">=</span> <span class="bu">sum</span>(poids)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    poids_pond <span class="op">=</span> [poid<span class="op">/</span>denom <span class="cf">for</span> poid <span class="kw">in</span> poids]</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    moy_pond <span class="op">=</span> np.<span class="bu">sum</span>([poids_pond[i]<span class="op">*</span>rendements[n<span class="op">-</span>i<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)])</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    variance_pond <span class="op">=</span> np.<span class="bu">sum</span>([poids_pond[i]<span class="op">*</span>(rendements[n<span class="op">-</span>i<span class="op">-</span><span class="dv">1</span>]<span class="op">-</span>moy_pond)<span class="op">**</span><span class="dv">2</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)])</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    VaR <span class="op">=</span> moy_pond <span class="op">+</span> np.sqrt(variance_pond) <span class="op">*</span> stats.norm.ppf(<span class="dv">1</span><span class="op">-</span>seuil)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> moy_pond, variance_pond, VaR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-68" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Calcul </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>lambd1<span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>lambd2 <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>lambd3 <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>moy_pond1, variance_pond1, VaR1 <span class="op">=</span> var_gaussienne_ewma(train_close[<span class="st">"log_return"</span>], train_size, <span class="dv">251</span><span class="op">*</span><span class="dv">10</span>, <span class="fl">0.99</span>, lambd1)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>moy_pond2, variance_pond2, VaR2 <span class="op">=</span> var_gaussienne_ewma(train_close[<span class="st">"log_return"</span>], train_size, <span class="dv">251</span><span class="op">*</span><span class="dv">10</span>, <span class="fl">0.99</span>, lambd2)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>moy_pond3, variance_pond3, VaR3 <span class="op">=</span> var_gaussienne_ewma(train_close[<span class="st">"log_return"</span>], train_size, <span class="dv">251</span><span class="op">*</span><span class="dv">10</span>, <span class="fl">0.99</span>, lambd3)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>list_exceptions_gaus1 <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>VaR1]</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">#print(100*"_"+ f"\nlambda = {lambd1}\nMoyenne pondérée: {moy_pond1}\nVariance pondérée: {variance_pond1}\nVaR gaussienne EWMA: {VaR1}\nNombre d'exceptions: {len(list_exceptions_gaus1)}\nPourcentage d'exceptions: {len(list_exceptions_gaus1)/test_size}")</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Premier graphique</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical train log returns"</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(x<span class="op">=</span>ts_close.index[train_size <span class="op">-</span> <span class="dv">251</span><span class="op">*</span><span class="dv">10</span> <span class="op">-</span> <span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical test log returns"</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(ts_close.index[train_size:], [VaR1 <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="ss">f"Gaussian EWMA VaR (lambda= </span><span class="sc">{</span>lambd1<span class="sc">}</span><span class="ss">)"</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].scatter(test_close.index[list_exceptions_gaus1], [test_close[<span class="st">'log_return'</span>][i] <span class="cf">for</span> i <span class="kw">in</span> list_exceptions_gaus1], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Lambda = 0.9'</span>)</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>list_exceptions_gaus2 <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>VaR2]</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a><span class="co">#print(100*"_"+ f"\nlambda = {lambd2}\nMoyenne pondérée: {moy_pond2}\nVariance pondérée: {variance_pond2}\nVaR gaussienne EWMA: {VaR2}\nNombre d'exceptions: {len(list_exceptions_gaus2)}\nPourcentage d'exceptions: {len(list_exceptions_gaus2)/test_size}")</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Deuxième graphique</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical train log returns"</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axvline(x<span class="op">=</span>ts_close.index[train_size <span class="op">-</span> <span class="dv">251</span><span class="op">*</span><span class="dv">10</span> <span class="op">-</span> <span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical test log returns"</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(ts_close.index[train_size:], [VaR2 <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="ss">f"Gaussian EWMA VaR (lambda= </span><span class="sc">{</span>lambd2<span class="sc">}</span><span class="ss">)"</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(test_close.index[list_exceptions_gaus2], [test_close[<span class="st">'log_return'</span>][i] <span class="cf">for</span> i <span class="kw">in</span> list_exceptions_gaus2], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Lambda = 0.95'</span>)</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>list_exceptions_gaus3 <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>VaR3]</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a><span class="co">#print(100*"_"+ f"\nlambda = {lambd3}\nMoyenne pondérée: {moy_pond3}\nVariance pondérée: {variance_pond3}\nVaR gaussienne EWMA: {VaR3}\nNombre d'exceptions: {len(list_exceptions_gaus3)}\nPourcentage d'exceptions: {len(list_exceptions_gaus3)/test_size}")</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Troisième graphique</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical train log returns"</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].axvline(x<span class="op">=</span>ts_close.index[train_size <span class="op">-</span> <span class="dv">251</span><span class="op">*</span><span class="dv">10</span> <span class="op">-</span> <span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"Historical test log returns"</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(ts_close.index[train_size:], [VaR3 <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="ss">f"Gaussian EWMA VaR (lambda= </span><span class="sc">{</span>lambd3<span class="sc">}</span><span class="ss">)"</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].scatter(test_close.index[list_exceptions_gaus3], [test_close[<span class="st">'log_return'</span>][i] <span class="cf">for</span> i <span class="kw">in</span> list_exceptions_gaus3], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">'Lambda = 0.99'</span>)</span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend()</span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="var-dynamique" class="level1">
<h1>VaR dynamique :</h1>
<p>Une autre façon de corriger la VaR est de la modéliser par un modèle dynamique. Ici on a pas besoin de diviser notre échantillon en base d’apprentissage et de test. Il suffit de choisir une fenêtre de temps pour estimer notre VaR. Ici nous allons choisir (251 jours) soit un an en considérant les jours ouvrés. Puis nous allons la faire glisser de 1 jour en 1 jour et la backtester le lendemain</p>
<p>La fonction hist_var écrite pour la VaR non paramétrique a été conçue pour pouvoir également calculer la VaR dynamique. Il suffit pour cela de faire varier l’index en paramètre.</p>
<div id="cell-71" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>vars_dyn <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> index: hist_var(<span class="bu">list</span>(ts_close[<span class="st">'log_return'</span>]), index, <span class="dv">251</span>, <span class="fl">0.99</span>), <span class="bu">range</span>(<span class="dv">251</span>, <span class="bu">len</span>(ts_close[<span class="st">'log_return'</span>])))) <span class="co">#on suppose qu'une année correspond à 251 jours ouvrés</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="réprésentation-graphique" class="level3">
<h3 class="anchored" data-anchor-id="réprésentation-graphique">Réprésentation graphique</h3>
<div id="cell-73" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index, ts_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">251</span>:], vars_dyn, label<span class="op">=</span><span class="st">'VaR dynamique'</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>list_exceptions_dyn <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">251</span>, <span class="bu">len</span>(ts_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> ts_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>vars_dyn[i<span class="op">-</span><span class="dv">251</span>]]</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(ts_close.index[list_exceptions_dyn], ts_close[<span class="st">'log_return'</span>][list_exceptions_dyn], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-74" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR dynamique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_dyn)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR dynamique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_dyn)<span class="op">/</span><span class="bu">len</span>(vars_dyn)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR dynamique est: 133
Le pourcentage d'exceptions pour la VaR dynamique est: 0.015895781044579897</code></pre>
</div>
</div>
<div id="cell-75" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>test_except_dyn <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_dyn), <span class="bu">len</span>(vars_dyn), p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_dyn<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 5.082684955881415e-07</code></pre>
</div>
</div>
<p>La p-value du test binomial est en dessous du seuil de 5%. On rejette donc l’hypothèse selon laquelle la probabilité d’exception est de 1%. Le modèle VaR estimé n’est pas satisfaisant.</p>
</section>
</section>
<section id="var-skew-student" class="level1">
<h1>VaR skew-Student :</h1>
<p>La loi student a pour avantage de prendre en compte les queues de distribution des rendements. Dans cette partie, nous allons supposer que les rendements suivent une loi skew-student généralisée. Nous allons estimer les paramètres de la loi skew-student à partir de la série des log rendements par maximum de vraisemblance. Enfin, nous allons calculer la VaR à partir des paramètres estimés.</p>
<section id="fonction-de-densité-de-la-skew-student" class="level3">
<h3 class="anchored" data-anchor-id="fonction-de-densité-de-la-skew-student">fonction de densité de la skew-student</h3>
<div id="cell-79" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> special </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SkStudentPdf(x:<span class="bu">float</span>, mu, sigma, gamma, nu):</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    point <span class="op">=</span> gamma<span class="op">*</span>(x<span class="op">-</span>mu)<span class="op">*</span>np.sqrt((nu<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>(((x<span class="op">-</span>mu)<span class="op">/</span>sigma)<span class="op">**</span><span class="dv">2</span><span class="op">+</span>nu))<span class="op">/</span>sigma</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span><span class="op">*</span>stats.t.pdf(x, df <span class="op">=</span> nu, loc <span class="op">=</span> mu, scale<span class="op">=</span>sigma)<span class="op">*</span>stats.t.cdf(point, nu<span class="op">+</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-80" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>sigma<span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>gamma <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>nu <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>SkStudentPdf(<span class="fl">0.5</span>, mu, sigma, gamma, nu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>0.022681128494391908</code></pre>
</div>
</div>
</section>
<section id="fonction-de-log-vraisemblance" class="level3">
<h3 class="anchored" data-anchor-id="fonction-de-log-vraisemblance">Fonction de log vraisemblance</h3>
<div id="cell-82" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> minus_log_vrais(params, returns):</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    mu, sigma, gamma, nu <span class="op">=</span> params</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    densities_values <span class="op">=</span> SkStudentPdf(returns, mu, sigma, gamma, nu)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    log_densities_values <span class="op">=</span> [np.log(value) <span class="cf">for</span> value <span class="kw">in</span> densities_values]</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>np.<span class="bu">sum</span>(log_densities_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fonction-doptimisation" class="level3">
<h3 class="anchored" data-anchor-id="fonction-doptimisation">fonction d’optimisation</h3>
<div id="cell-84" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction d'optimisation </span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optim_func(data):</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimer les paramètres par maximum de vraisemblance</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    initial_guess <span class="op">=</span> [np.mean(data), np.std(data), <span class="dv">1</span>, <span class="dv">4</span>]</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> minimize(minus_log_vrais, initial_guess, args<span class="op">=</span>(data,), method<span class="op">=</span><span class="st">'Nelder-Mead'</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtenez les paramètres estimés</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    est_params <span class="op">=</span> result.x</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> est_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimation-des-paramètres-sur-base-dapprentissage" class="level3">
<h3 class="anchored" data-anchor-id="estimation-des-paramètres-sur-base-dapprentissage">Estimation des paramètres sur base d’apprentissage</h3>
<div id="cell-86" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>est_params <span class="op">=</span> optim_func(train_close[<span class="st">'log_return'</span>])</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>mu_est, sigma_est, gamma_est, nu_est <span class="op">=</span> est_params</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"La valeur estimée des paramètres est:</span><span class="ch">\n</span><span class="ss">mu: </span><span class="sc">{</span>mu_est<span class="sc">}</span><span class="ch">\n</span><span class="ss">sigma: </span><span class="sc">{</span>sigma_est<span class="sc">}</span><span class="ch">\n</span><span class="ss">gamma: </span><span class="sc">{</span>gamma_est<span class="sc">}</span><span class="ch">\n</span><span class="ss">nu: </span><span class="sc">{</span>nu_est<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La valeur estimée des paramètres est:
mu: 0.002414916596402626
sigma: 0.010242362582207797
gamma: -0.23163817125525726
nu: 3.994213161152852</code></pre>
</div>
</div>
<p>Le code ci-dessus a consisté à construire la densité de la skew-student, la fonction de la log vraisemblance et la fonction d’optimisation. Nous avons ensuite estimé les paramètres de la skew-student sur la base d’apprentissage. Nous pouvons évaluer la qualité de notre estimation par des analyses graphiques avant de passer à la modélisation de la VaR.</p>
</section>
<section id="comparaison-entre-densité-théorique-et-densité-empirique-de-la-skew-student-sur-les-log-rendements" class="level2">
<h2 class="anchored" data-anchor-id="comparaison-entre-densité-théorique-et-densité-empirique-de-la-skew-student-sur-les-log-rendements">Comparaison entre densité théorique et densité empirique de la skew-student sur les log rendements</h2>
<div id="cell-89" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>x_values <span class="op">=</span> np.linspace(<span class="bu">min</span>(test_close[<span class="st">'log_return'</span>]), <span class="bu">max</span>(test_close[<span class="st">'log_return'</span>]), <span class="dv">1000</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>mu, sigma, skew, df <span class="op">=</span>est_params</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>theoretical_density <span class="op">=</span> SkStudentPdf(x_values, mu, sigma, skew, df)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>plt.hist(test_close[<span class="st">'log_return'</span>], bins<span class="op">=</span><span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Données empiriques'</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>plt.plot(x_values, theoretical_density, label<span class="op">=</span><span class="st">'Densité Skew Student'</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnalisation du graphique</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Rendements'</span>)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Densité'</span>)</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Comparaison entre les données et la densité théorique'</span>)</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du graphique</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-46-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le graphique ci-dessus est satisfaisant. La densité théorique de la skew-student est très proche de la densité empirique des log rendements. Nous pouvons donc conclure que la skew-student est une bonne modélisation des log rendements.</p>
<section id="fonction-de-repartition-de-la-skew-student-et-fonction-quantile" class="level3">
<h3 class="anchored" data-anchor-id="fonction-de-repartition-de-la-skew-student-et-fonction-quantile">Fonction de repartition de la skew-student et fonction quantile</h3>
<div id="cell-92" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Intégration de la fonction de densité</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> integrate</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize_scalar</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> integrale_SkewStudent(x):</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    borne_inf <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    resultat_integration, erreur <span class="op">=</span> integrate.quad(<span class="kw">lambda</span> x: SkStudentPdf(x, mu_est, sigma_est, gamma_est, nu_est), borne_inf, x)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> resultat_integration</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fonc_minimize(x, alpha):</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> integrale_SkewStudent(x)<span class="op">-</span>alpha</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(value)</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> theoretical_quantile(alpha):</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> alpha <span class="op">&lt;</span><span class="dv">0</span> <span class="kw">or</span> alpha <span class="op">&gt;</span><span class="dv">1</span>:</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Veuillez entrer un niveau alpha entre 0 et 1"</span>)</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>        resultat_minimisation <span class="op">=</span> minimize_scalar(<span class="kw">lambda</span> x: fonc_minimize(x, alpha))</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> resultat_minimisation.x</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le code ci-dessus nous a permis de construire la fonction de repartition de la skew-student ainsi que la fonction quantile qui est l’inverse de cette fonction de repartition. Cette fonction quantile est le coeur de la modélisation de la VaR.</p>
</section>
<section id="qq-plot" class="level3">
<h3 class="anchored" data-anchor-id="qq-plot">QQ plot :</h3>
<p>Le graphique de QQ plot nous permettra de discuter de la qualité d’ajustement de la loi skew-student à la série des log rendements.</p>
<div id="cell-95" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>niveaux_quantiles <span class="op">=</span> np.arange(<span class="fl">0.001</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>quantiles_empiriques <span class="op">=</span> np.quantile(train_close[<span class="st">'log_return'</span>], niveaux_quantiles)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques <span class="op">=</span> [theoretical_quantile(alpha) <span class="cf">for</span> alpha <span class="kw">in</span> niveaux_quantiles]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-96" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le QQ plot</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques, quantiles_empiriques)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques, quantiles_theoriques, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'QQ Plot - Quantiles empiriques vs Quantiles théoriques'</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (distribution Skew Student)'</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-49-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nous constatons que la loi skew-student est une bonne approximation de la distribution des log rendements. Même si on constate des écarts aux queues de distribution, la loi skew-student semble bien modéliser la distribution des log rendements.</p>
</section>
<section id="comparaison-entre-loi-gaussienne-et-loi-de-skew-student" class="level3">
<h3 class="anchored" data-anchor-id="comparaison-entre-loi-gaussienne-et-loi-de-skew-student">comparaison entre loi gaussienne et loi de Skew Student</h3>
<div id="cell-99" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>probplot <span class="op">=</span> stats.probplot(train_close[<span class="st">"log_return"</span>], </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                        sparams <span class="op">=</span> (np.mean(train_close[<span class="st">"log_return"</span>]), np.std(train_close[<span class="st">"log_return"</span>])), </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                        dist<span class="op">=</span><span class="st">'norm'</span>, plot<span class="op">=</span>plt)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>plt.plot(probplot[<span class="dv">0</span>][<span class="dv">0</span>], probplot[<span class="dv">0</span>][<span class="dv">0</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (distribution loi normale)'</span>)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ-plot d'une modélisation par loi normale"</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques, quantiles_empiriques)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques, quantiles_theoriques, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi Skew Student"</span>)</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (distribution Skew Student)'</span>)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Comme on peut le voir sur le graphique ci-dessus, la loi skew-student est une meilleure approximation de la distribution des log rendements que la loi normale. En effet, les écarts aux queues de distribution sont moins importants pour la loi skew-student que pour la loi normale.</p>
<section id="calcul-de-la-var-skew-student" class="level4">
<h4 class="anchored" data-anchor-id="calcul-de-la-var-skew-student">Calcul de la VaR Skew Student</h4>
<div id="cell-102" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> var_skewstudent(returns, index, fenetre, seuil):</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    rendements <span class="op">=</span> returns[index<span class="op">-</span>fenetre:index]</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    mean_returns <span class="op">=</span> np.mean(rendements)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    sd_returns <span class="op">=</span> np.std(rendements)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    VaR <span class="op">=</span>  theoretical_quantile(<span class="dv">1</span><span class="op">-</span>seuil)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> VaR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-103" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">## VaR Skew Student sur base d'apprentissage</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>var_skew <span class="op">=</span> var_skewstudent(train_close[<span class="st">"log_return"</span>], train_size, train_size, <span class="fl">0.99</span>) <span class="co">#on utilise 10 ans comme fenêtre</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(var_skew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-0.039652480749928415</code></pre>
</div>
</div>
<div id="cell-104" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_skew <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"VaR Skew Student"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>list_exceptions_skew <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_skew]</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_skew], test_close[<span class="st">'log_return'</span>][list_exceptions_skew], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-105" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR Skew student est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_skew)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR Skew Student est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_skew)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR Skew student est: 16
Le pourcentage d'exceptions pour la VaR Skew Student est: 0.007424593967517401</code></pre>
</div>
</div>
<div id="cell-106" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>test_except_skew <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_skew), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_skew<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.2775641662941861</code></pre>
</div>
</div>
<p>La p-value du test binomial est au dessus du seuil de 5%. On ne peut donc pas rejeter l’hypothèse selon laquelle la probabilité d’exception est de 1%. Le modèle VaR Skew Student estimé semble donc satisfaisant.</p>
</section>
</section>
</section>
</section>
<section id="var-tve-approche-maxima-par-bloc" class="level1">
<h1>VaR TVE: Approche maxima par bloc</h1>
<section id="construction-de-léchantillon-de-maxima" class="level3">
<h3 class="anchored" data-anchor-id="construction-de-léchantillon-de-maxima">Construction de l’échantillon de maxima</h3>
<p>La TVE s’intéresse aux queues de distribution droite (maximum, excès par valeurs supérieures). On commence donc par convertir nos données en prenant l’opposé des données</p>
<div id="cell-111" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>minus_train_returns <span class="op">=</span> [<span class="op">-</span>rtrn <span class="cf">for</span> rtrn <span class="kw">in</span> train_close[<span class="st">"log_return"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-112" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> construct_max_data(returns, block_size):</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(returns)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    num_blocks <span class="op">=</span> n <span class="op">//</span> block_size</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    maxima_sample <span class="op">=</span> []</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_blocks):</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>        block_start <span class="op">=</span> i <span class="op">*</span> block_size</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>        block_end <span class="op">=</span> (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> block_size</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>        block_data <span class="op">=</span> returns[block_start:block_end]</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>        max_in_block <span class="op">=</span> np.<span class="bu">max</span>(block_data)</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>        maxima_sample.append(max_in_block)</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> maxima_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-113" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>s<span class="op">=</span> <span class="dv">21</span> <span class="co"># nombre de jours ouvrés dans le mois</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>maxima_train_sample <span class="op">=</span> construct_max_data(minus_train_returns, s)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>plt.plot(maxima_train_sample ,color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"historical maxima of log returns"</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Value'</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-58-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gumbel-plot" class="level3">
<h3 class="anchored" data-anchor-id="gumbel-plot">Gumbel Plot</h3>
<div id="cell-115" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_gumbel <span class="op">=</span> []</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(maxima_train_sample)<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> <span class="op">-</span>np.log(<span class="op">-</span>np.log((i<span class="op">-</span><span class="fl">0.5</span>)<span class="op">/</span><span class="bu">len</span>(maxima_train_sample)))</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    quantiles_theoriques_gumbel.append(val)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Tracer le Gumbel plot</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_gumbel, np.sort(maxima_train_sample), marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Gumbel Plot'</span>)</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques de Gumbel'</span>)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles observés'</span>)</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-59-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le Gumbel plot ne semble pas linéaire. Ainsi il semble que <span class="math inline">\(\xi\)</span> soit non nul. La distribution adaptée à nos données est donc une distribution de Fréchet ou Weibull</p>
<div id="cell-117" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> genextreme <span class="im">as</span> gev</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> gumbel_r</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>params_gev <span class="op">=</span> gev.fit(maxima_train_sample)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>params_gumbel <span class="op">=</span> gumbel_r.fit(maxima_train_sample)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les paramètres estimés</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Paramètres estimés de la distribution GEV:"</span>)</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Forme (xi) ="</span>, params_gev[<span class="dv">0</span>])</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Localisation (mu) ="</span>, params_gev[<span class="dv">1</span>])</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Echelle (sigma) ="</span>, params_gev[<span class="dv">2</span>])</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">150</span><span class="op">*</span><span class="st">"-"</span>)</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Paramètres estimés de la distribution de Gumbel (xi nul):"</span>)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Localisation (mu) ="</span>, params_gumbel[<span class="dv">0</span>])</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Echelle (sigma) ="</span>, params_gumbel[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Paramètres estimés de la distribution GEV:
Forme (xi) = -0.7725395136844684
Localisation (mu) = 0.017131692081872454
Echelle (sigma) = 0.01129503253185405
------------------------------------------------------------------------------------------------------------------------------------------------------
Paramètres estimés de la distribution de Gumbel (xi nul):
Localisation (mu) = 0.01869561313242568
Echelle (sigma) = 0.009313391888439576</code></pre>
</div>
</div>
<div id="cell-118" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>plt.hist(maxima_train_sample, bins<span class="op">=</span><span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="st">'Données observées'</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> plt.xlim()</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Densité GEV ajustée</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>p_gev <span class="op">=</span> gev.pdf(x, <span class="op">*</span>params_gev)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p_gev, <span class="st">'k'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'GEV ajustée'</span>)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Densité Gumbel ajustée</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>p_gumbel <span class="op">=</span> gumbel_r.pdf(x, <span class="op">*</span>params_gumbel)</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p_gumbel, <span class="st">'r'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Gumbel ajustée'</span>)</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> <span class="st">"Comparaison GEV vs Gumbel"</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>plt.title(title)</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-61-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>On remarque la loi GEV (<span class="math inline">\(\xi\)</span> non nul) estimée représente mieux la queue de distribution que la loi de Gumbel.</p>
<div id="cell-120" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>niveaux_quantiles <span class="op">=</span> np.arange(<span class="fl">0.001</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>quantiles_empiriques_TVE <span class="op">=</span> np.quantile(maxima_train_sample, niveaux_quantiles) </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_GEV <span class="op">=</span> gev.ppf(niveaux_quantiles, <span class="op">*</span>params_gev)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_Gumb <span class="op">=</span> gumbel_r.ppf(niveaux_quantiles, <span class="op">*</span>params_gumbel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-121" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_GEV, quantiles_empiriques_TVE)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques_GEV, quantiles_theoriques_GEV, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi GEV"</span>)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (Loi GEV)'</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_Gumb, quantiles_empiriques_TVE)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques_Gumb, quantiles_theoriques_Gumb, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi Gumbel"</span>)</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (Loi Gumbel)'</span>)</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-63-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>La modélisation par loi de Gumbel semble mieux correspondre aux données. Nous utilisons donc cette loi pour la suite</p>
</section>
<section id="calcul-de-la-var" class="level3">
<h3 class="anchored" data-anchor-id="calcul-de-la-var">Calcul de la VAR</h3>
<div id="cell-124" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>alpha_bm <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>s<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>alpha)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>var_TVE_MB <span class="op">=</span> <span class="op">-</span>gumbel_r.ppf(alpha_bm, <span class="op">*</span>params_gumbel)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Var : "</span>, np.<span class="bu">round</span>(var_TVE_MB, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Var :  -0.032</code></pre>
</div>
</div>
<div id="cell-125" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_TVE_MB <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"VaR TVE MB"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>list_exceptions_TVE_MB <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>].iloc[i]<span class="op">&lt;</span>var_TVE_MB]</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_TVE_MB], test_close[<span class="st">'log_return'</span>].iloc[list_exceptions_TVE_MB], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-65-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-126" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR non paramétrique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_MB)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR non paramétrique est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_MB)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR non paramétrique est: 32
Le pourcentage d'exceptions pour la VaR non paramétrique est: 0.014849187935034803</code></pre>
</div>
</div>
<div id="cell-127" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>test_except_TVE_MB <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_TVE_MB), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_TVE_MB<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.029672279824551718</code></pre>
</div>
</div>
</section>
</section>
<section id="var-tve-approche-peak-over-threshold" class="level1">
<h1>VAR TVE: Approche Peak over threshold</h1>
<section id="fonction-pour-le-mean-excess-plot" class="level3">
<h3 class="anchored" data-anchor-id="fonction-pour-le-mean-excess-plot">Fonction pour le Mean Excess Plot</h3>
<div id="cell-130" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_excess_plot(returns):</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    sorted_returns <span class="op">=</span>np.sort(returns)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    listeu <span class="op">=</span> np.linspace(np.<span class="bu">min</span>(sorted_returns), np.<span class="bu">max</span>(sorted_returns), num <span class="op">=</span> <span class="dv">1000</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    listeu <span class="op">=</span> listeu[listeu <span class="op">&lt;</span> np.percentile(listeu, <span class="dv">80</span>)] <span class="co">## Retirer les valeurs trop extrêmes</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    mean_excess <span class="op">=</span> []</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    n<span class="op">=</span><span class="bu">len</span>(sorted_returns)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> u <span class="kw">in</span> listeu:</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> u <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>            terms <span class="op">=</span> []</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>            NU<span class="op">=</span><span class="dv">0</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>                term <span class="op">=</span> sorted_returns[i]<span class="op">-</span>u</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>                terms.append(<span class="bu">max</span>(term,<span class="dv">0</span>))</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> term <span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>                    NU <span class="op">=</span> NU <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>                mean_excess.append( (<span class="dv">1</span><span class="op">/</span>NU) <span class="op">*</span> np.<span class="bu">sum</span>(terms))</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>                listeu <span class="op">=</span> listeu[listeu<span class="op">!=</span>u]</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>            listeu <span class="op">=</span> listeu[listeu<span class="op">!=</span>u]</span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>    plt.plot(listeu, mean_excess)</span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Mean excess Plot'</span>)</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Moyenne des excès empirique'</span>)</span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Seuils'</span>)</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>    plt.plot()</span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="détermination-de-u-par-analyse-graphique" class="level3">
<h3 class="anchored" data-anchor-id="détermination-de-u-par-analyse-graphique">Détermination de u par analyse graphique</h3>
<div id="cell-132" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>mean_excess_plot(minus_train_returns)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="fl">0.009</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="fl">0.031</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-69-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Par analyse graphique, nous pouvons garder u = 0.03</p>
</section>
<section id="estimation-des-paramètres-de-la-loi-gpd" class="level3">
<h3 class="anchored" data-anchor-id="estimation-des-paramètres-de-la-loi-gpd">Estimation des paramètres de la loi GPD</h3>
<div id="cell-135" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>excess_values <span class="op">=</span> [value <span class="op">-</span> u <span class="cf">for</span> value <span class="kw">in</span> minus_train_returns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-136" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> genpareto</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>params_gpd <span class="op">=</span> genpareto.fit(excess_values)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les paramètres estimés</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Paramètres estimés de la distribution GPD:"</span>)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Forme (xi) ="</span>, params_gpd[<span class="dv">0</span>])</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Localisation (mu) ="</span>, params_gpd[<span class="dv">1</span>])</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Echelle (sigma) ="</span>, params_gpd[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Paramètres estimés de la distribution GPD:
Forme (xi) = -0.5566487728158849
Localisation (mu) = -0.13594589969927412
Echelle (sigma) = 0.11173378075406212</code></pre>
</div>
</div>
</section>
<section id="validation-ex-ante" class="level3">
<h3 class="anchored" data-anchor-id="validation-ex-ante">Validation Ex ante</h3>
<div id="cell-138" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>niveaux_quantiles <span class="op">=</span> np.arange(<span class="fl">0.001</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>quantiles_empiriques_POT <span class="op">=</span> np.quantile(excess_values, niveaux_quantiles) </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_GDP <span class="op">=</span> genpareto.ppf(niveaux_quantiles, <span class="op">*</span>params_gpd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-139" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_GDP, quantiles_empiriques_POT)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques_GDP, quantiles_theoriques_GDP, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi GPD"</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (Loi GPD)'</span>)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-73-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="calcul-de-la-var-1" class="level3">
<h3 class="anchored" data-anchor-id="calcul-de-la-var-1">Calcul de la VAR</h3>
<div id="cell-141" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>NU <span class="op">=</span> <span class="bu">len</span>([term <span class="cf">for</span> term <span class="kw">in</span> minus_train_returns <span class="cf">if</span> term<span class="op">-</span>u<span class="op">&gt;</span><span class="dv">0</span>])</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>alpha_pot <span class="op">=</span> <span class="dv">1</span><span class="op">-</span><span class="bu">len</span>(minus_train_returns)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>alpha)<span class="op">/</span>NU</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>var_TVE_POT <span class="op">=</span> genpareto.ppf(alpha_pot, <span class="op">*</span>params_gpd)<span class="op">+</span>u</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Var : "</span>, np.<span class="bu">round</span>(var_TVE_POT, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Var :  -0.032</code></pre>
</div>
</div>
</section>
<section id="backtesting-1" class="level3">
<h3 class="anchored" data-anchor-id="backtesting-1">Backtesting</h3>
<div id="cell-143" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[<span class="dv">0</span>:train_size], train_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical train log returns"</span>, color <span class="op">=</span> <span class="st">'gray'</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], test_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical test log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], [var_TVE_POT <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_size)], label<span class="op">=</span><span class="st">"VaR TVE POT"</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>list_exceptions_TVE_POT <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> test_close[<span class="st">'log_return'</span>].iloc[i]<span class="op">&lt;</span>var_TVE_POT]</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(test_close.index[list_exceptions_TVE_POT], test_close[<span class="st">'log_return'</span>].iloc[list_exceptions_TVE_POT], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-75-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-144" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR TVE Peak Over Threshold est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_POT)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR TVE Peak Over Threshold est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_POT)<span class="op">/</span>test_size<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR TVE Peak Over Threshold est: 32
Le pourcentage d'exceptions pour la VaR TVE Peak Over Threshold est: 0.014849187935034803</code></pre>
</div>
</div>
<div id="cell-145" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>test_except_TVE_POT <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_TVE_POT), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_TVE_POT<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.029672279824551718</code></pre>
</div>
</div>
</section>
</section>
<section id="calcul-de-la-var-en-utilisant-un-modèle-ar-garch" class="level1">
<h1>Calcul de la VaR en utilisant un modèle AR-GARCH</h1>
<p>Dans les modélisations précédentes, nous avons supposé que les rendements avaient une moyenne constante au cours du temps, une volatilité constante et qu’elles sont non auto-correlées. Cependant, ces hypothèses ne sont pas vérifiées dans la réalité. En effet, les rendements connaissent des périodes relativement stable et des périodes de volatilité élevée. De plus, les rendements sont auto-corrélés. Pour prendre en compte ces caractéristiques, nous allons modéliser les rendements par un modèle AR-GARCH.</p>
<p>Nous savons déjà que la série des log rendements est stationnaire. De plus les fonctions d’autocorrélation et d’autocorrélation partielle sont exponentielles décroissantes et s’annulent après quelques retards. Cela nous conduit à envisager un modèle AR(p) avec p=1,2,3,4,5,6,7,8,9,10. Nous allons comparer les modèles AR(p) et choisir le modèle qui minimise le BIC.</p>
<div id="cell-147" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construction des modèles AR(p) for p in [1,2,3,4,5] et choix du modèle avec le plus petit BIC</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.ar_model <span class="im">import</span> AutoReg</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>bic <span class="op">=</span> {}</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> AutoReg(train_close[<span class="st">'log_return'</span>],lags<span class="op">=</span>p).fit()</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    bic[p] <span class="op">=</span> model.bic</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"le modèle avec le plus petit BIC est le modèle AR(</span><span class="sc">{</span><span class="bu">min</span>(bic, key<span class="op">=</span>bic.get)<span class="sc">}</span><span class="ss">)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>le modèle avec le plus petit BIC est le modèle AR(1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>d:\risque_multiple\mon_env\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
d:\risque_multiple\mon_env\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
d:\risque_multiple\mon_env\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
d:\risque_multiple\mon_env\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
d:\risque_multiple\mon_env\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)</code></pre>
</div>
</div>
<p>Le modèle AR(1) est celui qui a le plus petit BIC. Nous maintenant étudier l’adéquation de ce modèle.</p>
<section id="analyse-des-résidus" class="level4">
<h4 class="anchored" data-anchor-id="analyse-des-résidus">Analyse des résidus</h4>
<p>Nous allons allons vérifier à l’aide du test de portemanteau si les résidus sont des bruits blancs. Nous utiliserons le test de Ljung-Box. L’hypothèse nulle est qu’il n’existe pas d’autocorrélation dans les résidus.</p>
<div id="cell-150" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de Ljung-Box pour les résidus du modèle AR(1)</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.diagnostic <span class="im">import</span> acorr_ljungbox</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> AutoReg((train_close[<span class="st">'log_return'</span>]<span class="op">-</span>np.mean(train_close[<span class="st">'log_return'</span>])),lags<span class="op">=</span><span class="dv">1</span>).fit()</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>residus <span class="op">=</span> model.resid</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>result_lyung_box <span class="op">=</span> acorr_ljungbox(residus, lags<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>result_lyung_box</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            AutoReg Model Results                             
==============================================================================
Dep. Variable:             log_return   No. Observations:                 6463
Model:                     AutoReg(1)   Log Likelihood               18394.879
Method:               Conditional MLE   S.D. of innovations              0.014
Date:                Sat, 10 Feb 2024   AIC                         -36783.758
Time:                        12:15:51   BIC                         -36763.437
Sample:                             1   HQIC                        -36776.727
                                 6463                                         
=================================================================================
                    coef    std err          z      P&gt;|z|      [0.025      0.975]
---------------------------------------------------------------------------------
const          -2.31e-06      0.000     -0.013      0.989      -0.000       0.000
log_return.L1    -0.0092      0.012     -0.741      0.458      -0.034       0.015
                                    Roots                                    
=============================================================================
                  Real          Imaginary           Modulus         Frequency
-----------------------------------------------------------------------------
AR.1         -108.4453           +0.0000j          108.4453            0.5000
-----------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>d:\risque_multiple\mon_env\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)</code></pre>
</div>
</div>
<p>Il est en resort que l’hypothèse nulle du test rejettée pour les 10 premiers lags, ce qui signifie que les résidus sont corrélés. Nous pouvons déjà conclure que le modèle AR(1) n’est pas satisfaisant. L’homoscédasticité des résidus peut être vérifiée aussi à l’aide du test de Portemanteau : en étudiant la corrélation des carrés des résidus. Nous pouvons aussi étudier la normalité des résidus à l’aide du test de Jarque-Bera et du QQ plot.</p>
</section>
<section id="test-de-portemanteau-sur-les-carrés-des-résidus" class="level4">
<h4 class="anchored" data-anchor-id="test-de-portemanteau-sur-les-carrés-des-résidus">Test de Portemanteau sur les carrés des résidus</h4>
<div id="cell-152" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>result_lyung_box <span class="op">=</span> acorr_ljungbox(residus<span class="op">**</span><span class="dv">2</span>, lags<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(  result_lyung_box) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        lb_stat      lb_pvalue
1    231.697585   2.541754e-52
2    593.531949  1.306697e-129
3    948.626672  2.507727e-205
4   1230.399166  4.092016e-265
5   1695.949057   0.000000e+00
6   1920.095157   0.000000e+00
7   2117.633776   0.000000e+00
8   2312.473230   0.000000e+00
9   2587.570093   0.000000e+00
10  2884.923907   0.000000e+00</code></pre>
</div>
</div>
<p>L’hypothèse nulle qui suppose que les résidus sont homoscédastiques est rejetée. Nous pouvons donc conclure que les résidus ne sont pas homoscédastiques et pensez à un modèle GARCH sur les résidus.</p>
</section>
<section id="qq-plot-des-résidus" class="level3">
<h3 class="anchored" data-anchor-id="qq-plot-des-résidus">QQ plot des résidus</h3>
<div id="cell-155" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>sm.qqplot(residus, line <span class="op">=</span><span class="st">'s'</span>)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'residusB Returns - QQ Plot'</span>)</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-81-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="test-de-jarque-bera" class="level4">
<h4 class="anchored" data-anchor-id="test-de-jarque-bera">Test de Jarque-Bera</h4>
<div id="cell-157" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> jarque_bera</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de Jarque-Bera pour la normalité</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>jb_test_statistic, jb_p_value <span class="op">=</span> jarque_bera(residus)</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Jarque-Bera test statistic:"</span>, jb_test_statistic)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Jarque-Bera test p-value:"</span>, jb_p_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Jarque-Bera test statistic: 5247.415969035655
Jarque-Bera test p-value: 0.0</code></pre>
</div>
</div>
<p>On peut déjà constater à partir de ce qqplot que les résidus ne suivent pas une loi normale. En effet, les quantiles théoriques et les quantiles empiriques ne sont pas alignés. Nous avons également rejeté l’hypothèse nulle du test de Jarque-Bera.</p>
<p>Nous allons maintenant modéliser le résidus de ce AR(1).</p>
</section>
</section>
<section id="adéquation-du-modèle-garch-sur-les-résidus" class="level3">
<h3 class="anchored" data-anchor-id="adéquation-du-modèle-garch-sur-les-résidus">Adéquation du modèle GARCH sur les résidus</h3>
<p>Afin de vérifier si le modèle GARCH est adéquat pour les résidus, nous allons ajuster un modèle GARCH(1,1) aux résidus et ensuite nous allons vérifier à partir des résidus au carrée s’il y’a de l’hetéroscedasticité dans les résidus.</p>
<div id="cell-160" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> arch <span class="im">import</span> arch_model</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the GARCH(1,1) model in the résidus and take the square</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>residus_garch_model <span class="op">=</span> arch_model(residus, vol<span class="op">=</span><span class="st">'Garch'</span>, p<span class="op">=</span><span class="dv">1</span>, q<span class="op">=</span><span class="dv">1</span>).fit(disp<span class="op">=</span><span class="st">'off'</span>)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>residuals_garch <span class="op">=</span> residus_garch_model.resid</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>squared_residuals_garch <span class="op">=</span> residuals_garch<span class="op">**</span><span class="dv">2</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>plot_acf(squared_residuals_garch, ax<span class="op">=</span>axes[<span class="dv">0</span>], title<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>plot_pacf(squared_residuals_garch, ax<span class="op">=</span>axes[<span class="dv">1</span>], title<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>sm.qqplot(squared_residuals_garch, line <span class="op">=</span><span class="st">'s'</span>,ax<span class="op">=</span>axes[<span class="dv">2</span>])    </span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-83-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le graphique ci-dessous confirme la présence d’hetéroscedasticité dans les résidus. Nous pouvons donc conclure que le modèle GARCH est adéquat pour les résidus. Appliquons dons un modèle GARCH(1,1) aux résidus et voyons ses résultats. Nous allons procéder par étape :</p>
<ul>
<li>Nous allons itérer sur les modèles ARIMA(p,d,q) pour trouver le modèle qui minimise le BIC.</li>
<li>Nous allons prendre le modèle GARCH(p,q) en fonction du modèle ARIMA(p,d,q) qui minimise le BIC.</li>
<li>Appliquer le modèle GARCH(p,q) aux résidus et examiner les résidus du modèle et les résidus du modèle au carré pour vérifier la présence d’hetéroscedasticité.</li>
</ul>
<p>Avant d’aller plus loin, vérifions statistiquement la présence d’un effet ARCH dans les résidus.</p>
<div id="cell-162" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Test d'un effet ARCH sur les résidus</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>arch_test <span class="op">=</span> sm.stats.diagnostic.het_arch(squared_residuals_garch)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'ARCH test results:</span><span class="ch">\n</span><span class="ss">'</span>)</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'LM Statistic: </span><span class="sc">{</span>arch_test[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'p-value: </span><span class="sc">{</span>arch_test[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'F Statistic: </span><span class="sc">{</span>arch_test[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'p-value: </span><span class="sc">{</span>arch_test[<span class="dv">3</span>]<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ARCH test results:

LM Statistic: 624.9569659306129
p-value: 7.887973949362182e-128
F Statistic: 69.08045459804893
p-value: 1.2818085014330244e-134</code></pre>
</div>
</div>
<p>Nous pouvons conclure qu’il y’a un effet ARCH dans les résidus. Nous allons donc appliquer un modèle GARCH(1,1) aux résidus pour capturer la volatilité. L’hypothèse d’homoscédasticité est rejetée. Donc il y’a une présence d’hétéroscédasticit conditionnelle dans les résidus.</p>
</section>
<section id="modélisation-du-garch-sur-les-résidus." class="level2">
<h2 class="anchored" data-anchor-id="modélisation-du-garch-sur-les-résidus.">Modélisation du GARCH sur les résidus.</h2>
<p>Nous allons appliquer un modèle GARCH(1,1) sur les résidus.</p>
<div id="cell-165" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>garch_final_model <span class="op">=</span> arch_model(residus, vol<span class="op">=</span><span class="st">'Garch'</span>, p<span class="op">=</span><span class="dv">1</span>, q<span class="op">=</span><span class="dv">1</span>).fit(disp<span class="op">=</span><span class="st">'off'</span>)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(garch_final_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     Constant Mean - GARCH Model Results                      
==============================================================================
Dep. Variable:                   None   R-squared:                       0.000
Mean Model:             Constant Mean   Adj. R-squared:                  0.000
Vol Model:                      GARCH   Log-Likelihood:                19233.9
Distribution:                  Normal   AIC:                          -38459.7
Method:            Maximum Likelihood   BIC:                          -38432.6
                                        No. Observations:                 6462
Date:                Sat, Feb 10 2024   Df Residuals:                     6461
Time:                        12:15:56   Df Model:                            1
                                 Mean Model                                 
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
mu         3.3553e-04  7.461e-06     44.969      0.000 [3.209e-04,3.502e-04]
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega      3.9447e-06  9.286e-12  4.248e+05      0.000 [3.945e-06,3.945e-06]
alpha[1]       0.1000  1.048e-02      9.539  1.442e-21   [7.945e-02,  0.121]
beta[1]        0.8800  8.851e-03     99.420      0.000     [  0.863,  0.897]
============================================================================

Covariance estimator: robust</code></pre>
</div>
</div>
<p>Les résultats du modèle GARCH(1,1) se trouvent dans le tableau ci-dessus. Nous pouvons constater que les paramètres sont tous significatifs. Nous allons maintenant vérifier la qualité d’ajustement du modèle GARCH(1,1) aux résidus.</p>
<section id="analyse-des-résidus-du-modèle-garch" class="level4">
<h4 class="anchored" data-anchor-id="analyse-des-résidus-du-modèle-garch">Analyse des résidus du modèle GARCH</h4>
<p>La figure ci-dessous représente les différents graphiques : - Le graphique des résidus du modèle GARCH - La volatilité conditionnelle estimée - Le graphique des résidus standardisés</p>
<p>Le résidu dont l’analyse de la blancheur nous intéresse est le résidu standardisé. Il est le résultat du rapport entre le résidu du modèle GARCH et la volatilité conditionnelle estimée. Nous allons donc vérifier si ce résidu est un bruit blanc. C’est ce résidu que nous allons utiliser pour modéliser la VaR.</p>
<div id="cell-167" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>std_residus <span class="op">=</span> garch_final_model.resid <span class="op">/</span> garch_final_model.conditional_volatility</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(garch_final_model.resid)</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Résidus"</span>)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(garch_final_model.conditional_volatility)</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Volatilité conditionnelle"</span>)</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(std_residus)</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">"Résidus standardisés"</span>)</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-86-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="vérifions-que-les-résidus-de-ce-modèle-garch-sont-des-bruits-blancs." class="level3">
<h3 class="anchored" data-anchor-id="vérifions-que-les-résidus-de-ce-modèle-garch-sont-des-bruits-blancs.">Vérifions que les résidus de ce modèle GARCH sont des bruits blancs.</h3>
<p>Nous allons faire le test de Ljung-Box pour vérifier l’autocorrélation des résidus. Et nous allons également faire ce test sur les carrés des résidus pour vérifier l’absence d’autocorrélation des résidus au carré d’où l’absence d’hetéroscedasticité.</p>
<div id="cell-169" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test de Ljung-Box sur les résidus et les résidus au carré</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>test_lyungbow <span class="op">=</span> acorr_ljungbox(std_residus, lags<span class="op">=</span>[<span class="dv">10</span>], return_df<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(test_lyungbow)</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>test_lyungbow_squared <span class="op">=</span> acorr_ljungbox(std_residus<span class="op">**</span><span class="dv">2</span>, lags<span class="op">=</span>[<span class="dv">10</span>], return_df<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(test_lyungbow_squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      lb_stat  lb_pvalue
10  15.733691   0.107514
     lb_stat  lb_pvalue
10  9.253333   0.508242</code></pre>
</div>
</div>
<p>Dans les deux cas, la p-value est supèrieur à 5%. Nous ne pouvons donc pas rejeter l’hypothèse nulle selon laquelle les résidus sont des bruits blancs. Nous pouvons donc conclure que le modèle GARCH(1,1) est satisfaisant. Nous pouvons faire d’autres tests pour vérifier la qualité de notre modèle tel que le test de Jarque-Bera et le QQ plot.</p>
<p>Les estimations des paramètres du modèle AR(1)-GARCH(1,1) sont significatifs. Nous pouvons donc conclure que le modèle AR(1)-GARCH(1,1) est adéquat pour les log-rendements. Les paramètres estimés sont : - alpha = 0.0858 - beta = 0.8978 - omega = 0.0322 - phi = -0.0092</p>
</section>
</section>
<section id="estimation-des-paramètres-du-modèle-ar1-garch11." class="level2">
<h2 class="anchored" data-anchor-id="estimation-des-paramètres-du-modèle-ar1-garch11.">Estimation des paramètres du modèle AR(1)-GARCH(1,1).</h2>
<p>Nous pouvons directement estimer les paramètres du modèle AR(1)-GARCH(1,1) en utilisant la fonction arch_model de la bibliothèque arch. C’est ce que nous allons faire dans la cellule suivante.</p>
<div id="cell-172" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co">## estimation des paramètres du modèle AR(1) -GARCH(1,1)</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>ar_garch_model <span class="op">=</span> arch_model(train_close[<span class="st">'log_return'</span>], vol<span class="op">=</span><span class="st">'Garch'</span>, p<span class="op">=</span><span class="dv">1</span>, q<span class="op">=</span><span class="dv">1</span>, mean<span class="op">=</span><span class="st">'AR'</span>, lags<span class="op">=</span><span class="dv">1</span>).fit(disp<span class="op">=</span><span class="st">'off'</span>)</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ar_garch_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           AR - GARCH Model Results                           
==============================================================================
Dep. Variable:             log_return   R-squared:                      -0.000
Mean Model:                        AR   Adj. R-squared:                 -0.001
Vol Model:                      GARCH   Log-Likelihood:                19233.9
Distribution:                  Normal   AIC:                          -38457.7
Method:            Maximum Likelihood   BIC:                          -38423.9
                                        No. Observations:                 6462
Date:                Sat, Feb 10 2024   Df Residuals:                     6460
Time:                        12:17:23   Df Model:                            2
                                    Mean Model                                   
=================================================================================
                     coef    std err          t      P&gt;|t|       95.0% Conf. Int.
---------------------------------------------------------------------------------
Const          4.7602e-04  2.667e-05     17.851  2.864e-71  [4.238e-04,5.283e-04]
log_return[1] -9.2258e-03  1.310e-02     -0.704      0.481 [-3.490e-02,1.644e-02]
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega      3.9447e-06  9.121e-12  4.325e+05      0.000 [3.945e-06,3.945e-06]
alpha[1]       0.1000  1.048e-02      9.544  1.375e-21   [7.946e-02,  0.121]
beta[1]        0.8800  8.849e-03     99.450      0.000     [  0.863,  0.897]
============================================================================

Covariance estimator: robust</code></pre>
</div>
</div>
<div id="cell-173" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># les paramètres du modèle AR(1)-GARCH(1,1) sont les suivants</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Les paramètres du modèle AR(1)-GARCH(1,1) sont les suivants:</span><span class="ch">\n</span><span class="sc">{</span>ar_garch_model<span class="sc">.</span>params<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>constance,phi, omega, alpha, beta <span class="op">=</span> ar_garch_model.params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Les paramètres du modèle AR(1)-GARCH(1,1) sont les suivants:
Const            0.000476
log_return[1]   -0.009226
omega            0.000004
alpha[1]         0.100000
beta[1]          0.880000
Name: params, dtype: float64</code></pre>
</div>
</div>
<p>Les résultats ci-dessus donnent les mêmes résultats que ceux obtenus précédemment. Nous pouvons donc conclure que le modèle AR(1)-GARCH(1,1) est adéquat pour les log-rendements.</p>
</section>
</section>
<section id="reproduction-de-la-dynamique-historique-de-sigma_t-et-de-mu_t" class="level1">
<h1>Reproduction de la dynamique historique de <span class="math inline">\(\sigma_t\)</span> et de <span class="math inline">\(\mu_t\)</span></h1>
<div id="cell-175" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forcast_mu_sigma(r, phi_hat, omega_hat, alpha_hat, beta_hat):</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Calcule les prévisions de mu et sigma^2 pour une série de log-rendements</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :param r: Vecteur de log-rendements (numpy array).</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="co">    :param phi_hat: Estimation de phi (float).</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="co">    :param omega_hat: Estimation de omega (float).</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="co">    :param alpha_hat: Estimation de alpha (float).</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="co">    :param beta_hat: Estimation de beta (float).</span></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a><span class="co">    :return: Tuple de numpy arrays (mu_hat, sigma2_hat).</span></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialisation des vecteurs mu_hat et sigma2_hat</span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>    mu_hat <span class="op">=</span> np.zeros(<span class="bu">len</span>(r))</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>    sigma2_hat <span class="op">=</span> np.zeros(<span class="bu">len</span>(r))</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialisation de la première valeur de mu_hat</span></span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>    mu_hat[<span class="dv">0</span>] <span class="op">=</span> np.mean(r)</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialisation de la première valeur de sigma2_hat en utilisant la variance long terme</span></span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a>    sigma2_hat[<span class="dv">0</span>] <span class="op">=</span> omega_hat <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> alpha_hat <span class="op">-</span> beta_hat)</span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul des valeurs de mu_hat et sigma2_hat en utilisant les formules GARCH(1,1)</span></span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(r)):</span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a>        mu_hat[t] <span class="op">=</span> mu_hat[<span class="dv">0</span>] <span class="op">+</span> phi_hat <span class="op">*</span> r[t<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a>        sigma2_hat[t] <span class="op">=</span> omega_hat <span class="op">+</span> alpha_hat <span class="op">*</span> (r[t<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> mu_hat[t<span class="op">-</span><span class="dv">1</span>])<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> beta_hat <span class="op">*</span> sigma2_hat[t<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mu_hat, sigma2_hat</span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a>constance,phi, omega, alpha, beta <span class="op">=</span> ar_garch_model.params</span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true" tabindex="-1"></a>mu_hat, sigma2_hat <span class="op">=</span>forcast_mu_sigma(ts_close[<span class="st">'log_return'</span>],ar_garch_model.params[<span class="st">'log_return[1]'</span>], ar_garch_model.params[<span class="st">'omega'</span>], ar_garch_model.params[<span class="st">'alpha[1]'</span>], ar_garch_model.params[<span class="st">'beta[1]'</span>])</span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-36"><a href="#cb140-36" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Une fois que l’on a reproduire la dynamique de <span class="math inline">\(\sigma_t\)</span> et de <span class="math inline">\(\mu_t\)</span>, nous pouvons faire des représentations graphiques pour vérifier la qualité de cette reproduction. Dans le graphique ci-dessous, nous allons représenter la série de <span class="math inline">\(\sigma_t\)</span> et de <span class="math inline">\(\mu_t\)</span> en fonction de la date ainsi que la volatilité conditionnelle estimée par le modèle AR(1)-GARCH(1,1).</p>
<div id="cell-177" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>fig,axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot( mu_hat, label<span class="op">=</span><span class="st">'Prévision de mu'</span>)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Prévision de mu'</span>)</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot( sigma2_hat, label<span class="op">=</span><span class="st">'Prévision de $\sigma^2$'</span>)</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Prévision de $\sigma^2$'</span>)</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(garch_final_model.conditional_volatility, label<span class="op">=</span><span class="st">'Volatilité conditionnelle'</span>)</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">'Volatilité conditionnelle'</span>)</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-91-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Avant de calculer la VaR dynamique, nous allons estimer le quantile de <span class="math inline">\(1-\alpha\)</span> des résidus <span class="math inline">\(\epsilon_t\)</span>. Rappelons que notre modèle AR(1)-GARCH(1,1) est donné par :</p>
<p>L’équation du modèle AR(1) pour la moyenne conditionnelle : <span class="math display">\[\hat{\mu_t} = \hat{\mu} + \hat{\phi} R_{t-1}\]</span></p>
<p>L’équation du modèle GARCH(1,1) pour la variance conditionnelle : <span class="math display">\[\hat{\sigma_t}^2 = \hat{\omega} + \hat{\alpha} (R_{t-1} - \hat{\mu_t})^2 + \hat{\beta} \hat{\sigma_{t-1}}^2\]</span></p>
<p>où : - <span class="math inline">\(\hat{\mu_t}\)</span> est la moyenne conditionnelle au temps <span class="math inline">\(t\)</span>, - <span class="math inline">\(R_{t-1}\)</span> est le rendement à <span class="math inline">\(t-1\)</span>, - <span class="math inline">\(\hat{\sigma_t}^2\)</span> est la variance conditionnelle au temps <span class="math inline">\(t\)</span>, - <span class="math inline">\(\hat{\mu}\)</span>, <span class="math inline">\(\hat{\phi}\)</span>, <span class="math inline">\(\hat{\omega}\)</span>, <span class="math inline">\(\hat{\alpha}\)</span>, et <span class="math inline">\(\hat{\beta}\)</span> sont les paramètres estimés du modèle.</p>
<p>Et enfin le résidu <span class="math inline">\(\epsilon_t\)</span> est donné par :</p>
<p><span class="math display">\[\epsilon_t = \frac{R_t - \hat{\mu_t}}{\hat{\sigma_t}}\]</span> qui est le résidu standardisé.</p>
<section id="calcul-de-la-var-sur-les-résidus-standardisés-epsilon_t" class="level3">
<h3 class="anchored" data-anchor-id="calcul-de-la-var-sur-les-résidus-standardisés-epsilon_t">Calcul de la VaR sur les résidus standardisés <span class="math inline">\(\epsilon_t\)</span></h3>
<p>Pour calculer la VaR sur les résidus standardisés, nous allons utiliser pour l’approche non-paramétrique, la VaR historique boostrap et pour la méthode TVE, nous allons utiliser l’approche maxima par bloc.</p>
</section>
</section>
<section id="var-historique-boostrap-sur-les-résidus-standardisés-et-calcul-de-la-var-dynamique" class="level1">
<h1>VaR historique boostrap sur les résidus standardisés et calcul de la VaR dynamique</h1>
<div id="cell-180" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co">### VaR historique bootstrap sur les résidus du modèle AR(1)-GARCH(1,1)</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>seuil <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>seuil_IC <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>num_simulations <span class="op">=</span> <span class="dv">5000</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>n_B <span class="op">=</span> <span class="dv">251</span><span class="op">*</span><span class="dv">10</span> <span class="co">#on utilise 10 ans de données comme taille d'échantillons bootstrap</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>var_residu_boostrap <span class="op">=</span> VaR_Hist_Bootstrap(std_residus, seuil, num_simulations, seuil_IC, n_B)[<span class="dv">0</span>]</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>var_garchdyn_boostrap <span class="op">=</span> (mu_hat <span class="op">+</span> np.sqrt(sigma2_hat) <span class="op">*</span> var_residu_boostrap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="backtesting-2" class="level1">
<h1>Backtesting</h1>
<div id="cell-182" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>list_exceptions_garchdyn_boot <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(train_size,<span class="bu">len</span>(ts_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> ts_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_garchdyn_boostrap[i]]</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(list_exceptions_garchdyn_boot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>26</code></pre>
</div>
</div>
<div id="cell-183" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR GARCH est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_garchdyn_boot)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR GARCH est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_garchdyn_boot)<span class="op">/</span>test_size<span class="op">*</span><span class="fl">100.</span><span class="sc">:0.2f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR GARCH est: 26
Le pourcentage d'exceptions pour la VaR GARCH est: 1.21%</code></pre>
</div>
</div>
<div id="cell-184" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>test_except_gaus <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_garchdyn_boot), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_gaus<span class="sc">.</span>pvalue<span class="sc">:.2f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.33</code></pre>
</div>
</div>
<p>La pvalue du test est supérieure au seuil de 5%. On ne peut donc pas rejeter l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Nous concluons donc que notre VaR est satisfaisante.</p>
<div id="cell-186" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index, ts_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], var_garchdyn_boostrap[train_size:], label<span class="op">=</span><span class="st">'VaR dynamique'</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(ts_close.index[list_exceptions_garchdyn_boot], ts_close[<span class="st">'log_return'</span>][list_exceptions_garchdyn_boot], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-96-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="var-par-la-méthode-maxima-par-bloc-sur-les-résidus-standardisés-et-calcul-de-la-var-dynamique" class="level1">
<h1>VaR par la méthode maxima par bloc sur les résidus standardisés et calcul de la VaR dynamique</h1>
<p>La TVE s’intéressant aux queues de distribution droite, nous allons d’abord convertir les résidus standardisés en prenant l’opposé.</p>
<div id="cell-189" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>std_residus_minus <span class="op">=</span> <span class="op">-</span>std_residus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-190" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>std_residus_maxima <span class="op">=</span> construct_max_data(std_residus_minus, <span class="dv">21</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>plt.plot(std_residus_maxima ,color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"residus maxima "</span>)</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-98-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-191" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_gumbel_residus <span class="op">=</span> []</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(std_residus_maxima)<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> <span class="op">-</span>np.log(<span class="op">-</span>np.log((i<span class="op">-</span><span class="fl">0.5</span>)<span class="op">/</span><span class="bu">len</span>(std_residus_maxima)))</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>    quantiles_theoriques_gumbel_residus.append(val)</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Tracer le Gumbel plot</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_gumbel_residus, np.sort(std_residus_maxima), marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 1 : Calculer les coefficients de la droite d'ajustement</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>coefficients <span class="op">=</span> np.polyfit(quantiles_theoriques_gumbel_residus, np.sort(std_residus_maxima), <span class="dv">1</span>)</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 2 : Générer les valeurs de la droite d'ajustement</span></span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>droite_ajustement <span class="op">=</span> np.poly1d(coefficients)</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array(quantiles_theoriques_gumbel_residus)</span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>y_ajustement <span class="op">=</span> droite_ajustement(x)</span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Étape 3 : Tracer la droite d'ajustement</span></span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_ajustement, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Gumbel Plot'</span>)</span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques de Gumbel'</span>)</span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles observés'</span>)</span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-99-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le gumbel plot semble linéaire et ne présente pas de courbure. Nous allons donc utiliser la loi de Gumbel pour la suite.</p>
<div id="cell-193" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> genextreme <span class="im">as</span> gev</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> gumbel_r</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>params_gev_residus <span class="op">=</span> gev.fit(std_residus_maxima)</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>params_gumbel_residus <span class="op">=</span> gumbel_r.fit(std_residus_maxima)</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les paramètres estimés</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Paramètres estimés de la distribution GEV:"</span>)</span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Forme (xi) ="</span>, params_gev_residus[<span class="dv">0</span>])</span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Localisation (mu) ="</span>, params_gev_residus[<span class="dv">1</span>])</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Echelle (sigma) ="</span>, params_gev_residus[<span class="dv">2</span>])</span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">150</span><span class="op">*</span><span class="st">"-"</span>)</span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Paramètres estimés de la distribution de Gumbel (xi nul):"</span>)</span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Localisation (mu) ="</span>, params_gumbel_residus[<span class="dv">0</span>])</span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Echelle (sigma) ="</span>, params_gumbel_residus[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Paramètres estimés de la distribution GEV:
Forme (xi) = -0.023456008571750273
Localisation (mu) = 1.7068601969202493
Echelle (sigma) = 0.5951776042334704
------------------------------------------------------------------------------------------------------------------------------------------------------
Paramètres estimés de la distribution de Gumbel (xi nul):
Localisation (mu) = 1.7147295823748347
Echelle (sigma) = 0.5991954595342129</code></pre>
</div>
</div>
<div id="cell-194" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaison des distributions GEV et Gumbel</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>plt.hist(std_residus_maxima, bins<span class="op">=</span><span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="st">'Données observées'</span>)</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> plt.xlim()</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Densité GEV ajustée</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>p_gev_residus <span class="op">=</span> gev.pdf(x, <span class="op">*</span>params_gev_residus)</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p_gev_residus, <span class="st">'k'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'GEV ajustée'</span>)</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Densité Gumbel ajustée</span></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>p_gumbel_residus <span class="op">=</span> gumbel_r.pdf(x, <span class="op">*</span>params_gumbel_residus)</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p_gumbel_residus, <span class="st">'r'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Gumbel ajustée'</span>)</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Comparaison GEV vs Gumbel'</span>)</span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-101-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Les deux distributions semblent bien modéliser la queue de distribution des résidus standardisés.</p>
<div id="cell-196" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>niveaux_quantiles_residus <span class="op">=</span> np.arange(<span class="fl">0.001</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>quantiles_empiriques_TVE_residus <span class="op">=</span> np.quantile(std_residus_maxima, niveaux_quantiles_residus)</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_GEV_residus <span class="op">=</span> gev.ppf(niveaux_quantiles_residus, <span class="op">*</span>params_gev_residus)</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>quantiles_theoriques_Gumb_residus <span class="op">=</span> gumbel_r.ppf(niveaux_quantiles_residus, <span class="op">*</span>params_gumbel_residus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-197" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_GEV_residus, quantiles_empiriques_TVE_residus)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques_GEV_residus, quantiles_theoriques_GEV_residus, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi GEV"</span>)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (Loi GEV)'</span>)</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>plt.scatter(quantiles_theoriques_Gumb_residus, quantiles_empiriques_TVE_residus)</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>plt.plot(quantiles_theoriques_Gumb_residus, quantiles_theoriques_Gumb_residus, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Première bissectrice'</span>)</span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"QQ Plot d'une modélisation par loi Gumbel"</span>)</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantiles théoriques (Loi Gumbel)'</span>)</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Quantiles empiriques'</span>)</span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-103-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Les deux modélisations semblent bien correspondre aux données. Comme le Gumbel plot est linéaire, nous allons utiliser la loi de Gumbel pour modéliser la GEV et calculer la VaR.</p>
</section>
<section id="calcul-de-la-var-2" class="level1">
<h1>Calcul de la VaR</h1>
<div id="cell-199" class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># redressement de alpha</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.99</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="dv">21</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>alpha_bm <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>s<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>alpha)</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>var_std_residus <span class="op">=</span> <span class="op">-</span>gumbel_r.ppf(alpha_bm, <span class="op">*</span>params_gumbel_residus)</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>var_dyn_TVE_residus <span class="op">=</span> (mu_hat <span class="op">+</span> np.sqrt(sigma2_hat) <span class="op">*</span> var_std_residus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="backtesting-3" class="level2">
<h2 class="anchored" data-anchor-id="backtesting-3">Backtesting</h2>
<div id="cell-201" class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>list_exceptions_TVE_residus <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(train_size,<span class="bu">len</span>(ts_close[<span class="st">'log_return'</span>])) <span class="cf">if</span> ts_close[<span class="st">'log_return'</span>][i]<span class="op">&lt;</span>var_dyn_TVE_residus[i]]</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(list_exceptions_TVE_residus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>25</code></pre>
</div>
</div>
<div id="cell-202" class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le nombre d'exceptions pour la VaR TVE est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_residus)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Le pourcentage d'exceptions pour la VaR TVE est: </span><span class="sc">{</span><span class="bu">len</span>(list_exceptions_TVE_residus)<span class="op">/</span>test_size<span class="op">*</span><span class="fl">100.</span><span class="sc">:0.2f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions pour la VaR TVE est: 25
Le pourcentage d'exceptions pour la VaR TVE est: 1.16%</code></pre>
</div>
</div>
<div id="cell-203" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>test_except_TVE_residus <span class="op">=</span> stats.binomtest(<span class="bu">len</span>(list_exceptions_TVE_residus), test_size, p <span class="op">=</span> <span class="fl">0.01</span>)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'la p-value du test binomial est: </span><span class="sc">{</span>test_except_TVE_residus<span class="sc">.</span>pvalue<span class="sc">:.2f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>la p-value du test binomial est: 0.45</code></pre>
</div>
</div>
<p>La pvalue du test est supérieure au seuil de 5%. On ne peut donc pas rejeter l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Nous concluons donc que notre VaR dynamique est satisfaisante.</p>
<div id="cell-205" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index, ts_close[<span class="st">'log_return'</span>], label<span class="op">=</span><span class="st">"historical log returns"</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>plt.plot(ts_close.index[train_size:], var_dyn_TVE_residus[train_size:], label<span class="op">=</span><span class="st">'VaR dynamique'</span>, color <span class="op">=</span> <span class="st">'red'</span>)</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(x <span class="op">=</span> ts_close.index[train_size<span class="op">-</span><span class="dv">251</span><span class="op">*</span><span class="dv">10</span><span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="st">'Limite de données pour le calcul de la VaR'</span>)</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(ts_close.index[list_exceptions_TVE_residus], ts_close[<span class="st">'log_return'</span>][list_exceptions_TVE_residus], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Exceptions'</span>)</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'CAC40'</span>)</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Values'</span>)</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>plt.plot()</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="risque_extreme_Jumbong_Ganiyu_10_02_files/figure-html/cell-108-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Ce projet a eu pour objectif d’estimer la VaR à horizon 1 jour et la VaR dynamique de différentes façons. Nous avons utilisé les données historiques du CaC40. Nous avons utilisé des méthodes non-paramétriques telles que la VaR historique et la VaR historique bootstrap. Nous avons également utilisé des méthodes paramétriques telles que la VaR gaussienne, la VaR skew-student et nous avons utilisé la théorie des valeurs extrêmes pour modéliser la VaR. Nous avons également estimé de deux façons différentes la VaR dynamique. La première méthode consiste à calculer la VaR historique sur une fenêtre glissante de 251 jours. La deuxième méthode consiste à modéliser la VaR par un modèle AR-GARCH. Nous avons également validé nos modèles par des tests de backtesting.</p>
<p>Les différentes approches de modélisation estime la VaR à horizon 1 jour à environ -0.03 avec un niveau de confiance de 99%. Ceci signifie que la perte maximale que peut subir un portefeuille sur un horizon de 1 jour avec un niveau de confiance de 99% est de 3%. Nous avons également validé nos modèles par des tests de backtesting qui ne rejettent pas l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%.</p>
<p>La VaR dynamique estimée sur une fenêtre glissante de 251 jours n’a pas été validée par le test de backtesting. En effet, la pvalue du test est inférieure au seuil de 5%. Nous rejetons donc l’hypothèse nulle selon laquelle la probabilité d’exception est de 1%. Cependant, la VaR dynamique estimée par le modèle AR(1)-GARCH(1,1) donne des meilleurs résultats. L’hypothèse nulle du test selon laquelle le pourcentage d’exceptions est inférieur à 1% n’a pas été rejetée.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>